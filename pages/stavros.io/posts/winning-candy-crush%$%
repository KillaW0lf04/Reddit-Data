

<!DOCTYPE html>
<html lang="en-US">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />

        <title>Winning at Candy Crush - Stavros&#39; Stuff</title>

        <meta http-equiv="X-XRDS-Location" content="//www.stavros.io/files/xrds" />
        <meta http-equiv="X-Yadis-Location" content="//www.stavros.io/files/xrds" />
        
        <link rel="canonical" href="//www.stavros.io/posts/winning-candy-crush/"/>
        

        <link rel="shortcut icon" type="image/x-icon" href="/media/images/favicon-0d350534022056c0dbf839720d461d8751cc5fae.png">

        <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0" />

        <!--[if IE]>
        <link rel="stylesheet" type="text/css" href="/media/ie9-be333572057c83aa058d5ecb874a763a288cd8c3.css" />
        <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
        <!--[if lt IE 9]>
        <link rel="stylesheet" type="text/css" href="/media/ie-5b4684adae0e7d6208c60e1c9103ed59f30ceee0.css" />
        <![endif]-->

        
        

        <script type="text/javascript">
            document.documentElement.className = 'js';
        </script>

        <link rel="alternate" type="application/rss+xml" title="Stavros&#39; Stuff full posts feed" href="http://feeds.feedburner.com/stavrosstuff" />

        <link href='//fonts.googleapis.com/css?family=Lato:300,400,700|Raleway:400,200,300,600,800' rel='stylesheet' type='text/css'>
        <link href="//netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.css" rel="stylesheet">

        <link rel="stylesheet" type="text/css" href="/media/main-44be28796b4c3e0f474b5b4ca993992f7a180b5b.css" />

        <style type="text/css">
            a, #cancel-comment-reply i, #content .meta a, .post-navigation a:hover, .post-navigation li:hover i, .logo-text:hover i, #sidebar .widget li:before {
            color: #48ADD8
            ;
            }
            .logo-text, .next-prev a, #commentform #submit, .wpcf7-submit, .header .search-form .submit, .search-form .submit, .hero h3, .search-form .submit, .pull-quote, .flex-direction-nav a:hover, .tagcloud a {
            background: #48ADD8
            ;
            }
            .pull-quote:after {
            border-top: 20px solid #48ADD8
            ;
            }
        </style>
        <script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-51110-6']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</head>

    </head>
    <body class="single">
        <div class="header-wrap clearfix">
            <div class="header-search-hidden">
                <a class="header-search-hidden-close" href="#"><i class="icon-remove"></i></a>
                <form class="search-form clearfix">
                    <fieldset>
                        <input type="text" class="search-form-input text" name="q" onfocus="if (this.value == 'Search the site &hellip;') {this.value = '';}" onblur="if (this.value == '') {this.value = 'Search the site &hellip;';}" value="Search the site &hellip;"/>
                        <input type="submit" value="Search" class="submit search-button" />
                    </fieldset>
                </form>
            </div>
            <div class="container">
                <header class="header">
                    <!-- grab the logo and site title -->
                    <hgroup>
                    <h1 class="logo-text"><a href="/" title="Stavros&#39; Stuff">Stavros&#39; Stuff</a></h1>
                        <h2 class="logo-subtitle">Angry rants of programming and other things.</h2>
                    </hgroup>
                    <nav role="navigation" class="header-nav">
                        <!-- nav menu -->
                        <div class="menu-header-container">
                            <ul id="menu-header" class="nav">
                                <li class="menu-item menu-item-type-custom menu-item-object-custom">
                                    <a href="#">Tutorials</a>
                                    <ul class="sub-menu">
                                        <li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="/tutorials/python/">Learn Python in Ten Minutes</a></li>
                                        <li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="/tutorials/online-security/">How to keep yourself secure online</a></li>
                                        <li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="/tutorials/icecast/">How to create an internet radio station</a></li>
                                        <li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="/tutorials/bittorrent/">How to use BitTorrent to send files</a></li>
                                        <li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="/tutorials/bittorrent/download/">How to download files with uTorrent</a></li>
                                        <li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="/tutorials/email/">How to delete emails on a POP3 server</a></li>
                                    </ul>
                                </li>
                                <li class="menu-item menu-item-type-custom menu-item-object-custom">
                                    <a href="#">Downloads</a>
                                    <ul class="sub-menu">
                                        <li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="/downloads/">Downloads</a></li>
                                        <li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="/scripting/">Various scripts</a></li>
                                    </ul>
                                </li>
                                <li class="menu-item menu-item-type-custom menu-item-object-custom">
                                    <a href="#">Various</a>
                                    <ul class="sub-menu">
                                        <li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="/projects/">My projects</a></li>
                                        <li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="/photography/">Photography</a></li>
                                        <li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="/freelance-python-developer/">Freelance Python developer</a></li>
                                        <li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="https://github.com/skorokithakis/">My GitHub</a></li>
                                        <li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="http://resume.stavros.io/">My résumé</a></li>
                                        <li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="/about/">About me</a></li>
                                    </ul>
                                </li>
                                <li class="menu-item menu-item-type-custom menu-item-object-custom">
                                    <a href="#">Archives</a>
                                    <ul class="sub-menu">
                                        <li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="/archives/full/">Full</a></li>
                                        <li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="/archives/">By year</a></li>
                                    </ul>
                                </li>
                            </ul>
                        </div>
                    </nav>
                    <a class="search-toggle" href="#"><i class="icon-search"></i></a>
                </header>
            </div>
            <!-- container -->
        </div>
        
        <!-- header wrap -->
        <div id="wrapper" class="clearfix">
            <div class="inside-wrap clearfix">
                
<header class="page-titles">
<div class="container clearfix">
    <h1 class="entry-title"><a href="/posts/winning-candy-crush/" title='Permalink to "Winning at Candy Crush"' rel="bookmark">Winning at Candy Crush</a></h1>
    <h3 class="entry-subtitle">Conceived on 10 Nov 2013

/ Series:

<a href="/series/winning/">winning</a>


</h3>
    <div class="featured-image-bg" style="background-image: url('/media/images/bkg/books21-77356dd04e775dc4bb90acfad5b2158e68c96306.jpg')"></div>
</div>
</header>

                <div class="page container clearfix">
                    
<div id="content">
    <div class="posts">
        <article class="post">
        <div class="box-wrap">
            <div class="box">
                <div class="post-content">
                    <div class="pull-quote">The Candy Crush Saga saga</div>

<p>I find Flash games on Facebook great fun. Not playing them, of course, that&#8217;s boring. As you may remember from my previous post, &#8220;<a href="/posts/winning-puzzle-adventures/">winning at Puzzle Adventures</a>&#8220;, I like to take a look into their guts and figure out how they work, and whether or not I can get insane scores with no effort.</p>
<p>When I discovered Candy Crush Saga, I was intrigued. All my friends appeared mad about this game, sending me so many requests for candy that their dentist would surely commit harakiri. I started playing a bit, and it wasn&#8217;t long until I had to stop playing, since the game only allows you a set number of lives per hour in an attempt to either extract money from you or coax you into spamming your friends with requests for the game, to increase its popularity.</p>
<h2 id="cheating-at-online-games">Cheating at online games</h2>
<p>This, however, wouldn&#8217;t do, so I fired up the Swiss army knife of web debugging, <a href="http://www.charlesproxy.com">Charles Proxy</a> (it&#8217;s a fantastic tool for this job). I started looking at the requests the game was making to the server, and saw one that looked promising:<!-- break --></p>
<div class="highlight"><pre><span class="err">http://candycrush.king.com/api/gameInitLight</span>

<span class="s2">&quot;currentUser&quot;</span><span class="err">:</span> <span class="p">{</span>
    <span class="nt">&quot;lives&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
    <span class="nt">&quot;maxLives&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</code></pre>

<div class="alignright"><img src="http://media.korokithakis.net/images/posts/winning-candy-crush/candycrush.png" alt="The Candy Crush logo"><span class="caption">Productity Sapper Saga</span></div>

<p>I added a breakpoint and edited <code>lives</code> to always be 5, which did allow me to play for ever, no matter how much I lost. Yay for non-existent server checks! This wasn&#8217;t great, though. Sure, I could play as much as I want, but I don&#8217;t want to play at all! I wanted to see if I could make the game much easier somehow.</p>
<p>Looking some more, I found the call that loads the level, and the level details specify the number of colors to use on the level. Since the game is played by getting candy of one color to line up in a row, fewer colors means a considerably easier game. However, too few colors and the game won&#8217;t end at all! I discovered that four colors is the sweet spot, and edited the level accordingly:</p>
<div class="highlight"><pre><span class="err">http://candycrush.king.com/api/gameStart</span>

<span class="p">{</span>
  <span class="nt">&quot;levelData&quot;</span><span class="p">:{</span>
    <span class="nt">&quot;numberOfColours&quot;</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span>
    <span class="nt">&quot;gameModeName&quot;</span><span class="p">:</span><span class="s2">&quot;Light up&quot;</span><span class="p">,</span>
    <span class="nt">&quot;pepperCandyMax&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
    <span class="nt">&quot;pepperCandySpawn&quot;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span>
    <span class="nt">&quot;chameleonCandyMax&quot;</span><span class="p">:</span><span class="mi">0</span>
  <span class="p">},</span>
<span class="p">}</span>
</pre></div>
</code></pre>

<p>Success! There were only four colors in the level, and the game pretty much cascaded into a huge victory after two or three moves. </p>
<h2 id="diving-deeper">Diving deeper</h2>
<p>Even this, though, was very time-consuming. The game has 500 levels, and, with 3 minutes per level, it would take way too long to win every single one. I needed to discover a faster way to &#8220;play&#8221; games. Helpfully, the server gives you a list of all the API methods when there&#8217;s an error:</p>
<div class="highlight"><pre>  <span class="n">com</span><span class="o">.</span><span class="na">king</span><span class="o">.</span><span class="na">saga</span><span class="o">.</span><span class="na">api</span><span class="o">.</span><span class="na">CurrentUserResponse</span> <span class="nf">poll</span><span class="o">();</span>
  <span class="n">com</span><span class="o">.</span><span class="na">king</span><span class="o">.</span><span class="na">saga</span><span class="o">.</span><span class="na">api</span><span class="o">.</span><span class="na">GetMessagesResponse</span> <span class="nf">getMessages</span><span class="o">();</span>
  <span class="o">[</span><span class="n">Lcom</span><span class="o">.</span><span class="na">king</span><span class="o">.</span><span class="na">saga</span><span class="o">.</span><span class="na">api</span><span class="o">.</span><span class="na">ApiItemInfo</span><span class="o">;</span> <span class="n">unlockItem</span><span class="o">(</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span><span class="o">,</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span><span class="o">);</span>
  <span class="n">com</span><span class="o">.</span><span class="na">king</span><span class="o">.</span><span class="na">saga</span><span class="o">.</span><span class="na">api</span><span class="o">.</span><span class="na">ApiGameEnd</span> <span class="nf">gameEnd</span><span class="o">(</span><span class="n">com</span><span class="o">.</span><span class="na">king</span><span class="o">.</span><span class="na">saga</span><span class="o">.</span><span class="na">api</span><span class="o">.</span><span class="na">ApiGameResult</span><span class="o">);</span>
  <span class="n">com</span><span class="o">.</span><span class="na">king</span><span class="o">.</span><span class="na">saga</span><span class="o">.</span><span class="na">api</span><span class="o">.</span><span class="na">GameInit</span> <span class="nf">gameInit</span><span class="o">();</span>
  <span class="n">com</span><span class="o">.</span><span class="na">king</span><span class="o">.</span><span class="na">saga</span><span class="o">.</span><span class="na">api</span><span class="o">.</span><span class="na">ApiGameStart</span> <span class="nf">gameStart</span><span class="o">(</span><span class="kt">int</span><span class="o">,</span> <span class="kt">int</span><span class="o">);</span>
  <span class="n">com</span><span class="o">.</span><span class="na">king</span><span class="o">.</span><span class="na">saga</span><span class="o">.</span><span class="na">api</span><span class="o">.</span><span class="na">PeekMessagesResponse</span> <span class="nf">peekMessages</span><span class="o">();</span>
  <span class="n">com</span><span class="o">.</span><span class="na">king</span><span class="o">.</span><span class="na">saga</span><span class="o">.</span><span class="na">api</span><span class="o">.</span><span class="na">GetMessagesResponse</span> <span class="nf">removeMessages</span><span class="o">([</span><span class="n">Ljava</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Long</span><span class="o">;,</span> <span class="kt">boolean</span><span class="o">);</span>
  <span class="n">com</span><span class="o">.</span><span class="na">king</span><span class="o">.</span><span class="na">saga</span><span class="o">.</span><span class="na">api</span><span class="o">.</span><span class="na">GameInit</span> <span class="nf">gameInitLight</span><span class="o">();</span>
  <span class="n">com</span><span class="o">.</span><span class="na">king</span><span class="o">.</span><span class="na">saga</span><span class="o">.</span><span class="na">api</span><span class="o">.</span><span class="na">ApiGameEnd</span> <span class="nf">gameEnd2</span><span class="o">(</span><span class="n">com</span><span class="o">.</span><span class="na">king</span><span class="o">.</span><span class="na">saga</span><span class="o">.</span><span class="na">api</span><span class="o">.</span><span class="na">ApiGameResult</span><span class="o">);</span>
</pre></div>
</code></pre>

<p>Looking at those and the responses, we can immediately  see that the <code>gameEnd</code> method is very interesting indeed:</p>
<div class="highlight"><pre><span class="err">http://candycrush.king.com/api/gameEnd</span>

<span class="p">{</span>
   <span class="nt">&quot;score&quot;</span><span class="p">:</span><span class="mi">373400</span><span class="p">,</span>
   <span class="nt">&quot;variant&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
   <span class="nt">&quot;seed&quot;</span><span class="p">:</span><span class="mi">1384024506403</span><span class="p">,</span>
   <span class="nt">&quot;reason&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
   <span class="nt">&quot;timeLeftPercent&quot;</span><span class="p">:</span><span class="mi">-1</span><span class="p">,</span>
   <span class="nt">&quot;cs&quot;</span><span class="p">:</span><span class="s2">&quot;040a6a&quot;</span><span class="p">,</span>
   <span class="nt">&quot;episodeId&quot;</span><span class="p">:</span><span class="mi">34</span><span class="p">,</span>
   <span class="nt">&quot;levelId&quot;</span><span class="p">:</span><span class="mi">4</span>
<span class="p">}</span>
</pre></div>
</code></pre>

<p>What&#8217;s this? It looks like we can just tell the game we finished a level, without any other hassle. I tried to replay that request by changing the score, but nothing happened. Nothing happened if I specified different episode ids, either. There must be some signature we can&#8217;t duplicate, and the &#8220;cs&#8221; field sounds awfully close to &#8220;checksum&#8221;. I was very close to solving the whole puzzle, but the checksum field means that I will have to fake the signature (which, unless the Candy Crush developers are clueless, should contain a secret key).</p>
<p>There&#8217;s really no way to figure out how the signature is produced without looking at the source, so that&#8217;s what I did. Using my trusty Flash decompiler, I rummaged around in the source code, and found that the <code>cs</code> parameter is basically an MD5 of the following:</p>
<div class="highlight"><pre><span class="s">&quot;episodeId:levelId:score:timeLeftPercent:userId:seed:secretkey&quot;</span>
</pre></div>
</code></pre>

<p>Finding the secret key took a bit more digging, but, with the final piece of the puzzle uncovered, I could finally make make requests to the server and make it seems as if we legitimately finished a game. I&#8217;m not sure if you really have to make the <code>gameStarted</code> call, or if you can pass in any random seed you want, but I think the call is optional. At this point, I could pretty much finish any level I want, with any score I want, in about half a second.</p>
<h2 id="a-script-to-make-it-easier">A script to make it easier</h2>
<p>However, having to do all this in a shell (or curl) was <em>still</em> too hard. To remove that final obstacle, i wrote a small <code>CCrush</code> Python class with various methods to make automatically winning in the game easier. Here&#8217;s the listing:</p>
<div class="highlight"><pre><span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">hashlib</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">sys</span>


<span class="k">class</span> <span class="nc">CCrush</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">session</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">session</span> <span class="o">=</span> <span class="n">session</span>

    <span class="k">def</span> <span class="nf">hand_out_winnings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item_type</span><span class="p">,</span> <span class="n">amount</span><span class="p">):</span>
        <span class="n">item</span> <span class="o">=</span> <span class="p">[{</span><span class="s">&quot;type&quot;</span><span class="p">:</span> <span class="n">item_type</span><span class="p">,</span> <span class="s">&quot;amount&quot;</span><span class="p">:</span> <span class="n">amount</span><span class="p">}]</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&quot;_session&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">,</span>
            <span class="s">&quot;arg0&quot;</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">item</span><span class="p">),</span>
            <span class="s">&quot;arg1&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s">&quot;arg2&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s">&quot;arg3&quot;</span><span class="p">:</span> <span class="s">&quot;hash&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;http://candycrush.king.com/api/handOutItemWinnings&quot;</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">add_life</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;_session&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">}</span>
        <span class="k">return</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;http://candycrush.king.com/api/addLife&quot;</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">start_game</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">episode</span><span class="p">,</span> <span class="n">level</span><span class="p">):</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;_session&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">,</span> <span class="s">&quot;arg0&quot;</span><span class="p">:</span> <span class="n">episode</span><span class="p">,</span> <span class="s">&quot;arg1&quot;</span><span class="p">:</span> <span class="n">level</span><span class="p">}</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;http://candycrush.king.com/api/gameStart&quot;</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s">&quot;seed&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">end_game</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">episode</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">seed</span><span class="p">,</span> <span class="n">score</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">score</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">score</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randrange</span><span class="p">(</span><span class="mi">3000</span><span class="p">,</span> <span class="mi">6000</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
        <span class="n">dic</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&quot;timeLeftPercent&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
            <span class="s">&quot;episodeId&quot;</span><span class="p">:</span> <span class="n">episode</span><span class="p">,</span>
            <span class="s">&quot;levelId&quot;</span><span class="p">:</span> <span class="n">level</span><span class="p">,</span>
            <span class="s">&quot;score&quot;</span><span class="p">:</span> <span class="n">score</span><span class="p">,</span>
            <span class="s">&quot;variant&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s">&quot;seed&quot;</span><span class="p">:</span> <span class="n">seed</span><span class="p">,</span>
            <span class="s">&quot;reason&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">dic</span><span class="p">[</span><span class="s">&quot;cs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%(episodeId)s</span><span class="s">:</span><span class="si">%(levelId)s</span><span class="s">:</span><span class="si">%(score)s</span><span class="s">:</span><span class="si">%(timeLeftPercent)s</span><span class="s">:userid:</span><span class="si">%(seed)s</span><span class="s">:thesecret&quot;</span> <span class="o">%</span> <span class="n">dic</span><span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()[:</span><span class="mi">6</span><span class="p">]</span>

        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;_session&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">,</span> <span class="s">&quot;arg0&quot;</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">dic</span><span class="p">)}</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;http://candycrush.king.com/api/gameEnd&quot;</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">response</span>

    <span class="k">def</span> <span class="nf">play_game</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">episode</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">score</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">seed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_game</span><span class="p">(</span><span class="n">episode</span><span class="p">,</span> <span class="n">level</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_game</span><span class="p">(</span><span class="n">episode</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">seed</span><span class="p">,</span> <span class="n">score</span><span class="p">)</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">ccrush</span> <span class="o">=</span> <span class="n">CCrush</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">episode</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">level</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
    <span class="n">seed</span> <span class="o">=</span> <span class="n">ccrush</span><span class="o">.</span><span class="n">start_game</span><span class="p">(</span><span class="n">episode</span><span class="p">,</span> <span class="n">level</span><span class="p">)</span>
    <span class="n">ccrush</span><span class="o">.</span><span class="n">end_game</span><span class="p">(</span><span class="n">episode</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">seed</span><span class="p">)</span>
</pre></div>
</code></pre>

<p>This script can be invoked with <code>python ccrush.py &lt;sessionid&gt; &lt;episode&gt; &lt;level&gt;</code>, and it will automatically pass that level with a random score. Here&#8217;s the result:</p>
<div class="aligncenter"><a href="http://media.korokithakis.net/images/posts/winning-candy-crush/place.jpg"><img src="http://media.korokithakis.net/images/posts/winning-candy-crush/place.jpg" alt="My Candy Crush screenshot"></a></div>

<p>The script doesn&#8217;t <em>actually</em> work without the secret key, but that&#8217;s left as an exercise for the reader. It does work for getting extra lives for free, or extra helper items/gold, though. My aim with this post is less about telling people how to cheat in the game and more about the thought process behind analyzing these things.</p>
<p><strong>NOTE:</strong> After the amazing response to this post, I feel like I need to clarify something: It&#8217;s not a bug, or a fault on the part of the developers of Candy Crush that this is possible. Spending time and effort implementing anti-cheat measures would just be wasted, since it brings them no benefit (the most cheaters can do is brag to their friends, and they most probably weren&#8217;t going to pay anyway). So, I&#8217;m not implying that King should fix this, or that they don&#8217;t know what they&#8217;re doing. If I were developing Candy Crush, I wouldn&#8217;t put in any anti-cheating code either (as I said above, it would bring no benefit). </p>
<p>I hope you enjoyed this short exploration of game APIs, and got a bit more knowledge in the process. For more posts like this, you can read my <a href="/series/winning/">&#8220;winning&#8221; series</a>, subscribe to my mailing list below to be notified of new posts, or <a href="https://twitter.com/intent/user?screen_name=Stavros">follow me on Twitter</a>.</p>
                </div>
            </div>
        </div>
        </article>
    </div>

    <hr>

    <div id="mc_embed_signup" class="styled-form">
    <form action="http://korokithakis.us7.list-manage.com/subscribe/post?u=e852d258bd7a59b880efabdc5&amp;id=d1c29513c2" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="mailing-form validate" target="_blank" novalidate>
        <h4>Subscribe to my mailing list</h4>
        <p>Did you like what you just read and want to be notified when I post more? Subscribe
        to my mailing list to get updates on my posts and other random goodies.</p>
        <div class="mc-field-group">
            <input placeholder="Email" type="email" value="" name="EMAIL" class="required email" id="mce-EMAIL">
            <input placeholder="First name" type="text" value="" name="FNAME" class="" id="mce-FNAME">
            <div class="response" id="mce-error-response" style="display:none"></div>
            <div class="response" id="mce-success-response" style="display:none"></div>
            <input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="submit-button">
        </div>
    </form>
</div>
<hr>


    <iframe src="http://www.facebook.com/plugins/like.php?href=http://www.stavros.io/posts/winning-candy-crush/&amp;layout=button_count&amp;show_faces=false&amp;width=110&amp;action=like&amp;colorscheme=light&amp;height=20" scrolling="no" frameborder="0" width="110" style="border:none; overflow:hidden; 110px; height:20px;" allowTransparency="true"></iframe>
    <g:plusone></g:plusone>
    <iframe allowtransparency="true" frameborder="0" scrolling="no" src="http://platform.twitter.com/widgets/tweet_button.html?url=http://www.stavros.io/posts/winning-candy-crush/&amp;via=stavros&amp;text=Winning%20at%20Candy%20Crush&amp;count=horizontal" width="110" height="20"></iframe>

    <hr>

    
    <div id="comment-jump" class="comments">
        <div id="comments">
            <div class="comments-wrap clearfix">
                <h3 id="comments-title">
                    <span>Join the conversation!</span>&nbsp;
                </h3>
                <div id="disqus_thread"></div>
                <script type="text/javascript">
                    var disqus_shortname = 'stavros';
                    var disqus_identifier = 'kuDpwWhcZJDrEHYQbB5jvk';
                    var disqus_title = 'Winning at Candy Crush';
                    var disqus_url = 'http://www.stavros.io/posts/winning-candy-crush/';

                    (function() {
                     var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                     dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
                     (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                     })();
                 </script>
                 <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
             </div>
         </div>
     </div>
     
</div>


                    
                    <div id="sidebar">
                        <div class="widget">
                            <div style="text-align: center">
                                <img style="border-radius: 100px; max-height: 200px; max-width:200px;" src="//gravatar.com/avatar/e42b84ae166cd4eceefdb4360a5d9357?s=128" />
                                <h3>Stavros Korokithakis</h3>
                                <h5 id="nametitle">Guy who likes computers</h5>
                            </div>
                            <p>
                            Greek. Amateur F1 driver. Technology enthusiast. Single parent. Liar.
                            </p>
                            <p>
                            Founder of <a href="http://www.stochastic.io">Stochastic Technologies</a>, a
                            software development agency, and creator of various products which you can
                            find in the <a href="http://resume.stavros.io">résumé</a>.
                            </p>
                        </div>

                        <div id="search-3" class="widget widget_search">
                            <form class="search-form clearfix">
                                <fieldset>
                                    <input type="text" class="search-form-input text" name="q" onfocus="if (this.value == 'Search the site &hellip;') {this.value = '';}" onblur="if (this.value == '') {this.value = 'Search the site &hellip;';}" value="Search the site &hellip;"/>
                                    <input type="submit" value="Search" class="submit search-button" />
                                </fieldset>
                            </form>
                        </div>

                        <div class="widget">
                            <h2 class="widgettitle">Connect with me</h2>
                            <div class="icons-widget clearfix">
                                <div id="icons" class="large-icons">
                                    <a href="mailto:hi@stavros.io" class="google-icon" title="Email me"><i class="icon-envelope-alt"></i></a>
                                    <a href="http://feeds.feedburner.com/stavrosstuff" class="google-icon" title="RSS feed"><i class="icon-rss"></i></a>
                                    <a href="https://twitter.com/Stavros" class="twitter-icon" title="Twitter"><i class="icon-twitter"></i></a>
                                    <a href="https://plus.google.com/112248633257102064185?rel=author" class="google-icon" title="Google+"><i class="icon-google-plus"></i></a>
                                    <a href="https://github.com/skorokithakis/" class="github-icon" title="Github"><i class="icon-github"></i></a>
                                    <a href="https://www.linkedin.com/in/skorokithakis" class="linkedin-icon" title="LinkedIn"><i class="icon-linkedin"></i></a>
                                    <a href="https://www.flickr.com/photos/poromenos/" class="flickr-icon" title="Flickr"><i class="icon-flickr"></i></a>
                                </div>
                            </div>
                        </div>

                        <div class="widget">
                            <h2 class="widgettitle">Recent Posts</h2>
                            <ul>
                                
                                <li>
                                <a href="/posts/store-bitcoins-safely/" title="How to safely store your bitcoins">How to safely store your bitcoins</a>
                                </li>
                                
                                <li>
                                <a href="/posts/holy-grail-backups/" title="I found the Holy Grail of backups">I found the Holy Grail of backups</a>
                                </li>
                                
                                <li>
                                <a href="/posts/arduino-powered-irrigation-system/" title="Arduino-powered irrigation system">Arduino-powered irrigation system</a>
                                </li>
                                
                                <li>
                                <a href="/posts/persona-accounts-disposable-email-addresses/" title="Mozilla Persona accounts with disposable email addresses">Mozilla Persona accounts with disposable email addresses</a>
                                </li>
                                
                                <li>
                                <a href="/posts/control-rf-devices-with-arduino/" title="Remotely controlling IR/RF devices with an Arduino">Remotely controlling IR/RF devices with an Arduino</a>
                                </li>
                                
                            </ul>
                        </div>

                        <div id="text-2" class="widget widget_text">
                            <div class="textwidget">
                                <a class="twitter-timeline" data-dnt="true" href="https://twitter.com/Stavros" data-widget-id="351341211300294656">Tweets by @Stavros</a>
                                <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.async=true;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
                            </div>
                        </div>
                    </div>
                    
                </div>
                <!-- container -->
                <!-- footer -->
            </div>
            <!-- inside wrap -->
        </div>
        
        <!-- wrapper -->
        <div class="footer-bottom">
            <div class="container clearfix">
                <div class="footer-widgets">
                    <div class="theme-name-icon">
                        <h3>Made in Greece</h3>
                    </div>
                </div>
            </div>
        </div>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
        <script async type="text/javascript" src="https://apis.google.com/js/plusone.js"></script>
        <script>
            $( document ).ready(function() {
                var sowitty = [
                "Guy who likes computers",
                "Man",
                "International person of mystery",
                "Full-heap developer",
                "Person with too much free time",
                "Unfunny",
                "Site-owner",
                "Random person",
                "Social climber",
                "Six-time solitaire champion",
                "(Fake/ironic title here)",
                "Likes solving pointless problems",
                "A simple man",
                ]
                var item = sowitty[Math.floor(Math.random()*sowitty.length)];
                $("#nametitle").text(item)
                $('body')
                .delay(500)
                .queue(
                function(next){
                    $(this).css('padding-right', '1px');
                }
                );
            });
        </script>

        <script type="text/javascript" src="/media/main-9567c8c9fb3c50cb70baabed856c0b2b4274e090.js"></script>

        
    </body>
</html>
