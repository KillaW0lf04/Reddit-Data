<!DOCTYPE html>
<html class="  ">
<head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# githubog: http://ogp.me/ns/fb/githubog#">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

  <title>Virtualenv&#39;s `bin/activate` is Doing It Wrong</title>

  <meta content="authenticity_token" name="csrf-param" />
<meta content="+8wEYp8oZcm0oBbYnmYHIoz8sMRTGhCyFDW3PfqnbfsT2qJRzKHWG+EY+Xw9B6BWCSr7bYDaqNPinGjkxHK7yw==" name="csrf-token" />
  <meta name="viewport" content="width=960">


    <link type="text/plain" rel="author" href="https://github.com/humans.txt" />
    <meta content="gist" name="octolytics-app-id" /><meta content="collector.githubapp.com" name="octolytics-host" /><meta content="collector-cdn.github.com" name="octolytics-script-host" /><meta content="1FDCC814:1CC8:7C7EAE:53B15AE7" name="octolytics-dimension-request_id" />
  <link rel="assets" href="https://gist-assets.github.com/">
  

  <link href="https://gist-assets.github.com/assets/application-fd589be2b984cbefe452bd44dea56735.css" media="screen, print" rel="stylesheet" />
  <script src="https://gist-assets.github.com/assets/application-43fec3440ac90fab50d4ef5feff0fd47.js"></script>

      <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="@github">
  <meta property="og:title" content="datagrok/gist:2199506">
  <meta property="og:type" content="githubog:gist">
  <meta property="og:url" content="https://gist.github.com/datagrok/2199506">
  <meta property="og:image" content="https://avatars0.githubusercontent.com/u/569728?s=140">
  <meta property="og:site_name" content="GitHub Gists">
  <meta property="og:description" content="Virtualenv&amp;#39;s `bin/activate` is Doing It Wrong - Gist is a simple way to share snippets of text and code with others.">
  <meta name="description" content="Virtualenv&amp;#39;s `bin/activate` is Doing It Wrong - Gist is a simple way to share snippets of text and code with others.">


</head>

<body class=" "
  data-plan="">

  <div id="wrapper">
    

    <div id="header" class="header header-logged-out">
      <div class="container" class="clearfix">
        <a class="header-logo-wordmark" href="https://gist.github.com/"></a>

        <div class="header-actions">
          <a class="button primary" href="https://github.com/signup?return_to=gist">Sign up for a GitHub account</a>
          <a class="button" href="https://gist.github.com/login?return_to=%2Fdatagrok%2F2199506" data-skip-pjax>Sign in</a>
        </div>
        <div class="divider-vertical"></div>
        <div class="topsearch">
  <form id="top_search_form" action="/search" data-pjax-remote=push accept-charset="UTF-8">
    <div class="search">
      <input type="text" class="search js-search js-navigation-enable " name="q" placeholder="Search&#x2026;" data-hotkey="/" autocomplete=off autocorrect=off value="" >

    </div>
    <div class="divider-vertical"></div>
  </form>
  <ul class="top-nav">
    <li class="explore"><a href="/discover">All Gists</a></li>
  </ul>
</div>

      </div>
    </div>

    <div class="site-content" id="js-pjax-container" data-pjax-container>
      <div id="js-flash-container" class="site-container js-site-container" data-url="/datagrok/2199506">
  
  

<meta content="true" name="octolytics-dimension-public" /><meta content="2199506" name="octolytics-dimension-gist_id" /><meta content="2199506" name="octolytics-dimension-gist_name" /><meta content="false" name="octolytics-dimension-anonymous" /><meta content="569728" name="octolytics-dimension-owner_id" /><meta content="datagrok" name="octolytics-dimension-owner_login" /><meta content="false" name="octolytics-dimension-forked" />

<div class="pagehead repohead">
  <div class="container">
    <div class="title-actions-bar">
      <ul class="pagehead-actions">


      </ul>
      <h1 itemscope itemtype="http://data-vocabulary.org/Breadcrumb" class="entry-title public" >
  <span class="repo-label"><span class="" >public</span></span>
  <span class="mega-octicon octicon-gist" ></span>
  <div class="meta">
    <div class="gist-author">
      <img src="https://avatars0.githubusercontent.com/u/569728?s=140" width="26" height="26">
        <span class="author vcard">
            <span itemprop="title"><a href="/datagrok">datagrok</a></span>
        </span> /
      <strong><a href="/datagrok/2199506" class="js-current-repository">gist:2199506</a></strong>
    </div>
    <div class="gist-timestamp">
        <span class="datetime">Last active <time datetime="2014-06-26T15:10:06Z" is="relative-time">June 26, 2014</time></span>
    </div>
</h1>

    </div>

  </div>
</div>


<div class="container">
  <div class="gist js-gist-container gist-with-sidebar with-full-navigation"
    data-version="df56e7ae35449b0b27035fa8be00e24bc49490bd"
    data-created="false"
    data-updated="false">

      <div class="gist-sidebar clearfix">
  <div class="sunken-menu vertical-right repo-nav js-repo-nav js-repository-container-pjax js-octicon-loaders">
    <div class="sunken-menu-contents">
      <ul class="sunken-menu-group">
        <li class="tooltipped tooltipped-w" aria-label="Code">
          <a aria-label="Code" class="sunken-menu-item selected" data-pjax="true" href="/datagrok/2199506">
            <span class="octicon octicon-code"></span> <span class="full-word">Code</span>
            <img alt="" class="mini-loader" height="16" src="https://gist-assets.github.com/assets/spinners/octocat-spinner-32-4ae22f00973f33151cb92eea73616c5c.gif" width="16" />
</a>        </li>

          <li class="tooltipped tooltipped-w" aria-label="Revisions">
            <a aria-label="Revisions" class="sunken-menu-item" data-pjax="true" href="/datagrok/2199506/revisions">
              <span class="octicon octicon-git-commit"></span> <span class="full-word">Revisions</span>
              <img alt="" class="mini-loader" height="16" src="https://gist-assets.github.com/assets/spinners/octocat-spinner-32-4ae22f00973f33151cb92eea73616c5c.gif" width="16" />
              <span class='counter'>8</span>
</a>          </li>

          <li class="tooltipped tooltipped-w" aria-label="Stars">
            <a aria-label="Stars" class="sunken-menu-item" data-pjax="true" href="/datagrok/2199506/stars">
              <span class="octicon octicon-star"></span> <span class="full-word">Stars</span>
              <img alt="" class="mini-loader" height="16" src="https://gist-assets.github.com/assets/spinners/octocat-spinner-32-4ae22f00973f33151cb92eea73616c5c.gif" width="16" />
              <span class='counter'>184</span>
</a>          </li>

          <li class="tooltipped tooltipped-w" aria-label="Forks">
            <a aria-label="Forks" class="sunken-menu-item" data-pjax="true" href="/datagrok/2199506/forks">
              <span class="octicon octicon-git-branch"></span> <span class="full-word">Forks</span>
              <img alt="" class="mini-loader" height="16" src="https://gist-assets.github.com/assets/spinners/octocat-spinner-32-4ae22f00973f33151cb92eea73616c5c.gif" width="16" />
              <span class='counter'>12</span>
</a>          </li>
      </ul>
    </div><!-- /.sunken-menu-group -->
  </div><!-- /.sunken-menu-contents -->

  <div class="only-with-full-nav">

    <div class="embed-url open" style="display: block;">
      <h3><strong>Embed</strong> URL</h3>
      <div class="clone-url-box">
        <input type="text" class="clone js-url-field" value="&lt;script src=&quot;https://gist.github.com/datagrok/2199506.js&quot;&gt;&lt;/script&gt;" readonly="readonly">
        <span class="url-box-clippy">
          <button aria-label="copy to clipboard" class="js-zeroclipboard minibutton zeroclipboard-button" data-clipboard-text="&lt;script src=&quot;https://gist.github.com/datagrok/2199506.js&quot;&gt;&lt;/script&gt;" data-copied-hint="copied!" type="button"><span class="octicon octicon-clippy"></span></button>
        </span>
      </div>
    </div>
    <p class="clone-options"></p>

      
<div class="clone-url open" data-protocol-type="http" data-url="https://gist.github.com/2199506.git">
  <h3><strong>HTTPS</strong> clone URL</h3>
  <div class="clone-url-box">
    <input type="text" class="clone url-field js-url-field" value="https://gist.github.com/2199506.git" readonly="readonly">
    <span class="url-box-clippy">
      <button aria-label="copy to clipboard" class="js-zeroclipboard minibutton zeroclipboard-button" data-clipboard-text="https://gist.github.com/2199506.git" data-copied-hint="copied!" type="button"><span class="octicon octicon-clippy"></span></button>
    </span>
  </div>
</div>

  
<div class="clone-url " data-protocol-type="ssh" data-url="git@gist.github.com:/2199506.git">
  <h3><strong>SSH</strong> clone URL</h3>
  <div class="clone-url-box">
    <input type="text" class="clone url-field js-url-field" value="git@gist.github.com:/2199506.git" readonly="readonly">
    <span class="url-box-clippy">
      <button aria-label="copy to clipboard" class="js-zeroclipboard minibutton zeroclipboard-button" data-clipboard-text="git@gist.github.com:/2199506.git" data-copied-hint="copied!" type="button"><span class="octicon octicon-clippy"></span></button>
    </span>
  </div>
</div>


<p class="clone-options">You can clone with
      <a href="#" class="js-clone-selector" data-protocol="http">HTTPS</a>
      or <a href="#" class="js-clone-selector" data-protocol="ssh">SSH</a>.
</p>


    <a aria-label="Download gist:2199506 as a zip file" class="minibutton sidebar-button" href="/datagrok/2199506/download" rel="nofollow" title="Download gist:2199506 as a zip file">
      <span class="octicon octicon-cloud-download"></span>
      Download Gist
</a>  </div><!-- /.only-with-full-nav -->

</div>


    <div class="gist-content">
          <div class="gist-meta">
            <div class="gist-description">
              <p><div>Virtualenv's `bin/activate` is Doing It Wrong</div></p>
            </div>
          </div>

      <div class="files">
            <div id="file-gistfile1-md" class="file ">
    <a href="/datagrok/2199506" class="link-overlay">
    <span class="link">View <strong>gist:2199506</strong> <span class="octicon octicon-arrow-right"></span></span>
  </a>
  <div class="meta clearfix">
    <div class="info file-name">
      <span class="icon">
        <b class="octicon octicon-gist"></b>
      </span>
      <a aria-label="Permalink" href="#file-gistfile1-md" class="tooltipped tooltipped-s permalink"><strong class="file-name js-selectable-text">gistfile1.md</strong></a>
    </div>
    <div class="actions">
      <div class="button-group">
        <a aria-label="View Raw"
          href="/datagrok/2199506/raw/e9dc8eb855e3919a84f37975164d5da6cba74364/gistfile1.md"
          data-skip-pjax class="minibutton raw-url js-view-raw">Raw</a>
      </div>
    </div>
  </div>
  <div class="suppressed">
    <a class="js-show-suppressed-file">File suppressed. Click to show.</a>
  </div>
  <div class="blob-wrapper data type-markdown js-blob-data">
    

    <div class="readme context-loader-container context-loader-overlay">
      <article class="markdown-body js-file "
        data-task-list-update-url="https://gist.github.com/datagrok/2199506/file/gistfile1.md">
        <h1>
<a name="user-content-virtualenvs-binactivate-is-doing-it-wrong" class="anchor" href="#virtualenvs-binactivate-is-doing-it-wrong" rel="noreferrer"><span class="octicon octicon-link"></span></a>Virtualenv's <code>bin/activate</code> is Doing It Wrong</h1>

<p>I'm a Python programmer and frequently work with the excellent <a href="http://www.virtualenv.org" rel="noreferrer">virtualenv</a> tool by Ian Bicking.</p>

<p>Virtualenv is a great tool on the whole but there is one glaring problem: the <code>activate</code> script that virtualenv provides as a convenience to enable its functionality requires you to <em>source</em> it with your shell to invoke it. The <code>activate</code> script sets some environment variables in your <em>current</em> environment and defines for you a <code>deactivate</code> <em>shell function</em> which will (attempt to) help you to undo those changes later.</p>

<p>This pattern is abhorrently wrong and un-unix-y. <code>activate</code> should instead do what <code>ssh-agent</code> does, and launch a sub-shell or sub-command with a modified environment.</p>

<h2>
<a name="user-content-problems" class="anchor" href="#problems" rel="noreferrer"><span class="octicon octicon-link"></span></a>Problems</h2>

<p>The approach of modifying the user's current environment suffers from a number of problems:</p>

<ul class="task-list">
<li>It breaks if you don't use a supported shell.</li>
<li>A separate activate script must be maintained for each supported shell syntax.</li>
<li>What do you do if you use no shell at all? (I.E. run programs in a virtualenv from a GUI.)</li>
<li>If the <code>deactivate</code> script fails to un-set an environment variable, it may contaminate other environments.</li>
<li>If you want to edit <code>deactivate</code> or any other function sourced into your environment, you have to kill your shell and re-source the script to see the changes take effect.</li>
<li>If you change the current directory from one to another virtual environment and forget to carefully <code>deactivate</code> and <code>activate</code> as you do so, you may end up using libraries from or making changes in the wrong one!</li>
</ul>

<p>Virtualenv's <code>activate</code> suffers from a number of other warts as well:</p>

<ul class="task-list">
<li>
<p>You can't simply run the script; you have to learn and employ your shell's "source this script" builtin. Many non-experts frequently stumble over this distinction. Doing away with the recommendation to source a shell script should make virtualenv easier to use.</p>

<pre><code># This file must be used with "source bin/activate" *from bash*
# you cannot run it directly
</code></pre>
</li>
<li><p>In an attempt to preserve the user's old environment, it declares _OLD_VIRTUAL_PATH, _OLD_VIRTUAL_PYTHONHOME, and _OLD_VIRTUAL_PS1, and must define how to restore them upon deactivation. If you happen to want to modify <code>activate</code> to override more variables specific to your environment, you have to do the same.</p></li>
<li><p>Its default means to display whether or not a virtual environment is currently active (modifying the user's PS1 variable) is fragile. On Debian and Ubuntu boxes it becomes confusing if one enters a subshell, or uses a tool like <code>screen</code> or <code>tmux</code>.</p></li>
<li><p>It is not executable, and not meant to be used as an executable, yet it lives in a a directory named <code>bin</code>.</p></li>
</ul>

<h2>
<a name="user-content-doing-it-right" class="anchor" href="#doing-it-right" rel="noreferrer"><span class="octicon octicon-link"></span></a>Doing It Right</h2>

<p>Entering and exiting a virtual environment should be like using <code>ssh</code> to connect to another machine. When you're done, a simple <code>exit</code> should restore you to your original, unmodified environment.</p>

<p>An example of a program that does this the Right Way is <code>ssh-agent</code>. In order to communicate the port that it uses to other programs, it must set some variables into the environment. It provides an option to do what virtualenv does, but the better way is to simply ask <code>ssh-agent</code> to launch your command for you, with a modified environment. <code>ssh-agent $SHELL</code> will launch a sub-shell for you with its environment already modified appropriately for <code>ssh-agent</code>. Most Debian and Ubuntu machines even launch X11 this way; see <code>/etc/X11/Xsession.d/90x11-common_ssh-agent</code>.</p>

<p>Another advantage to the subshell approach is that it is far simpler than the hoops virtualenv jumps through to activate and deactivate an environment. There's no need to set _OLD_ variables since the former environment is restored automatically. There's no need for a <code>deactivate</code> function.</p>

<p>Finally, employing a prompt context variable instead of messing with PS1 would allow the user to define how that information is presented.</p>

<h2>
<a name="user-content-a-better-activate-inve" class="anchor" href="#a-better-activate-inve" rel="noreferrer"><span class="octicon octicon-link"></span></a>A better <code>activate</code>: "<code>inve</code>"</h2>

<p>To differentiate, I'm calling this approach "inve" as in "inside this virtual environment, ..." I'll happily take name suggestions.</p>

<h3>
<a name="user-content-launching-a-subcommand-with-a-modified-environment" class="anchor" href="#launching-a-subcommand-with-a-modified-environment" rel="noreferrer"><span class="octicon octicon-link"></span></a>Launching a subcommand with a modified environment</h3>

<p>How do we make an executable like <code>ssh-agent</code> that launches a subcommand with a modified environment? Easy. Call this <code>my_launcher</code>:</p>

<pre><code>#!/bin/sh
export MY_VAR=xyz
exec "$@"
</code></pre>

<p>Calling "my_launcher firefox" will launch firefox with MY_VAR set to 'xyz' in its environment. The environment where "my_launcher" is called from will not be disturbed.</p>

<h3>
<a name="user-content-simplifying-activate" class="anchor" href="#simplifying-activate" rel="noreferrer"><span class="octicon octicon-link"></span></a>Simplifying <code>activate</code>
</h3>

<p>Let's now examine <code>bin/activate</code> to see what we can throw away if we assume that the system takes care of restoring the environment for us when we <code>exit</code>. We don't need the <code>deactivate</code> shell function at all. We don't need any _OLD_ variables. We don't mess with the prompt. What's left?</p>

<pre><code>export VIRTUAL_ENV="/home/mike/var/virtualenvs/myvirtualenv"
export PATH="$VIRTUAL_ENV/bin:$PATH"
unset PYTHON_HOME
</code></pre>

<p>That's it. Three lines, down from 76. Down from 187 if you count all variants for other shells.</p>

<p>Wrap this with the launcher technique above, call it <code>inve</code>, and <code>./bin/inve $SHELL</code> spawns a new subshell in the active virtualenv. What if you want a no-argument invocation to default to spawning an activated shell? This is the entire script:</p>

<pre><code>#!/bin/sh
export VIRTUAL_ENV="/home/mike/var/virtualenvs/myvirtualenv"
export PATH="$VIRTUAL_ENV/bin:$PATH"
unset PYTHON_HOME
exec "${@:-$SHELL}"
</code></pre>

<p>Now <code>bin/inve</code> does what <code>bin/activate</code> <em>should</em>. By the way: this works for <em>all shells</em>. bash, zsh, csh, fish, ksh, and anything else, with one script.</p>

<h2>
<a name="user-content-more-hacks" class="anchor" href="#more-hacks" rel="noreferrer"><span class="octicon octicon-link"></span></a>More hacks</h2>

<h3>
<a name="user-content-re-enabling-current-environment-modification" class="anchor" href="#re-enabling-current-environment-modification" rel="noreferrer"><span class="octicon octicon-link"></span></a>Re-enabling current environment modification</h3>

<p>Some users source <code>bin/activate</code> from within their own shell scripts, which I don't find quite as offensive.</p>

<p><code>ssh-agent</code> also supports this style of use. It too has to deal with the syntax differences between shells to do so. It's not hard to enable this; here's one proposal.</p>

<pre><code>#!/bin/sh

# As above, do what's needed to activate
export VIRTUAL_ENV="/home/mike/var/virtualenvs/myvirtualenv"
export PATH="$VIRTUAL_ENV/bin:$PATH"
unset PYTHON_HOME

# If the first argument is -s or -c, do what ssh-agent does
if [ "$1" = "-s" ]; then cat &lt;&lt;- DONE
    export VIRTUAL_ENV="$VIRTUAL_ENV";
    export PATH="$PATH";
    unset PYTHON_HOME;
DONE
elif [ "$1" = "-c" ]; then cat &lt;&lt;- DONE
    setenv VIRTUAL_ENV "$VIRTUAL_ENV";
    setenv PATH "$PATH";
    unset PYTHON_HOME;
DONE

# Otherwise, launch a shell or subcommand
else
    exec "${@:-$SHELL}"
fi
</code></pre>

<p>Now <code>inve</code> supports the same -s and -c options that <code>ssh-agent</code> does. Where one might previously have written a script like this:</p>

<pre><code>#!/bin/sh
source ./activate
... (commands) ...
</code></pre>

<p>One would now write instead:</p>

<pre><code>#!/bin/sh
eval `./inve -s`
... (commands) ...
</code></pre>

<p>Or, for csh:</p>

<pre><code>#!/bin/csh
eval `./inve -c`
... (commands) ...
</code></pre>

<p>Unfortunately, I don't know if this "eval the output of a command" technique works for all possible shells.</p>

<h3>
<a name="user-content-a-system-level-inve" class="anchor" href="#a-system-level-inve" rel="noreferrer"><span class="octicon octicon-link"></span></a>A system-level <code>inve</code>
</h3>

<p>I find it convenient to employ a "system-level" <code>inve</code> script that lives in my system <code>$PATH</code>, that I can run from anywhere within any virtual environment, and without specifying the full path to 'ENV/bin/inve'. This goes against the intention that "virtualenvs are self-sufficient once created" so I'm not advocating this technique be used <em>instead</em> of <code>ENV/bin/inve</code>.</p>

<pre><code>#!/bin/sh

# inve
#
# usage: inve [COMMAND [ARGS]]
#
# For use with Ian Bicking's virtualenv tool. Attempts to find the root of
# a virtual environment. Then, executes COMMAND with ARGS in the context of
# the activated environment. If no COMMAND is given, activate defaults to a
# subshell.

# First, locate the root of the current virtualenv
while [ "$PWD" != "/" ]; do
    # Stop here if this the root of a virtualenv
    if [ \
        -x bin/python \
        -a -e lib/python*/site.py \
        -a -e include/python*/Python.h ]
    then
        break
    fi
    cd ..
done
if [ "$PWD" = "/" ]; then
    echo "Could not activate: no virtual environment found." &gt;&amp;2
    exit 1
fi

# Activate
export VIRTUAL_ENV="$PWD"
export PATH="$VIRTUAL_ENV/bin:$PATH"
unset PYTHON_HOME
exec "${@:-$SHELL}"
</code></pre>

<p>Until an <code>inve</code>-like script gets created in virtualenv <code>bin/</code> directories, this system-level script will allow you to immediately use the subshell technique with all existing virtualenvs. If ever the <code>inve</code> script does land in virtualenv's <code>bin/</code>, this system level script could be simply a helper that searches for and invokes <code>ENV/bin/inve</code>:</p>

<pre><code># Locate the root of the current virtualenv
... (same as above) ...
# Activate
exec bin/inve "$@"
</code></pre>

<h3>
<a name="user-content-dont-mess-with-my-prompt" class="anchor" href="#dont-mess-with-my-prompt" rel="noreferrer"><span class="octicon octicon-link"></span></a>Don't mess with my prompt</h3>

<p>But what about the prompt? Build a PS1 that does the right thing everywhere without needing to be modified to suit a particular purpose. I tend to have a function that collects all the context info this way, in my .bashrc:</p>

<pre><code>function ps1_context {
    # For any of these bits of context that exist, display them and append
    # a space.
    virtualenv=`basename "$VIRTUAL_ENV"`
    for v in "$debian_chroot" "$virtualenv" "$PS1_CONTEXT"; do
        echo -n "${v:+$v }"
    done
}

export PS1="$(ps1_context)"'\u@\h:\w\$ '
</code></pre>

<p>This lets the user control their PS1 and it works everywhere, no matter how many subshells or screen sessions you're nested into. This is the only piece that has to be customized per-shell.</p>

<h2>
<a name="user-content-conclusion" class="anchor" href="#conclusion" rel="noreferrer"><span class="octicon octicon-link"></span></a>Conclusion</h2>

<p>While using <code>activate</code> is intended only a convenience and is <a href="https://github.com/pypa/virtualenv/issues/247#issuecomment-4853286" rel="noreferrer">not necessary to work within a virtual environment</a>, most of programmers I know treat it as a black box and never do without it. I suspect that, in part, the complexity of the script is what prevents more programmers from avoiding it.</p>

<p>Perhaps the worst part about a popular, useful tool like virtualenv using this antipattern is that many other programmers are adopting it as normative and using it for their own work. <a href="http://www.doughellmann.com/projects/virtualenvwrapper/" rel="noreferrer">virtualenvwrapper</a> and <a href="https://github.com/dustinlacewell/capn" rel="noreferrer">dustinlacewell/capn</a> are two examples. Stop doing this, everyone!</p>

      </article>
    </div>



  </div>
</div>


        <div class="discussion-timeline js-quote-selection-container">

          <div class="js-discussion">
            
<div class="timeline-comment-wrapper js-comment-container">
  <a href="/metamatt"><img class="timeline-comment-avatar" src="https://avatars3.githubusercontent.com/u/313893?s=140" width="48" height="48"></a>
  <div class="timeline-comment ">
    <div id="comment-249406" class="comment js-comment js-task-list-container" data-body-version="d8d1ea419088c58284bcc8f571a93583">
      <div class="timeline-comment-header">



        <div class="timeline-comment-header-text">
          <strong>
            <a class="author" href="/metamatt">metamatt</a>
          </strong>

          commented

            <a href="#comment-249406" class="timestamp"><time datetime="2012-04-11T00:50:53Z" is="relative-time">April 11, 2012</time></a>
        </div>
      </div>

    <div class="comment-content">

      <div class="edit-comment-hide">
        <div class="comment-body markdown-body  js-comment-body">
            <p>Yes. Thank you.</p>
        </div>
      </div>

    </div>
  </div>
  </div>
  </div>

<div class="timeline-comment-wrapper js-comment-container">
  <a href="/datagrok"><img class="timeline-comment-avatar" src="https://avatars0.githubusercontent.com/u/569728?s=140" width="48" height="48"></a>
  <div class="timeline-comment owner-comment">
    <div id="comment-249538" class="comment js-comment js-task-list-container" data-body-version="5444376ec463ce9fd4fe003fd24284ee">
      <div class="timeline-comment-header">

          <span class="timeline-comment-label">Owner</span>


        <div class="timeline-comment-header-text">
          <strong>
            <a class="author" href="/datagrok">datagrok</a>
          </strong>

          commented

            <a href="#comment-249538" class="timestamp"><time datetime="2012-04-11T05:52:17Z" is="relative-time">April 11, 2012</time></a>
        </div>
      </div>

    <div class="comment-content">

      <div class="edit-comment-hide">
        <div class="comment-body markdown-body  js-comment-body">
            <p>I've taken this rant to the virtualenv maintainers and now I'm working on a patch that might eventually get accepted upstream! :-D Just need a bit more time to improve it.</p>

<p><a href="https://github.com/pypa/virtualenv/issues/247" rel="noreferrer">https://github.com/pypa/virtualenv/issues/247</a><br>
<a href="https://groups.google.com/d/topic/python-virtualenv/XzI8GStvKDw/discussion" rel="noreferrer">https://groups.google.com/d/topic/python-virtualenv/XzI8GStvKDw/discussion</a></p>
        </div>
      </div>

    </div>
  </div>
  </div>
  </div>

<div class="timeline-comment-wrapper js-comment-container">
  <a href="/mk270"><img class="timeline-comment-avatar" src="https://avatars0.githubusercontent.com/u/923403?s=140" width="48" height="48"></a>
  <div class="timeline-comment ">
    <div id="comment-784038" class="comment js-comment js-task-list-container" data-body-version="20b8b99d2c68cdbfd3bd8ff0f441d3b2">
      <div class="timeline-comment-header">



        <div class="timeline-comment-header-text">
          <strong>
            <a class="author" href="/mk270">mk270</a>
          </strong>

          commented

            <a href="#comment-784038" class="timestamp"><time datetime="2013-02-27T11:10:53Z" is="relative-time">February 27, 2013</time></a>
        </div>
      </div>

    <div class="comment-content">

      <div class="edit-comment-hide">
        <div class="comment-body markdown-body  js-comment-body">
            <p>I think virtualenv is goodish, but you're write that it's not Unix enough.</p>

<p>A particular gripe is that . bin/activate seems to break when called from a shell script running with</p>

<p>set -eu</p>

<p>I'd like to be able to use -eu as it makes bash scripting a lot less error-prone, but virtualenv's active doesn't want to know</p>
        </div>
      </div>

    </div>
  </div>
  </div>
  </div>

<div class="timeline-comment-wrapper js-comment-container">
  <a href="/NewbiZ"><img class="timeline-comment-avatar" src="https://avatars3.githubusercontent.com/u/224676?s=140" width="48" height="48"></a>
  <div class="timeline-comment ">
    <div id="comment-784080" class="comment js-comment js-task-list-container" data-body-version="1131d7c56edf83e5083c10e982da1da7">
      <div class="timeline-comment-header">



        <div class="timeline-comment-header-text">
          <strong>
            <a class="author" href="/NewbiZ">NewbiZ</a>
          </strong>

          commented

            <a href="#comment-784080" class="timestamp"><time datetime="2013-02-27T13:07:39Z" is="relative-time">February 27, 2013</time></a>
        </div>
      </div>

    <div class="comment-content">

      <div class="edit-comment-hide">
        <div class="comment-body markdown-body  js-comment-body">
            <p>I don't really feel like <code>activate</code> is a real problem. Most of the time, you just end up spawning a bash before entering a virtualenv, and that's it. If you're lazy:<br>
<code>alias inve='bash --init-file '</code></p>

<p>Btw, you often end up automating the use of virtualenvs (e.g. using the excellent <code>fabric</code> library) and dealing with a single <code>source</code> is way easier than using a subshell and pipe once-more-escaped commands to it.</p>
        </div>
      </div>

    </div>
  </div>
  </div>
  </div>

<div class="timeline-comment-wrapper js-comment-container">
  <a href="/Apreche"><img class="timeline-comment-avatar" src="https://avatars1.githubusercontent.com/u/5847?s=140" width="48" height="48"></a>
  <div class="timeline-comment ">
    <div id="comment-784095" class="comment js-comment js-task-list-container" data-body-version="28dbbc50d81b5fedb9d17ca252b3c363">
      <div class="timeline-comment-header">



        <div class="timeline-comment-header-text">
          <strong>
            <a class="author" href="/Apreche">Apreche</a>
          </strong>

          commented

            <a href="#comment-784095" class="timestamp"><time datetime="2013-02-27T13:24:32Z" is="relative-time">February 27, 2013</time></a>
        </div>
      </div>

    <div class="comment-content">

      <div class="edit-comment-hide">
        <div class="comment-body markdown-body  js-comment-body">
            <p>I agree. But the real problem I have with virtualenv is how it works on a non-interactive shell. What if I write a Python program using a virtualenv, and then I want to execute it from init.d, supervisor, upstart, cron, etc.? Those can't activate. </p>

<p>The trick I have been using is to hardcode the full path to the virtualenv python binary. For example in a cron I will</p>

<p>*/5 * * * * /home/username/.virtualenv/project/bin/python /home/username/src/project/program.py</p>

<p>In a perfect world it would look something more like this</p>

<p>*/5 * * * * virtualenv_activate projectname -e /home/username/src/project/program.py</p>
        </div>
      </div>

    </div>
  </div>
  </div>
  </div>

<div class="timeline-comment-wrapper js-comment-container">
  <a href="/jdawsongit"><img class="timeline-comment-avatar" src="https://avatars3.githubusercontent.com/u/503953?s=140" width="48" height="48"></a>
  <div class="timeline-comment ">
    <div id="comment-784131" class="comment js-comment js-task-list-container" data-body-version="8d1ac92f0c64897600228b8905c0d0aa">
      <div class="timeline-comment-header">



        <div class="timeline-comment-header-text">
          <strong>
            <a class="author" href="/jdawsongit">jdawsongit</a>
          </strong>

          commented

            <a href="#comment-784131" class="timestamp"><time datetime="2013-02-27T14:41:56Z" is="relative-time">February 27, 2013</time></a>
        </div>
      </div>

    <div class="comment-content">

      <div class="edit-comment-hide">
        <div class="comment-body markdown-body  js-comment-body">
            <p><code>activate</code> also modifies <code>$LD_LIBRARY_PATH</code>. <code>inve</code> needs to set that too.</p>

<p>EDIT:</p>

<p>Standard <code>activate</code> does <em>not</em> modify <code>$LD_LIBRARY_PATH</code>. I just remembered that's something I patched in. Where I work, we use the virtual Python environment to be the general container for all the stuff our application needs. We include <code>gevent</code> in our virtual environment, so we also put its dependencies (like <code>libevent</code>, needed by our version of <code>gevent</code>) in the virtual environment under the <code>$VIRTUAL_ENV/lib</code>. It's worked out well for us. It lets us deploy new virtual environment snapshots with libraries upgraded as needed. The virtual environment is the atomic unit of deployment, complete with all libraries and their dependencies. I wonder why this isn't common practice.</p>
        </div>
      </div>

    </div>
  </div>
  </div>
  </div>

<div class="timeline-comment-wrapper js-comment-container">
  <a href="/tclancy"><img class="timeline-comment-avatar" src="https://avatars2.githubusercontent.com/u/67803?s=140" width="48" height="48"></a>
  <div class="timeline-comment ">
    <div id="comment-784162" class="comment js-comment js-task-list-container" data-body-version="2d4d1c9f0d1ec6b35de3a064b3308d14">
      <div class="timeline-comment-header">



        <div class="timeline-comment-header-text">
          <strong>
            <a class="author" href="/tclancy">tclancy</a>
          </strong>

          commented

            <a href="#comment-784162" class="timestamp"><time datetime="2013-02-27T15:25:53Z" is="relative-time">February 27, 2013</time></a>
        </div>
      </div>

    <div class="comment-content">

      <div class="edit-comment-hide">
        <div class="comment-body markdown-body  js-comment-body">
            <p>Not to be a pain, but to speak up for the great unwashed, please don't forget about Windows in the drive to be more Unix-y. It's possible some of the problems come from Windows compatibility as activate (well, activate.bat) is an executable on Windows.</p>
        </div>
      </div>

    </div>
  </div>
  </div>
  </div>

<div class="timeline-comment-wrapper js-comment-container">
  <a href="/bbarrows"><img class="timeline-comment-avatar" src="https://avatars1.githubusercontent.com/u/431741?s=140" width="48" height="48"></a>
  <div class="timeline-comment ">
    <div id="comment-784254" class="comment js-comment js-task-list-container" data-body-version="099793f6bb371ca4515c4a66fd35f2d7">
      <div class="timeline-comment-header">



        <div class="timeline-comment-header-text">
          <strong>
            <a class="author" href="/bbarrows">bbarrows</a>
          </strong>

          commented

            <a href="#comment-784254" class="timestamp"><time datetime="2013-02-27T17:22:57Z" is="relative-time">February 27, 2013</time></a>
        </div>
      </div>

    <div class="comment-content">

      <div class="edit-comment-hide">
        <div class="comment-body markdown-body  js-comment-body">
            <p>This is pretty nice, I always put my virtual env in _venv so I wrote an alias that would do something like:<br>
alias venv='source _venv/bin/activate'<br>
but I like this much better.</p>

<p>One thing I do think would be nice is modifying the shell prompt. For example, how virtual env prepends to the users prompt after activating. Its nice having that visual reminder so that you know which shells are actively using which virtual environment..</p>
        </div>
      </div>

    </div>
  </div>
  </div>
  </div>

<div class="timeline-comment-wrapper js-comment-container">
  <a href="/vishnubob"><img class="timeline-comment-avatar" src="https://avatars2.githubusercontent.com/u/188410?s=140" width="48" height="48"></a>
  <div class="timeline-comment ">
    <div id="comment-784357" class="comment js-comment js-task-list-container" data-body-version="45610d2c21622424cdc1d3b9bd9bcb5a">
      <div class="timeline-comment-header">



        <div class="timeline-comment-header-text">
          <strong>
            <a class="author" href="/vishnubob">vishnubob</a>
          </strong>

          commented

            <a href="#comment-784357" class="timestamp"><time datetime="2013-02-27T18:28:18Z" is="relative-time">February 27, 2013</time></a>
        </div>
      </div>

    <div class="comment-content">

      <div class="edit-comment-hide">
        <div class="comment-body markdown-body  js-comment-body">
            <p>ssh-agent(1) doesn't start a sub-shell.  It generates environment variables that you source into your current environment.  dircolors(1) does the same thing.  I would argue that the pattern of modifying your environment in place is <em>very</em> consistent with how UNIX programmers have solved this problem.  Sub-shells are simply an alternative.</p>

<p>You make a lot of great points about the simplicity of solving this problem with sub-shells, and I completely agree that it should be made available as an option -- but nothing about modifying your environment in place is "abhorrently wrong and un-unix-y".</p>
        </div>
      </div>

    </div>
  </div>
  </div>
  </div>

<div class="timeline-comment-wrapper js-comment-container">
  <a href="/selenamarie"><img class="timeline-comment-avatar" src="https://avatars0.githubusercontent.com/u/54803?s=140" width="48" height="48"></a>
  <div class="timeline-comment ">
    <div id="comment-784572" class="comment js-comment js-task-list-container" data-body-version="52266820816ca89c79f7db522c03fce5">
      <div class="timeline-comment-header">



        <div class="timeline-comment-header-text">
          <strong>
            <a class="author" href="/selenamarie">selenamarie</a>
          </strong>

          commented

            <a href="#comment-784572" class="timestamp"><time datetime="2013-02-27T19:22:58Z" is="relative-time">February 27, 2013</time></a>
        </div>
      </div>

    <div class="comment-content">

      <div class="edit-comment-hide">
        <div class="comment-body markdown-body  js-comment-body">
            <p>An incremental name suggestion for 'inve' - 'intove' is a little more evocative. </p>

<p>Thanks for a great perspective, code and attention to UX issues that benefit everyone when fixed. :)</p>
        </div>
      </div>

    </div>
  </div>
  </div>
  </div>

<div class="timeline-comment-wrapper js-comment-container">
  <a href="/e000"><img class="timeline-comment-avatar" src="https://avatars3.githubusercontent.com/u/495648?s=140" width="48" height="48"></a>
  <div class="timeline-comment ">
    <div id="comment-784958" class="comment js-comment js-task-list-container" data-body-version="71a0bbef111a5a114a9af593424585b9">
      <div class="timeline-comment-header">



        <div class="timeline-comment-header-text">
          <strong>
            <a class="author" href="/e000">e000</a>
          </strong>

          commented

            <a href="#comment-784958" class="timestamp"><time datetime="2013-02-28T04:07:26Z" is="relative-time">February 28, 2013</time></a>
        </div>
      </div>

    <div class="comment-content">

      <div class="edit-comment-hide">
        <div class="comment-body markdown-body  js-comment-body">
            <p>Thanks! I've been super annoyed having to switch from fishfish to bash to use virtualenv. :3</p>
        </div>
      </div>

    </div>
  </div>
  </div>
  </div>

<div class="timeline-comment-wrapper js-comment-container">
  <a href="/datagrok"><img class="timeline-comment-avatar" src="https://avatars0.githubusercontent.com/u/569728?s=140" width="48" height="48"></a>
  <div class="timeline-comment owner-comment">
    <div id="comment-784972" class="comment js-comment js-task-list-container" data-body-version="baa15aaf11a6cdbe2e08e21d9c7b9511">
      <div class="timeline-comment-header">

          <span class="timeline-comment-label">Owner</span>


        <div class="timeline-comment-header-text">
          <strong>
            <a class="author" href="/datagrok">datagrok</a>
          </strong>

          commented

            <a href="#comment-784972" class="timestamp"><time datetime="2013-02-28T04:50:58Z" is="relative-time">February 28, 2013</time></a>
        </div>
      </div>

    <div class="comment-content">

      <div class="edit-comment-hide">
        <div class="comment-body markdown-body  js-comment-body">
            <p>Wow, almost a year after I wrote this thing it has been receiving a lot of attention on Hacker News (<a href="http://news.ycombinator.com/item?id=5239657" rel="noreferrer">link</a>) and Reddit (<a href="http://www.reddit.com/r/Python/comments/19bcqv/virtualenvs_binactivate_is_doing_it_wrong/" rel="noreferrer">link</a>). I'm very grateful for all the feedback and intend to incorporate as much as I can.</p>
        </div>
      </div>

    </div>
  </div>
  </div>
  </div>

<div class="timeline-comment-wrapper js-comment-container">
  <a href="/NewbiZ"><img class="timeline-comment-avatar" src="https://avatars3.githubusercontent.com/u/224676?s=140" width="48" height="48"></a>
  <div class="timeline-comment ">
    <div id="comment-785220" class="comment js-comment js-task-list-container" data-body-version="e85310d11d8931c6a03054e4964ebf4f">
      <div class="timeline-comment-header">



        <div class="timeline-comment-header-text">
          <strong>
            <a class="author" href="/NewbiZ">NewbiZ</a>
          </strong>

          commented

            <a href="#comment-785220" class="timestamp"><time datetime="2013-02-28T13:40:07Z" is="relative-time">February 28, 2013</time></a>
        </div>
      </div>

    <div class="comment-content">

      <div class="edit-comment-hide">
        <div class="comment-body markdown-body  js-comment-body">
            <pre><code>The trick I have been using is to hardcode the full path to the virtualenv python binary. For example in a cron I will

*/5 * * * * /home/username/.virtualenv/project/bin/python /home/username/src/project/program.py
</code></pre>

<p>You are not forced to do this.<br>
If your program was properly installed inside the virtualenv (as it should be), then its shebang should have been replaced by the full path of the virtualenv's python interpreter. This was made to answer this problem.</p>

<pre><code>Standard activate does not modify $LD_LIBRARY_PATH. I just remembered that's something I patched in. Where I work, we use the virtual Python environment to be the general container for all the stuff our application needs. We include gevent in our virtual environment, so we also put its dependencies (like libevent, needed by our version of gevent) in the virtual environment under the $VIRTUAL_ENV/lib.
</code></pre>

<p>Yeah, we do the exact same thing.</p>

<pre><code>I wonder why this isn't common practice.
</code></pre>

<p>Because this isn't really working all that well:</p>

<ul class="task-list">
<li>(if you use <code>pip</code> to provision your venvs:)<code>pip</code> only handle runtime dependencies. It only ensure that after install, every dependency <em>is</em> present, so the installation order of you dependencies is not guaranteed to match your dependency graph =&gt; you can not rely on <code>pip</code> to build source packages. You are limited to distribute binaries (and since <code>pip</code> was made to handle source packages, it does not provide anything to support multiple platforms for prebuilt binaries, thus forcing you to handle this at the bootstrap layer (a.k.a. multiple repositories for different platforms, and distributing a pip.conf) or the package maintainer level (the package contains all platforms, and  setup.py picks at installation time which one to install)</li>
<li>Relying on <code>LD_LIBRARY_PATH</code> is kind of hackish since it directly hooks up library resolution in ld.so, thus impacting your dynamic loader (program execution) AND ld (the linker). This means that any attempt to build something in your virtualenv could not be trusted.</li>
</ul>
        </div>
      </div>

    </div>
  </div>
  </div>
  </div>

<div class="timeline-comment-wrapper js-comment-container">
  <a href="/honza"><img class="timeline-comment-avatar" src="https://avatars1.githubusercontent.com/u/206357?s=140" width="48" height="48"></a>
  <div class="timeline-comment ">
    <div id="comment-785288" class="comment js-comment js-task-list-container" data-body-version="b567ed6368f4273c9927be9b706f82ca">
      <div class="timeline-comment-header">



        <div class="timeline-comment-header-text">
          <strong>
            <a class="author" href="/honza">honza</a>
          </strong>

          commented

            <a href="#comment-785288" class="timestamp"><time datetime="2013-02-28T16:08:35Z" is="relative-time">February 28, 2013</time></a>
        </div>
      </div>

    <div class="comment-content">

      <div class="edit-comment-hide">
        <div class="comment-body markdown-body  js-comment-body">
            <p>Doesn't seem to work for me on the fish shell. Creates a subshell just fine but doesn't actually "activate" the virtualenv.</p>
        </div>
      </div>

    </div>
  </div>
  </div>
  </div>

<div class="timeline-comment-wrapper js-comment-container">
  <a href="/esoergel"><img class="timeline-comment-avatar" src="https://avatars0.githubusercontent.com/u/2367539?s=140" width="48" height="48"></a>
  <div class="timeline-comment ">
    <div id="comment-785296" class="comment js-comment js-task-list-container" data-body-version="91319a046a2d19ee8212607b459b01be">
      <div class="timeline-comment-header">



        <div class="timeline-comment-header-text">
          <strong>
            <a class="author" href="/esoergel">esoergel</a>
          </strong>

          commented

            <a href="#comment-785296" class="timestamp"><time datetime="2013-02-28T16:21:37Z" is="relative-time">February 28, 2013</time></a>
        </div>
      </div>

    <div class="comment-content">

      <div class="edit-comment-hide">
        <div class="comment-body markdown-body  js-comment-body">
            <p>I absolutely agree with this idea, it makes a lot more sense conceptually.  If you're developing for a server, you should basically be creating a local version of that server, and a local version of ssh is more analogous.  I use virtualenvwrapper, which simpler to use, but it just abstracts away that complication rather than fixing it. </p>
        </div>
      </div>

    </div>
  </div>
  </div>
  </div>

<div class="timeline-comment-wrapper js-comment-container">
  <a href="/nvie"><img class="timeline-comment-avatar" src="https://avatars2.githubusercontent.com/u/83844?s=140" width="48" height="48"></a>
  <div class="timeline-comment ">
    <div id="comment-785440" class="comment js-comment js-task-list-container" data-body-version="07c6a6a0599f1e322d7c065fac3e4e0c">
      <div class="timeline-comment-header">



        <div class="timeline-comment-header-text">
          <strong>
            <a class="author" href="/nvie">nvie</a>
          </strong>

          commented

            <a href="#comment-785440" class="timestamp"><time datetime="2013-02-28T18:48:27Z" is="relative-time">February 28, 2013</time></a>
        </div>
      </div>

    <div class="comment-content">

      <div class="edit-comment-hide">
        <div class="comment-body markdown-body  js-comment-body">
            <p>@honza You should check that, because it does work on fish for me without further hacks.</p>
        </div>
      </div>

    </div>
  </div>
  </div>
  </div>

<div class="timeline-comment-wrapper js-comment-container">
  <a href="/caruccio"><img class="timeline-comment-avatar" src="https://avatars2.githubusercontent.com/u/540936?s=140" width="48" height="48"></a>
  <div class="timeline-comment ">
    <div id="comment-786426" class="comment js-comment js-task-list-container" data-body-version="1082aa0d1a9b3f3e19c36f530f743fd4">
      <div class="timeline-comment-header">



        <div class="timeline-comment-header-text">
          <strong>
            <a class="author" href="/caruccio">caruccio</a>
          </strong>

          commented

            <a href="#comment-786426" class="timestamp"><time datetime="2013-03-01T20:13:22Z" is="relative-time">March 01, 2013</time></a>
        </div>
      </div>

    <div class="comment-content">

      <div class="edit-comment-hide">
        <div class="comment-body markdown-body  js-comment-body">
            <p>Do you known Kenneth Reitz's autoenv?<br>
One simply "cd " and BANG!, virtualenv activated.<br>
Then, "cd .." and BANG!, virtualenv deactivated.</p>

<p>The picture says for itself... Please give it a try:</p>

<p><a href="https://github.com/kennethreitz/autoenv" rel="noreferrer">https://github.com/kennethreitz/autoenv</a></p>
        </div>
      </div>

    </div>
  </div>
  </div>
  </div>

<div class="timeline-comment-wrapper js-comment-container">
  <a href="/dustinlacewell"><img class="timeline-comment-avatar" src="https://avatars2.githubusercontent.com/u/53952?s=140" width="48" height="48"></a>
  <div class="timeline-comment ">
    <div id="comment-786627" class="comment js-comment js-task-list-container" data-body-version="6bc037da9eece137caeb52bb9fbe0c6d">
      <div class="timeline-comment-header">



        <div class="timeline-comment-header-text">
          <strong>
            <a class="author" href="/dustinlacewell">dustinlacewell</a>
          </strong>

          commented

            <a href="#comment-786627" class="timestamp"><time datetime="2013-03-02T03:01:14Z" is="relative-time">March 02, 2013</time></a>
        </div>
      </div>

    <div class="comment-content">

      <div class="edit-comment-hide">
        <div class="comment-body markdown-body  js-comment-body">
            <p>To be fair, I only give auto-activating a virtualenv as an example of using capn which is a generic directory-based hooking mechanism. It doesn't really "use" the anti-pattern described here. @caruccio, that might interest you based on your comment, though autoenv looks nice. </p>

<p>That said, I agree with what has been said here. I wonder, like @tclancy how much of this has to do with Windows.</p>
        </div>
      </div>

    </div>
  </div>
  </div>
  </div>

<div class="timeline-comment-wrapper js-comment-container">
  <a href="/j0hnsmith"><img class="timeline-comment-avatar" src="https://avatars0.githubusercontent.com/u/118963?s=140" width="48" height="48"></a>
  <div class="timeline-comment ">
    <div id="comment-787791" class="comment js-comment js-task-list-container" data-body-version="6892fd509590d379c4ee3c8b9502b4a4">
      <div class="timeline-comment-header">



        <div class="timeline-comment-header-text">
          <strong>
            <a class="author" href="/j0hnsmith">j0hnsmith</a>
          </strong>

          commented

            <a href="#comment-787791" class="timestamp"><time datetime="2013-03-03T09:39:13Z" is="relative-time">March 03, 2013</time></a>
        </div>
      </div>

    <div class="comment-content">

      <div class="edit-comment-hide">
        <div class="comment-body markdown-body  js-comment-body">
            <p>@e000 in fish (or fishfish) you can do . virtualenv/bin/activate.fish</p>
        </div>
      </div>

    </div>
  </div>
  </div>
  </div>

<div class="timeline-comment-wrapper js-comment-container">
  <a href="/mangecoeur"><img class="timeline-comment-avatar" src="https://avatars0.githubusercontent.com/u/743508?s=140" width="48" height="48"></a>
  <div class="timeline-comment ">
    <div id="comment-798201" class="comment js-comment js-task-list-container" data-body-version="e19305c29ffc06e03d6abb1679b787d1">
      <div class="timeline-comment-header">



        <div class="timeline-comment-header-text">
          <strong>
            <a class="author" href="/mangecoeur">mangecoeur</a>
          </strong>

          commented

            <a href="#comment-798201" class="timestamp"><time datetime="2013-03-14T14:06:35Z" is="relative-time">March 14, 2013</time></a>
        </div>
      </div>

    <div class="comment-content">

      <div class="edit-comment-hide">
        <div class="comment-body markdown-body  js-comment-body">
            <p>This is a very elegant approach. I used it to create a simple activate/workon script for environments created with the conda tool, which is part of the Anaconda scientific python distribution. check it out <a href="https://gist.github.com/mangecoeur/5161488" rel="noreferrer">https://gist.github.com/mangecoeur/5161488</a></p>
        </div>
      </div>

    </div>
  </div>
  </div>
  </div>

<div class="timeline-comment-wrapper js-comment-container">
  <a href="/mondaugen"><img class="timeline-comment-avatar" src="https://avatars1.githubusercontent.com/u/3504805?s=140" width="48" height="48"></a>
  <div class="timeline-comment ">
    <div id="comment-830663" class="comment js-comment js-task-list-container" data-body-version="3731892505f5769b5d64114993dbd8fa">
      <div class="timeline-comment-header">



        <div class="timeline-comment-header-text">
          <strong>
            <a class="author" href="/mondaugen">mondaugen</a>
          </strong>

          commented

            <a href="#comment-830663" class="timestamp"><time datetime="2013-05-15T14:35:08Z" is="relative-time">May 15, 2013</time></a>
        </div>
      </div>

    <div class="comment-content">

      <div class="edit-comment-hide">
        <div class="comment-body markdown-body  js-comment-body">
            <p>I can only get this to work with bash not zsh</p>
        </div>
      </div>

    </div>
  </div>
  </div>
  </div>

<div class="timeline-comment-wrapper js-comment-container">
  <a href="/berdario"><img class="timeline-comment-avatar" src="https://avatars2.githubusercontent.com/u/752835?s=140" width="48" height="48"></a>
  <div class="timeline-comment ">
    <div id="comment-835820" class="comment js-comment js-task-list-container" data-body-version="e3d8c153b2e93e58bc398a8554ed35c3">
      <div class="timeline-comment-header">



        <div class="timeline-comment-header-text">
          <strong>
            <a class="author" href="/berdario">berdario</a>
          </strong>

          commented

            <a href="#comment-835820" class="timestamp"><time datetime="2013-05-26T22:33:07Z" is="relative-time">May 26, 2013</time></a>
        </div>
      </div>

    <div class="comment-content">

      <div class="edit-comment-hide">
        <div class="comment-body markdown-body  js-comment-body">
            <p>After an ubuntu upgrade, my virtualenvs broke, I got tired of that setup, and I saw how this could be useful for making a virtualenvwrapper that doesn't even have to touch the shell from which it is invoked...</p>

<p>So, I made a rewrite of virtualenvwrapper in pure python... and I unimaginatively called it "invewrapper" :)</p>

<p><a href="https://github.com/berdario/invewrapper" rel="noreferrer">https://github.com/berdario/invewrapper</a></p>

<p>It works on bash, zsh, fish... and it mostly works on windows too! (there's a bug right now that affects sitepackages_dir and related commands)</p>

<p>Please let me have some feedback :)</p>
        </div>
      </div>

    </div>
  </div>
  </div>
  </div>

<div class="timeline-comment-wrapper js-comment-container">
  <a href="/lyndsysimon"><img class="timeline-comment-avatar" src="https://avatars3.githubusercontent.com/u/131414?s=140" width="48" height="48"></a>
  <div class="timeline-comment ">
    <div id="comment-851637" class="comment js-comment js-task-list-container" data-body-version="d1e8f314d0e8f8487f6f2c93c270dd40">
      <div class="timeline-comment-header">



        <div class="timeline-comment-header-text">
          <strong>
            <a class="author" href="/lyndsysimon">lyndsysimon</a>
          </strong>

          commented

            <a href="#comment-851637" class="timestamp"><time datetime="2013-06-25T20:03:50Z" is="relative-time">June 25, 2013</time></a>
        </div>
      </div>

    <div class="comment-content">

      <div class="edit-comment-hide">
        <div class="comment-body markdown-body  js-comment-body">
            <p>A year after reading this, I'm still chewing on it. I think I completely agree, and I don't know why it hasn't gained wider adoption.</p>

<p>@datagrok, do you attend PyCon? If so, you should really do at least a lightning talk on this. It's subtly and elegantly revolutionary IMO.</p>
        </div>
      </div>

    </div>
  </div>
  </div>
  </div>

<div class="timeline-comment-wrapper js-comment-container">
  <a href="/berdario"><img class="timeline-comment-avatar" src="https://avatars2.githubusercontent.com/u/752835?s=140" width="48" height="48"></a>
  <div class="timeline-comment ">
    <div id="comment-853940" class="comment js-comment js-task-list-container" data-body-version="2b1c90adce86b59ead858ef9e26027d7">
      <div class="timeline-comment-header">



        <div class="timeline-comment-header-text">
          <strong>
            <a class="author" href="/berdario">berdario</a>
          </strong>

          commented

            <a href="#comment-853940" class="timestamp"><time datetime="2013-06-29T16:04:09Z" is="relative-time">June 29, 2013</time></a>
        </div>
      </div>

    <div class="comment-content">

      <div class="edit-comment-hide">
        <div class="comment-body markdown-body  js-comment-body">
            <p>@lyndsysimon have you tried invewrapper? it could be a way for it to gain wider adoption :D</p>
        </div>
      </div>

    </div>
  </div>
  </div>
  </div>

<div class="timeline-comment-wrapper js-comment-container">
  <a href="/datagrok"><img class="timeline-comment-avatar" src="https://avatars0.githubusercontent.com/u/569728?s=140" width="48" height="48"></a>
  <div class="timeline-comment owner-comment">
    <div id="comment-908804" class="comment js-comment js-task-list-container" data-body-version="5f573a1a6ddeea7637518388ca9c8f61">
      <div class="timeline-comment-header">

          <span class="timeline-comment-label">Owner</span>


        <div class="timeline-comment-header-text">
          <strong>
            <a class="author" href="/datagrok">datagrok</a>
          </strong>

          commented

            <a href="#comment-908804" class="timestamp"><time datetime="2013-09-17T04:55:28Z" is="relative-time">September 17, 2013</time></a>
        </div>
      </div>

    <div class="comment-content">

      <div class="edit-comment-hide">
        <div class="comment-body markdown-body  js-comment-body">
            <p>I've done a bit more work on this--you can see it in <a href="https://github.com/datagrok/virtualenv/tree/feature/subshell-activate" rel="noreferrer">my feature/subshell-activate branch</a> of virtualenv. It's not completely working but I think I have a good proof-of-concept. I've implemented a means to do the "activation" in a subshell (the way I like it) without breaking workflow <em>at all</em> for users who prefer to source bin/activate or one of its flavors. (I reimplement the latter in terms of the former.) I'll be pushing more commits whenever I have time.</p>

<p>Also, I just submitted a PyCon 2014 talk proposal based on this work.</p>

<p>Thanks all for your feedback, recommendations, alternative proposals, and encouragement.</p>
        </div>
      </div>

    </div>
  </div>
  </div>
  </div>

<div class="timeline-comment-wrapper js-comment-container">
  <a href="/tsal"><img class="timeline-comment-avatar" src="https://avatars1.githubusercontent.com/u/1747304?s=140" width="48" height="48"></a>
  <div class="timeline-comment ">
    <div id="comment-919008" class="comment js-comment js-task-list-container" data-body-version="51d1e86fcc8d2f2df0fbdce127cdcf13">
      <div class="timeline-comment-header">



        <div class="timeline-comment-header-text">
          <strong>
            <a class="author" href="/tsal">tsal</a>
          </strong>

          commented

            <a href="#comment-919008" class="timestamp"><time datetime="2013-09-30T20:37:29Z" is="relative-time">September 30, 2013</time></a>
        </div>
      </div>

    <div class="comment-content">

      <div class="edit-comment-hide">
        <div class="comment-body markdown-body  js-comment-body">
            <p>@datagrok - I hope to catch your talk; PyCon's time and place is actually convenient for once. :)</p>
        </div>
      </div>

    </div>
  </div>
  </div>
  </div>

<div class="timeline-comment-wrapper js-comment-container">
  <a href="/ericfrederich"><img class="timeline-comment-avatar" src="https://avatars0.githubusercontent.com/u/1167238?s=140" width="48" height="48"></a>
  <div class="timeline-comment ">
    <div id="comment-959438" class="comment js-comment js-task-list-container" data-body-version="2d8110ea5bc87974b6bbb4574907162d">
      <div class="timeline-comment-header">



        <div class="timeline-comment-header-text">
          <strong>
            <a class="author" href="/ericfrederich">ericfrederich</a>
          </strong>

          commented

            <a href="#comment-959438" class="timestamp"><time datetime="2013-11-27T18:58:22Z" is="relative-time">November 27, 2013</time></a>
        </div>
      </div>

    <div class="comment-content">

      <div class="edit-comment-hide">
        <div class="comment-body markdown-body  js-comment-body">
            <p>@apreche take a look here:</p>

<p><a href="http://rosettacode.org/wiki/Multiline_shebang" rel="noreferrer">http://rosettacode.org/wiki/Multiline_shebang</a></p>

<p>I start a lot of my scripts this way....</p>

<pre><code>#!/bin/sh
if "true" : '''\'
then

# set up your execution environment
source /some/stuff

exec python "$0" "$@"

exit 127
fi
'''

print "now we're in Python"
</code></pre>
        </div>
      </div>

    </div>
  </div>
  </div>
  </div>

<div class="timeline-comment-wrapper js-comment-container">
  <a href="/datagrok"><img class="timeline-comment-avatar" src="https://avatars0.githubusercontent.com/u/569728?s=140" width="48" height="48"></a>
  <div class="timeline-comment owner-comment">
    <div id="comment-978486" class="comment js-comment js-task-list-container" data-body-version="9d24f4c17cb24459800e02fb61a52dd3">
      <div class="timeline-comment-header">

          <span class="timeline-comment-label">Owner</span>


        <div class="timeline-comment-header-text">
          <strong>
            <a class="author" href="/datagrok">datagrok</a>
          </strong>

          commented

            <a href="#comment-978486" class="timestamp"><time datetime="2014-01-03T08:17:12Z" is="relative-time">January 03, 2014</time></a>
        </div>
      </div>

    <div class="comment-content">

      <div class="edit-comment-hide">
        <div class="comment-body markdown-body  js-comment-body">
            <p>@tsal ah, my proposal was declined. I'll try to boil it down into a lightning talk and submit that when I'm there though. Oh, and will try to finish up my proposed changes to virtualenv, that too. But @berdario's <a href="https://github.com/berdario/invewrapper" rel="noreferrer">invewrapper</a> looks pretty awesome, he might have gone and eliminated the need for any of my changes! We'll see :)</p>
        </div>
      </div>

    </div>
  </div>
  </div>
  </div>

<div class="timeline-comment-wrapper js-comment-container">
  <a href="/dolmen"><img class="timeline-comment-avatar" src="https://avatars0.githubusercontent.com/u/129536?s=140" width="48" height="48"></a>
  <div class="timeline-comment ">
    <div id="comment-985467" class="comment js-comment js-task-list-container" data-body-version="0622a78d39eb00472e17bfa4111c8985">
      <div class="timeline-comment-header">



        <div class="timeline-comment-header-text">
          <strong>
            <a class="author" href="/dolmen">dolmen</a>
          </strong>

          commented

            <a href="#comment-985467" class="timestamp"><time datetime="2014-01-13T10:48:52Z" is="relative-time">January 13, 2014</time></a>
        </div>
      </div>

    <div class="comment-content">

      <div class="edit-comment-hide">
        <div class="comment-body markdown-body  js-comment-body">
            <p>@datagrok wrote:</p>

<blockquote>
<p>Unfortunately, I don't know if this "eval the output of a command" technique works for all possible shells.</p>
</blockquote>

<p>Yes it can work. But with many quirks depending on each shell: for example, you must avoid any use of <code>\n</code> and consecutive spaces if you want the code to work even if the user forgot to use quotes around your command (<code>eval "$(xxx)"</code> vs <code>eval $(xxx)</code>).<br>
I'm using this technique for the launch of my prompt engine named <a href="https://github.com/dolmen/angel-PS1" rel="noreferrer">angel-PS1</a> which is portable (on various shells: bash, zsh, dash, ksh, fish, tcsh).</p>
        </div>
      </div>

    </div>
  </div>
  </div>
  </div>

<div class="timeline-comment-wrapper js-comment-container">
  <a href="/cmeiklejohn"><img class="timeline-comment-avatar" src="https://avatars2.githubusercontent.com/u/44939?s=140" width="48" height="48"></a>
  <div class="timeline-comment ">
    <div id="comment-1174323" class="comment js-comment js-task-list-container" data-body-version="8b0efbecfc6d03a98dac3aa5a2bc9fd2">
      <div class="timeline-comment-header">



        <div class="timeline-comment-header-text">
          <strong>
            <a class="author" href="/cmeiklejohn">cmeiklejohn</a>
          </strong>

          commented

            <a href="#comment-1174323" class="timestamp"><time datetime="2014-02-19T14:43:34Z" is="relative-time">February 19, 2014</time></a>
        </div>
      </div>

    <div class="comment-content">

      <div class="edit-comment-hide">
        <div class="comment-body markdown-body  js-comment-body">
            <p>Any thoughts on why this doesn't work with zsh, or what the fix will be to make it more portable?</p>
        </div>
      </div>

    </div>
  </div>
  </div>
  </div>

<div class="timeline-comment-wrapper js-comment-container">
  <a href="/manageyp"><img class="timeline-comment-avatar" src="https://avatars0.githubusercontent.com/u/532889?s=140" width="48" height="48"></a>
  <div class="timeline-comment ">
    <div id="comment-1179352" class="comment js-comment js-task-list-container" data-body-version="c448f2c4bce7a969c13e254aa1c812f9">
      <div class="timeline-comment-header">



        <div class="timeline-comment-header-text">
          <strong>
            <a class="author" href="/manageyp">manageyp</a>
          </strong>

          commented

            <a href="#comment-1179352" class="timestamp"><time datetime="2014-02-25T03:39:12Z" is="relative-time">February 25, 2014</time></a>
        </div>
      </div>

    <div class="comment-content">

      <div class="edit-comment-hide">
        <div class="comment-body markdown-body  js-comment-body">
            <p>Mark: Virtualenv the right way.</p>
        </div>
      </div>

    </div>
  </div>
  </div>
  </div>

<div class="timeline-comment-wrapper js-comment-container">
  <a href="/kwill"><img class="timeline-comment-avatar" src="https://avatars3.githubusercontent.com/u/229415?s=140" width="48" height="48"></a>
  <div class="timeline-comment ">
    <div id="comment-1179682" class="comment js-comment js-task-list-container" data-body-version="e5add0e916e72ac464629480960ed429">
      <div class="timeline-comment-header">



        <div class="timeline-comment-header-text">
          <strong>
            <a class="author" href="/kwill">kwill</a>
          </strong>

          commented

            <a href="#comment-1179682" class="timestamp"><time datetime="2014-02-25T15:55:41Z" is="relative-time">February 25, 2014</time></a>
        </div>
      </div>

    <div class="comment-content">

      <div class="edit-comment-hide">
        <div class="comment-body markdown-body  js-comment-body">
            <p>@Apreche it looks like <code>pew in ve_name your_command</code> might be the answer you're looking for (confirmed for shell scripts, not sure about Python scripts or modules just yet) - see <a href="https://stackoverflow.com/questions/22018185/how-can-i-use-pew-in-a-bash-python-fabric-sh-script" rel="noreferrer">https://stackoverflow.com/questions/22018185/how-can-i-use-pew-in-a-bash-python-fabric-sh-script</a></p>
        </div>
      </div>

    </div>
  </div>
  </div>
  </div>

<div class="timeline-comment-wrapper js-comment-container">
  <a href="/Dakta"><img class="timeline-comment-avatar" src="https://avatars3.githubusercontent.com/u/278782?s=140" width="48" height="48"></a>
  <div class="timeline-comment ">
    <div id="comment-1185564" class="comment js-comment js-task-list-container" data-body-version="8d82e2b663351d4c0d2e1adee06ee64a">
      <div class="timeline-comment-header">



        <div class="timeline-comment-header-text">
          <strong>
            <a class="author" href="/Dakta">Dakta</a>
          </strong>

          commented

            <a href="#comment-1185564" class="timestamp"><time datetime="2014-03-06T07:00:10Z" is="relative-time">March 06, 2014</time></a>
        </div>
      </div>

    <div class="comment-content">

      <div class="edit-comment-hide">
        <div class="comment-body markdown-body  js-comment-body">
            <p>Very important note: the provided <code>inve</code> <strong>will fail</strong> if you do not have the python-dev package installed, as there will not be <code>include/python*/Python.h</code></p>

<p>@datagrok You should make a note of this or modify the script to function without <code>python-dev</code>.</p>
        </div>
      </div>

    </div>
  </div>
  </div>
  </div>

<div class="timeline-comment-wrapper js-comment-container">
  <a href="/techtonik"><img class="timeline-comment-avatar" src="https://avatars0.githubusercontent.com/u/515889?s=140" width="48" height="48"></a>
  <div class="timeline-comment ">
    <div id="comment-1193977" class="comment js-comment js-task-list-container" data-body-version="94beb37e8f1d94a239f3b04be6e0677c">
      <div class="timeline-comment-header">



        <div class="timeline-comment-header-text">
          <strong>
            <a class="author" href="/techtonik">techtonik</a>
          </strong>

          commented

            <a href="#comment-1193977" class="timestamp"><time datetime="2014-03-19T08:58:24Z" is="relative-time">March 19, 2014</time></a>
        </div>
      </div>

    <div class="comment-content">

      <div class="edit-comment-hide">
        <div class="comment-body markdown-body  js-comment-body">
            <p>I've added a pull request in <a href="https://github.com/pypa/virtualenv/issues/581" rel="noreferrer">https://github.com/pypa/virtualenv/issues/581</a> to introduce login/logout shell logic. It is a first step that could be expanded later if merged.</p>
        </div>
      </div>

    </div>
  </div>
  </div>
  </div>

<div class="timeline-comment-wrapper js-comment-container">
  <a href="/joedevivo"><img class="timeline-comment-avatar" src="https://avatars0.githubusercontent.com/u/55951?s=140" width="48" height="48"></a>
  <div class="timeline-comment ">
    <div id="comment-1206976" class="comment js-comment js-task-list-container" data-body-version="02d25a13f9eefa503b51ea7f6912f6de">
      <div class="timeline-comment-header">



        <div class="timeline-comment-header-text">
          <strong>
            <a class="author" href="/joedevivo">joedevivo</a>
          </strong>

          commented

            <a href="#comment-1206976" class="timestamp"><time datetime="2014-04-07T17:53:39Z" is="relative-time">April 07, 2014</time></a>
        </div>
      </div>

    <div class="comment-content">

      <div class="edit-comment-hide">
        <div class="comment-body markdown-body  js-comment-body">
            <p>There's a problem using this with oh-my-zsh. The $PATH variable gets overwritten by the stock ~/.zshrc when you launch the new shell, appending something like this to your ~/.zshrc will fix the problem.</p>

<div class="highlight highlight-bash"><pre><span class="k">if</span> <span class="o">[</span> -z <span class="s2">"$VIRTUAL_ENV"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
<span class="k">else</span>
    <span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span><span class="s2">"$VIRTUAL_ENV/bin:$PATH"</span>
<span class="k">fi</span>
</pre></div>
        </div>
      </div>

    </div>
  </div>
  </div>
  </div>

          </div>

          <div class="discussion-timeline-actions">
              <div class="signed-out-comment">
	<a class="button primary" href="https://github.com/signup?return_to=gist" rel="nofollow">Sign up for free</a>
	<strong>to join this conversation on GitHub</strong>.
	Already have an account?
  <a href="https://gist.github.com/login?return_to=%2Fdatagrok%2F2199506" rel="nofollow">Sign in to comment</a>
</div>


          </div>
        </div><!-- /.discussion-timeline -->
      </div><!-- /.gist-content -->
    </div>
  </div>
</div><!-- /.container -->

  <div class="context-overlay"></div>
</div>

    </div>
    <div class="slow-loading-overlay"></div>
  </div>

  <div id="ajax-error-message" class="flash flash-error">
    <div class="container">
      <span class="octicon octicon-alert"></span>
      Something went wrong with that request. Please try again.
      <a href="#" class="octicon octicon-x ajax-error-dismiss"></a>
    </div>
  </div>


  <footer>
    <div class="container">
  <div class="site-footer">
    <ul class="site-footer-links right">
      <li><a href="https://status.github.com/">Status</a></li>
      <li><a href="http://developer.github.com">API</a></li>
      <li><a href="https://github.com/blog">Blog</a></li>
      <li><a href="https://github.com/about">About</a></li>

    </ul>

    <a href="/">
      <span class="mega-octicon octicon-mark-github" title="GitHub "></span>
    </a>

    <ul class="site-footer-links">
      <li>&copy; 2014 <span title="0.14351s from github-fe102-cp1-prd.iad.github.net">GitHub</span>, Inc.</li>
        <li><a href="https://github.com/site/terms">Terms</a></li>
        <li><a href="https://github.com/site/privacy">Privacy</a></li>
        <li><a href="https://github.com/security">Security</a></li>
        <li><a href="https://github.com/contact">Contact</a></li>
    </ul>
  </div><!-- /.site-footer -->
</div><!-- /.container -->

  </footer>

  <div class="fullscreen-overlay js-fullscreen-overlay" id="fullscreen_overlay">
  <div class="fullscreen-container js-fullscreen-container">
    <div class="textarea-wrap">
      <textarea name="fullscreen-contents" id="fullscreen-contents" class="fullscreen-contents js-fullscreen-contents" placeholder="" data-suggester="fullscreen_suggester"></textarea>
        <div class="suggester-container">
            <div class="suggester fullscreen-suggester js-navigation-container" id="fullscreen_suggester"
                data-url="/datagrok/2199506/suggestions">
            </div>
        </div>
    </div>
  </div>
  <div class="fullscreen-sidebar">
    <a href="#" class="exit-fullscreen js-exit-fullscreen tooltipped tooltipped-w" aria-label="Exit Zen Mode">
      <span class="mega-octicon octicon-screen-normal"></span>
    </a>
    <a href="#" class="theme-switcher js-theme-switcher tooltipped tooltipped-w"
      aria-label="Switch themes">
      <span class="octicon octicon-color-mode"></span>
    </a>
  </div>
</div>


</body>
</html>
