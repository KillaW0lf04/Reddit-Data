<!doctype html>
<!--[if lt IE 7]> <html class="no-js ie6 lt-ie9 lt-ie8 lt-ie7" lang="en-US"> <![endif]-->
<!--[if IE 7]>    <html class="no-js ie7 lt-ie9 lt-ie8" lang="en-US"> <![endif]-->
<!--[if IE 8]>    <html class="no-js ie8 lt-ie9" lang="en-US"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en-US"> <!--<![endif]-->
	<head>
		<meta charset="UTF-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="viewport" content="width=device-width">
		<title>0x5f3759df &raquo; Hummus and Magnets</title>
		<link rel="profile" href="http://gmpg.org/xfn/11" />
		<link rel="stylesheet" type="text/css" media="all" href="http://blog.quenta.org/wp-content/themes/brunelleschi/style.css" />
		<link rel="pingback" href="http://blog.quenta.org/xmlrpc.php" />
		<style type="text/css">
			#wrapper { max-width: 960px !important;
			 }
																													</style>
		<link rel="alternate" type="application/rss+xml" title="Hummus and Magnets &raquo; Feed" href="http://blog.quenta.org/feed" />
<link rel="alternate" type="application/rss+xml" title="Hummus and Magnets &raquo; Comments Feed" href="http://blog.quenta.org/comments/feed" />
<link rel="alternate" type="application/rss+xml" title="Hummus and Magnets &raquo; 0x5f3759df Comments Feed" href="http://blog.quenta.org/2012/09/0x5f3759df.html/feed" />
<link rel='stylesheet' id='jetpack-widgets-css'  href='http://blog.quenta.org/wp-content/plugins/jetpack/modules/widgets/widgets.css?ver=20121003' type='text/css' media='all' />
<link rel='stylesheet' id='easy_table_style-css'  href='http://blog.quenta.org/wp-content/plugins/easy-table/themes/default/style.css?ver=0.9' type='text/css' media='all' />
<link rel='stylesheet' id='sharedaddy-css'  href='http://blog.quenta.org/wp-content/plugins/jetpack/modules/sharedaddy/sharing.css?ver=2.0.2' type='text/css' media='all' />
<script type='text/javascript' src='http://blog.quenta.org/wp-content/themes/brunelleschi/js/modernizr-2.5.2.min.js?ver=3.9.1'></script>
<script type='text/javascript' src='http://blog.quenta.org/wp-content/themes/brunelleschi/js/respond.js?ver=3.9.1'></script>
<script type='text/javascript' src='http://blog.quenta.org/wp-includes/js/jquery/jquery.js?ver=1.11.0'></script>
<script type='text/javascript' src='http://blog.quenta.org/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.2.1'></script>
<script type='text/javascript' src='http://blog.quenta.org/wp-content/themes/brunelleschi/js/brunelleschi-scripts.js?ver=3.9.1'></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://blog.quenta.org/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://blog.quenta.org/wp-includes/wlwmanifest.xml" /> 
<link rel='prev' title='Reload?' href='http://blog.quenta.org/2012/08/reload.html' />
<link rel='next' title='0x5f3759df (appendix)' href='http://blog.quenta.org/2012/09/0x5f3759df-appendix.html' />
<meta name="generator" content="WordPress 3.9.1" />
<link rel='canonical' href='http://blog.quenta.org/2012/09/0x5f3759df.html' />
<link rel='shortlink' href='http://wp.me/p2Y4cY-2I' />

<!-- Jetpack Open Graph Tags -->
<meta property="og:type" content="article" />
<meta property="og:title" content="0x5f3759df" />
<meta property="og:url" content="http://blog.quenta.org/2012/09/0x5f3759df.html" />
<meta property="og:description" content="This post is about the magic constant 0x5f3759df and an extremely neat hack, fast inverse square root, which is where the constant comes from. Meet the inverse square root hack: float FastInvSqrt(f..." />
<meta property="og:site_name" content="Hummus and Magnets" />
<meta property="og:image" content="http://blog.quenta.org/wp-content/uploads/2012/09/0.333.png" />
<meta property="og:image" content="http://blog.quenta.org/wp-content/uploads/2012/09/0.51.png" />
<meta property="og:image" content="http://blog.quenta.org/wp-content/uploads/2012/09/0.5.png" />
<meta property="og:image" content="http://blog.quenta.org/wp-content/uploads/2012/09/ln.png" />

<!-- WP Youtube Player 1.7 by unijimpe -->
<style type="text/css">
/* <![CDATA[ */
img.latex { vertical-align: middle; border: none; }
/* ]]> */
</style>
	</head>
	<body class="single single-post postid-168 single-format-standard">
	<div id="wrapper" class="hfeed container">
		<header id="header" class="row clearfix">
							<div id="branding" class="twelvecol last">
										<div id="site-title" >
						<a href="http://blog.quenta.org/" title="Hummus and Magnets" rel="home">Hummus and Magnets</a>
					</div>
					<div id="site-description" class="hidden"></div>
				</div><!-- #branding -->
																	
													<div id="access" role="navigation" class="twelvecol last clearfix">
					<div class="skip-link screen-reader-text"><a href="#content" title="Skip to content">Skip to content</a></div>
					<div class="menu"><ul><li ><a href="http://blog.quenta.org/">Home</a></li></ul></div>
				</div><!-- #access -->
					</header><!-- #header -->
		<div id="container" class="row clearfix">		
		<div id="main" role="main" class="ninecol ">

			
				<nav id="nav-above" class="navigation">
					<div class="nav-previous"><a href="http://blog.quenta.org/2012/08/reload.html" rel="prev"><span class="meta-nav">&larr;</span> Reload?</a></div>
					<div class="nav-next"><a href="http://blog.quenta.org/2012/09/0x5f3759df-appendix.html" rel="next">0x5f3759df (appendix) <span class="meta-nav">&rarr;</span></a></div>
				</nav><!-- #nav-above -->

				<article id="post-168" class="post-168 post type-post status-publish format-standard hentry category-c category-mathematics category-programming">
					<header>
						<h1 class="entry-title">0x5f3759df</h1>
												<div class="entry-meta">
							<span class="meta-sep">by</span> <span class="author vcard"><a class="url fn n" href="http://blog.quenta.org/author/plesner" title="View all posts by Christian Plesner Hansen">Christian Plesner Hansen</a></span> <span class="meta-prep meta-prep-author">Posted on</span> <a href="http://blog.quenta.org/2012/09/0x5f3759df.html" title="08:33" rel="bookmark"><span class="entry-date">September 15, 2012</span></a>						</div><!-- .entry-meta -->
											</header>
					<div class="entry-content">
						<p>This post is about the magic constant <code>0x5f3759df</code> and an extremely neat hack, <a title="fast inverse square root" href="http://en.wikipedia.org/wiki/Fast_inverse_square_root">fast inverse square root</a>, which is where the constant comes from.</p>
<p>Meet the inverse square root hack:</p>
<pre><strong>float</strong> FastInvSqrt(<strong>float</strong> x) {
  <strong>float</strong> xhalf = 0.5f * x;
  <strong>int</strong> i = *(<strong>int</strong>*)&amp;x;         <span style="color: #993300;"><em>// evil floating point bit level hacking</em></span>
  i = 0x5f3759df - (i &gt;&gt; 1);  <span style="color: #993300;"><em>// what the fuck?</em></span>
  x = *(<strong>float</strong>*)&amp;i;
  x = x*(1.5f-(xhalf*x*x));
  <strong>return</strong> x;
}</pre>
<p>What this code does is calculate, quickly, a good approximation for</p>
<p style="padding-left: 30px;"><img src='http://s.wordpress.com/latex.php?latex=%5Cfrac%7B1%7D%7B%5Csqrt%7Bx%7D%7D&#038;bg=ffffff&#038;fg=000000&#038;s=3' alt='\frac{1}{\sqrt{x}}' title='\frac{1}{\sqrt{x}}' class='latex' /></p>
<p>It&#8217;s a fairly well-known function these days and first became so when it appeared in the source of Quake III Arena in 2005. It was originally attributed to John Carmack but turned out to have a <a href="http://www.beyond3d.com/content/articles/15/">long history</a> before Quake going back through SGI and 3dfx to <a href="http://en.wikipedia.org/wiki/Ardent_Computer">Ardent Computer</a> in the mid 80s to the original author Greg Walsh. The concrete code above is an adapted version of the Quake code (that&#8217;s where the comments are from).</p>
<p>This post has a bit of fun with this hack. It describes how it works, how to generalize it to any power between -1 and 1, and sheds some new light on the math involved.</p>
<p>(<em>It does contain a fair bit of math. You can think of the equations as notes – you don&#8217;t have to read them to get the gist of the post but you should if you want the full story and/or verify for yourself that what I&#8217;m saying is correct</em>).</p>
<h2>Why?</h2>
<p>Why do you need to calculate the inverse of the square root – and need it so much that it&#8217;s worth implementing a crazy hack to make it fast? Because it&#8217;s part of a calculation you do all the time in 3D programming. In 3D graphics you use surface normals, 3-coordinate vectors of length 1, to express lighting and reflection. You use a <em>lot</em> of surface normals. And calculating them involves normalizing a <em>lot</em> of vectors. How do you normalize a vector? You find the length of the vector and then divide each of the coordinates with it. That is, you multiply each coordinate with</p>
<p style="padding-left: 30px;"><img src='http://s.wordpress.com/latex.php?latex=%5Cfrac%7B1%7D%7B%5Csqrt%7Bx%5E2%2By%5E2%2Bz%5E2%7D%7D&#038;bg=ffffff&#038;fg=000000&#038;s=3' alt='\frac{1}{\sqrt{x^2+y^2+z^2}}' title='\frac{1}{\sqrt{x^2+y^2+z^2}}' class='latex' /></p>
<p>Calculating <img src='http://s.wordpress.com/latex.php?latex=x%5E2%2By%5E2%2Bz%5E2&#038;bg=ffffff&#038;fg=000000&#038;s=0' alt='x^2+y^2+z^2' title='x^2+y^2+z^2' class='latex' /> is relatively cheap. Finding the square root and dividing by it is expensive. Enter <code>FastInvSqrt</code>.</p>
<h2>What does it do?</h2>
<p>What does the function actually do to calculate its result? It has 4 main steps. First it reinterprets the bits of the floating-point input as an integer.</p>
<pre><strong>int</strong> i = *(<strong>int</strong>*)&amp;x;         <span style="color: #993300;"><em>// evil floating point bit level hack</em></span></pre>
<p>It takes the resulting value and does integer arithmetic on it which produces an approximation of the value we&#8217;re looking for:</p>
<pre>i = 0x5f3759df - (i &gt;&gt; 1);  <span style="color: #993300;"><em>// what the fuck?</em></span></pre>
<p>The result is not the approximation itself though, it is an integer which happens to be, if you reinterpret the bits as a floating point number, the approximation. So the code does the reverse of the conversion in step 1 to get back to floating point:</p>
<pre>x = *(<strong>float</strong>*)&amp;i;</pre>
<p>And finally it runs a single iteration of <a href="http://en.wikipedia.org/wiki/Newton%27s_method">Newton&#8217;s method</a> to improve the approximation.</p>
<pre>x = x*(1.5f-(xhalf*x*x));</pre>
<p>This gives you an excellent approximation of the inverse square root of <em>x</em>. The last part, running Newton&#8217;s method, is relatively straightforward so I won&#8217;t spend more time on it. The key step is step 2: doing arithmetic on the raw floating-point number cast to an integer and getting a meaningful result back. That&#8217;s the part I&#8217;ll focus on.</p>
<h2>What the fuck?</h2>
<p>This section explains the math behind step 2. (<em>The first part of the derivation below, up to the point of calculating the value of the constant, appears to have first been found by <a href="http://www.daxia.com/bibis/upload/406Fast_Inverse_Square_Root.pdf">McEniry</a></em>).</p>
<p>Before we can get to the juicy part I&#8217;ll just quickly run over how standard <a href="http://en.wikipedia.org/wiki/Single_precision">floating-point</a> numbers are encoded. I&#8217;ll just go through the parts I need, for the full background wikipedia is your friend. A floating-point number has three parts: the sign, the exponent, and the mantissa. Here&#8217;s the bits of a single-precision (32-bit) one:</p>
<pre><span style="color: #ff9900;">s </span><span style="color: #008000;">e e e e e e e e </span><span style="color: #800000;">m m m m m m m m m m m m m m m m m m m m m m m</span></pre>
<p>The sign is the top bit, the exponent is the next 8 and the mantissa bottom 23. Since we&#8217;re going to be calculating the square root which is only defined for positive values I&#8217;m going to be assuming the sign is 0 from now on.</p>
<p>When viewing a floating-point number as just a bunch of bits the exponent and mantissa are just plain positive integers, nothing special about them. Let&#8217;s call them <em>E</em> and <em>M</em> (since we&#8217;ll be using them a <em>lot</em>). On the other hand, when we interpret the bits as a floating-point value we&#8217;ll view the mantissa as a value between 0 and 1, so all 0s means 0 and all 1s is a value very close to but slightly less than 1. And rather than use the exponent as a 8-bit unsigned integer we&#8217;ll subtract a bias, <em>B</em>, to make it a signed integer between -127 and 128. Let&#8217;s call the floating-point interpretation of those values <em>e</em> and <em>m</em>. In general I&#8217;ll follow McEniry and use upper-case letters for values that relate to the integer view and and lower-case for values that relate to the floating-point view.</p>
<p>Converting between the two views is straightforward:</p>
<p style="padding-left: 30px;"><img src='http://s.wordpress.com/latex.php?latex=m%20%3D%20%5Cfrac%7BM%7D%7BL%7D&#038;bg=ffffff&#038;fg=000000&#038;s=2' alt='m = \frac{M}{L}' title='m = \frac{M}{L}' class='latex' /></p>
<p style="padding-left: 30px;"><img src='http://s.wordpress.com/latex.php?latex=e%20%3D%20E%20-%20B&#038;bg=ffffff&#038;fg=000000&#038;s=2' alt='e = E - B' title='e = E - B' class='latex' /></p>
<p>For 32-bit floats <em>L</em> is 2<sup>23</sup> and <em>B</em> is 127. Given the values of <em>e</em> and <em>m</em> you calculate the floating-point number&#8217;s value like this:</p>
<p style="padding-left: 30px;"><img src='http://s.wordpress.com/latex.php?latex=%281%2Bm%292%5Ee&#038;bg=ffffff&#038;fg=000000&#038;s=2' alt='(1+m)2^e' title='(1+m)2^e' class='latex' /></p>
<p>and the value of the corresponding integer interpretation of the number is</p>
<p style="padding-left: 30px;"><img src='http://s.wordpress.com/latex.php?latex=M%20%2B%20LE&#038;bg=ffffff&#038;fg=000000&#038;s=2' alt='M + LE' title='M + LE' class='latex' /></p>
<p>Now we have almost all the bits and pieces I need to explain the hack so I&#8217;ll get started and we&#8217;ll pick up the last few pieces along the way. The value we want to calculate, given some input <em>x</em>, is the inverse square root or</p>
<p style="padding-left: 30px;"><img src='http://s.wordpress.com/latex.php?latex=y%20%3D%20%5Cfrac%7B1%7D%7B%5Csqrt%7Bx%7D%7D%20%3D%20x%5E%7B-%5Cfrac%2012%7D&#038;bg=ffffff&#038;fg=000000&#038;s=2' alt='y = \frac{1}{\sqrt{x}} = x^{-\frac 12}' title='y = \frac{1}{\sqrt{x}} = x^{-\frac 12}' class='latex' /></p>
<p>For reasons that will soon become clear we&#8217;ll start off by taking the base 2 logarithm on both sides:</p>
<p style="padding-left: 30px;"><img src='http://s.wordpress.com/latex.php?latex=%5Clog_2%20y%20%3D%20%7B-%5Cfrac%2012%7D%5Clog_2%20x&#038;bg=ffffff&#038;fg=000000&#038;s=2' alt='\log_2 y = {-\frac 12}\log_2 x' title='\log_2 y = {-\frac 12}\log_2 x' class='latex' /></p>
<p>Since the values we&#8217;re working with are actually floating-point we can replace <em>x</em> and <em>y</em> with their floating-point components:</p>
<p style="padding-left: 30px;"><img src='http://s.wordpress.com/latex.php?latex=%5Clog_2%20%281%2Bm_y%29%20%2B%20e_y%20%3D%20%7B-%5Cfrac%2012%7D%28%5Clog_2%20%281%2Bm_x%29%20%2B%20e_x%29&#038;bg=ffffff&#038;fg=000000&#038;s=2' alt='\log_2 (1+m_y) + e_y = {-\frac 12}(\log_2 (1+m_x) + e_x)' title='\log_2 (1+m_y) + e_y = {-\frac 12}(\log_2 (1+m_x) + e_x)' class='latex' /></p>
<p>Ugh, logarithms. They&#8217;re such a hassle. Luckily we can get rid of them quite easily but first we&#8217;ll have to take a short break and talk about how they work.</p>
<p>On both sides of this equation we have a term that looks like this,</p>
<p style="padding-left: 30px;"><img src='http://s.wordpress.com/latex.php?latex=%5Clog_2%281%20%2B%20v%29&#038;bg=ffffff&#038;fg=000000&#038;s=2' alt='\log_2(1 + v)' title='\log_2(1 + v)' class='latex' /></p>
<p>where <em>v</em> is between 0 and 1. It just so happens that for <em>v</em> between 0 and 1, this function is pretty close to a straight line:</p>
<p><a href="http://blog.quenta.org/wp-content/uploads/2012/09/ln.png"><img class="aligncenter size-full wp-image-232" title="ln2(1 + x) vs. x + sigma" src="http://blog.quenta.org/wp-content/uploads/2012/09/ln.png" alt="ln2(1 + x) vs. x + sigma" width="600" height="371" /></a></p>
<p>Or, in equation form:</p>
<p style="padding-left: 30px;"><img src='http://s.wordpress.com/latex.php?latex=%5Clog_2%281%20%2B%20v%29%20%5Capprox%20v%20%2B%20%5Csigma&#038;bg=ffffff&#038;fg=000000&#038;s=2' alt='\log_2(1 + v) \approx v + \sigma' title='\log_2(1 + v) \approx v + \sigma' class='latex' /></p>
<p>Where σ is a constant we choose. It&#8217;s not a perfect match but we can adjust σ to make it pretty close. Using this we can turn the exact equation above that involved logarithms into an approximate one that is linear, which is much easier to work with:</p>
<p style="padding-left: 30px;"><img src='http://s.wordpress.com/latex.php?latex=m_y%20%2B%20%5Csigma%20%2B%20e_y%20%5Capprox%20%7B-%5Cfrac%2012%7D%28m_x%20%2B%20%5Csigma%20%2B%20e_x%29&#038;bg=ffffff&#038;fg=000000&#038;s=2' alt='m_y + \sigma + e_y \approx {-\frac 12}(m_x + \sigma + e_x)' title='m_y + \sigma + e_y \approx {-\frac 12}(m_x + \sigma + e_x)' class='latex' /></p>
<p><em>Now</em> we&#8217;re getting somewhere! At this point it&#8217;s convenient to stop working with the floating-point representation and use the definitions above to substitute the integer view of the exponent and mantissa:</p>
<p style="padding-left: 30px;"><img src='http://s.wordpress.com/latex.php?latex=%5Cfrac%7BM_y%7D%7BL%7D%20%2B%20%5Csigma%20%2B%20E_y%20-%20B%20%5Capprox%20%7B-%5Cfrac%2012%7D%28%5Cfrac%7BM_x%7D%7BL%7D%20%2B%20%5Csigma%20%2B%20E_x%20-%20B%29&#038;bg=ffffff&#038;fg=000000&#038;s=2' alt='\frac{M_y}{L} + \sigma + E_y - B \approx {-\frac 12}(\frac{M_x}{L} + \sigma + E_x - B)' title='\frac{M_y}{L} + \sigma + E_y - B \approx {-\frac 12}(\frac{M_x}{L} + \sigma + E_x - B)' class='latex' /></p>
<p>If we shuffle these terms around a few steps we&#8217;ll get something that looks very familiar (the details are tedious, feel free to skip):</p>
<p style="padding-left: 30px;"><img src='http://s.wordpress.com/latex.php?latex=%5Cfrac%7BM_y%7D%7BL%7D%20%2B%20E_y%20%5Capprox%20%7B-%5Cfrac%2012%7D%28%5Cfrac%7BM_x%7D%7BL%7D%20%2B%20%5Csigma%20%2B%20E_x%20-%20B%29%20-%20%5Csigma%20%2B%20B&#038;bg=ffffff&#038;fg=000000&#038;s=2' alt='\frac{M_y}{L} + E_y \approx {-\frac 12}(\frac{M_x}{L} + \sigma + E_x - B) - \sigma + B' title='\frac{M_y}{L} + E_y \approx {-\frac 12}(\frac{M_x}{L} + \sigma + E_x - B) - \sigma + B' class='latex' /></p>
<p style="padding-left: 30px;"><img src='http://s.wordpress.com/latex.php?latex=%5Cfrac%7BM_y%7D%7BL%7D%20%2B%20E_y%20%5Capprox%20%7B-%5Cfrac%2012%7D%28%5Cfrac%7BM_x%7D%7BL%7D%20%2B%20E_x%29%20-%20%5Cfrac%7B3%7D%7B2%7D%28%5Csigma%20-%20B%29&#038;bg=ffffff&#038;fg=000000&#038;s=2' alt='\frac{M_y}{L} + E_y \approx {-\frac 12}(\frac{M_x}{L} + E_x) - \frac{3}{2}(\sigma - B)' title='\frac{M_y}{L} + E_y \approx {-\frac 12}(\frac{M_x}{L} + E_x) - \frac{3}{2}(\sigma - B)' class='latex' /></p>
<p style="padding-left: 30px;"><img src='http://s.wordpress.com/latex.php?latex=M_y%20%2B%20LE_y%20%5Capprox%20%7B%5Cfrac%2032%7DL%28B%20-%20%5Csigma%29%20-%20%7B%5Cfrac%2012%7D%28M_x%20%2B%20LE_x%29&#038;bg=ffffff&#038;fg=000000&#038;s=2' alt='M_y + LE_y \approx {\frac 32}L(B - \sigma) - {\frac 12}(M_x + LE_x)' title='M_y + LE_y \approx {\frac 32}L(B - \sigma) - {\frac 12}(M_x + LE_x)' class='latex' /></p>
<p>After this last step something interesting has happened: among the clutter we now have the value of the integer representations on either side of the equation:</p>
<p style="padding-left: 30px;"><img src='http://s.wordpress.com/latex.php?latex=%5Cmathbf%7BI_y%7D%20%5Capprox%20%7B%5Cfrac%2032%7DL%28B%20-%20%5Csigma%29%20-%20%7B%5Cfrac%2012%7D%5Cmathbf%7BI_x%7D&#038;bg=ffffff&#038;fg=000000&#038;s=2' alt='\mathbf{I_y} \approx {\frac 32}L(B - \sigma) - {\frac 12}\mathbf{I_x}' title='\mathbf{I_y} \approx {\frac 32}L(B - \sigma) - {\frac 12}\mathbf{I_x}' class='latex' /></p>
<p>In other words the integer representation of <em>y</em> is some constant minus half the integer representation of <em>x</em>. Or, in C code:</p>
<pre>i = <em>K</em> - (i &gt;&gt; 1);</pre>
<p>for some <em>K</em>. Looks very familiar right?</p>
<p>Now what remains is to find the constant. We already know what <em>B</em> and <em>L</em> are but we don&#8217;t have σ yet. Remember, σ is the adjustment we used to get the best approximation of the logarithm, so we have some freedom in picking it. I&#8217;ll pick the one that was used to produce the original implementation, 0.0450465. Using this value you get:</p>
<p style="padding-left: 30px;"><img src='http://s.wordpress.com/latex.php?latex=%7B%5Cfrac%2032%7DL%28B%20-%20%5Csigma%29%20%3D%20%7B%5Cfrac%2032%7D2%5E%7B23%7D%28127%20-%200.0450465%29%20%3D%201597463007&#038;bg=ffffff&#038;fg=000000&#038;s=2' alt='{\frac 32}L(B - \sigma) = {\frac 32}2^{23}(127 - 0.0450465) = 1597463007' title='{\frac 32}L(B - \sigma) = {\frac 32}2^{23}(127 - 0.0450465) = 1597463007' class='latex' /></p>
<p>Want to guess what the hex representation of that value is? <code>0x5f3759df</code>. (As it should be of course, since I picked σ to get that value.) So the constant is not a bit pattern as you might think from the fact that it&#8217;s written in hex, it&#8217;s the result of a normal calculation rounded to an integer.</p>
<p>But as Knuth would say: so far we&#8217;ve only proven that this should work, we haven&#8217;t tested it. To give a sense for how accurate the approximation is here is a plot of it along with the accurate inverse square root:</p>
<p><a href="http://blog.quenta.org/wp-content/uploads/2012/09/0.5.png"><img class="aligncenter size-full wp-image-239" title="-0.5" src="http://blog.quenta.org/wp-content/uploads/2012/09/0.5.png" alt="Graph of approximation vs. accurate value" width="600" height="371" /></a></p>
<p>This is for values between 1 and 100. It&#8217;s pretty spot on right? And it should be – it&#8217;s not just magic, as the derivation above shows, it&#8217;s a computation that just happens to use the somewhat exotic but completely well-defined and meaningful operation of bit-casting between float and integer.</p>
<h2>But wait there&#8217;s more!</h2>
<p>Looking at the derivation of this operation tells you something more than just the value of the constant though. You will notice that the derivation hardly depends on the concrete value of any of the terms – they&#8217;re just constants that get shuffled around. This means that if we change them the derivation still holds.</p>
<p>First off, the calculation doesn&#8217;t care what <em>L</em> and <em>B</em> are. They&#8217;re given by the floating-point representation. This means that we can do the same trick for 64- and 128-bit floating-point numbers if we want, all we have to do is recalculate the constant which it the only part that depends on them.</p>
<p>Secondly it doesn&#8217;t care which value we pick for σ. The σ that minimizes the difference between the logarithm and <em>x+σ</em> may not, and indeed does not, give the most accurate approximation. That&#8217;s a combination of floating-point rounding and because of the Newton step. Picking σ is an interesting subject in itself and is covered by <a href="http://www.daxia.com/bibis/upload/406Fast_Inverse_Square_Root.pdf">McEniry</a> and <a href="http://www.lomont.org/Math/Papers/2003/InvSqrt.pdf">Lomont</a>.</p>
<p>Finally, it doesn&#8217;t depend on -1/2. That is, the exponent here happens to be -1/2 but the derivation works just as well for any other exponent between -1 and 1. If we call the exponent <em>p </em>(because <em>e</em> is taken) and do the same derivation with that instead of -1/2 we get:</p>
<p style="padding-left: 30px;"><img src='http://s.wordpress.com/latex.php?latex=%5Cmathbf%7BI_y%7D%20%5Capprox%20%281%20-%20p%29L%28%5Csigma%20-%20B%29%20%2B%20p%5Cmathbf%7BI_x%7D&#038;bg=ffffff&#038;fg=000000&#038;s=2' alt='\mathbf{I_y} \approx (1 - p)L(\sigma - B) + p\mathbf{I_x}' title='\mathbf{I_y} \approx (1 - p)L(\sigma - B) + p\mathbf{I_x}' class='latex' /></p>
<p>Let&#8217;s try a few exponents. First off <em>p</em>=0.5, the normal non-inverse square root:</p>
<p style="padding-left: 30px;"><img src='http://s.wordpress.com/latex.php?latex=%5Cmathbf%7BI_y%7D%20%5Capprox%20K_%7B%5Cfrac%2012%7D%20%2B%20%7B%5Cfrac%2012%7D%5Cmathbf%7BI_x%7D&#038;bg=ffffff&#038;fg=000000&#038;s=2' alt='\mathbf{I_y} \approx K_{\frac 12} + {\frac 12}\mathbf{I_x}' title='\mathbf{I_y} \approx K_{\frac 12} + {\frac 12}\mathbf{I_x}' class='latex' /></p>
<p style="padding-left: 30px;"><img src='http://s.wordpress.com/latex.php?latex=K_%7B%5Cfrac%2012%7D%20%3D%20%7B%5Cfrac%2012%7DL%28B%20-%20%5Csigma%29%20%3D%20%7B%5Cfrac%2012%7D2%5E%7B23%7D%28127%20-%200.0450465%29%20%3D%20%5Cmathtt%7B0x1fbd1df5%7D%20&#038;bg=ffffff&#038;fg=000000&#038;s=2' alt='K_{\frac 12} = {\frac 12}L(B - \sigma) = {\frac 12}2^{23}(127 - 0.0450465) = \mathtt{0x1fbd1df5} ' title='K_{\frac 12} = {\frac 12}L(B - \sigma) = {\frac 12}2^{23}(127 - 0.0450465) = \mathtt{0x1fbd1df5} ' class='latex' /></p>
<p>or in code form,</p>
<pre>i = 0x1fbd1df5 + (i &gt;&gt; 1);</pre>
<p>Does this work too? Sure does:</p>
<p><a href="http://blog.quenta.org/wp-content/uploads/2012/09/0.51.png"><img class="aligncenter size-full wp-image-247" title="0.5" src="http://blog.quenta.org/wp-content/uploads/2012/09/0.51.png" alt="Graph of approximation vs. accurate" width="600" height="371" /></a></p>
<p>This may be a well-known method to approximate the square root but a cursory google and wikipedia search didn&#8217;t suggest that it was.</p>
<p>It even works with &#8220;odd&#8221; powers, like the cube root</p>
<p style="padding-left: 30px;"><img src='http://s.wordpress.com/latex.php?latex=%5Cmathbf%7BI_y%7D%20%5Capprox%20K_%7B%5Cfrac%2013%7D%20%2B%20%7B%5Cfrac%2013%7D%5Cmathbf%7BI_x%7D&#038;bg=ffffff&#038;fg=000000&#038;s=2' alt='\mathbf{I_y} \approx K_{\frac 13} + {\frac 13}\mathbf{I_x}' title='\mathbf{I_y} \approx K_{\frac 13} + {\frac 13}\mathbf{I_x}' class='latex' /></p>
<p style="padding-left: 30px;"><img src='http://s.wordpress.com/latex.php?latex=K_%7B%5Cfrac%2013%7D%20%3D%20%7B%5Cfrac%2023%7DL%28B%20-%20%5Csigma%29%20%3D%20%7B%5Cfrac%2023%7D2%5E%7B23%7D%28127%20-%200.0450465%29%20%3D%20%5Cmathtt%7B0x2a517d3c%7D&#038;bg=ffffff&#038;fg=000000&#038;s=2' alt='K_{\frac 13} = {\frac 23}L(B - \sigma) = {\frac 23}2^{23}(127 - 0.0450465) = \mathtt{0x2a517d3c}' title='K_{\frac 13} = {\frac 23}L(B - \sigma) = {\frac 23}2^{23}(127 - 0.0450465) = \mathtt{0x2a517d3c}' class='latex' /></p>
<p>which corresponds to:</p>
<pre>i = (<strong>int</strong>) (0x2a517d3c + (0.333f * i));</pre>
<p>Since this is an odd factor we can&#8217;t use shift instead of multiplication. Again the approximation is very close:</p>
<p><a href="http://blog.quenta.org/wp-content/uploads/2012/09/0.333.png"><img class="aligncenter size-full wp-image-250" title="0.333" src="http://blog.quenta.org/wp-content/uploads/2012/09/0.333.png" alt="Graph of approximation vs. accurate" width="600" height="371" /></a></p>
<p>At this point you may have noticed that when changing the exponent we&#8217;re actually doing something pretty simple: just adjusting the constant by a linear factor and changing the factor that is multiplied onto the integer representation of the input. These are not expensive operations so it&#8217;s feasible to do them at runtime rather than pre-compute them. If we pre-multiply just the two other factors:</p>
<p style="padding-left: 30px;"><img src='http://s.wordpress.com/latex.php?latex=L%28B%20-%20%5Csigma%29%20%3D%202%5E%7B23%7D%28127%20-%200.0450465%29%20%3D%20%5Cmathtt%7B0x3f7a3bea%7D&#038;bg=ffffff&#038;fg=000000&#038;s=2' alt='L(B - \sigma) = 2^{23}(127 - 0.0450465) = \mathtt{0x3f7a3bea}' title='L(B - \sigma) = 2^{23}(127 - 0.0450465) = \mathtt{0x3f7a3bea}' class='latex' /></p>
<p>we can calculate the value without knowing the exponent in advance:</p>
<pre><span style="color: #000000;">i = (1 - p) * 0x3f7a3bea + (p * i);</span></pre>
<p>If you shuffle the terms around a bit you can even save one of multiplications:</p>
<pre>i = 0x3f7a3bea + p * (i - 0x3f7a3bea);</pre>
<p>This gives you the &#8220;magic&#8221; part of fast exponentiation for any exponent between -1 and 1; the one piece we now need to get a fast exponentiation function that works for all exponents <em>and</em> is as accurate as the original inverse square root function is to generalize the Newton approximation step. I haven&#8217;t looked into that so that&#8217;s for another blog post (most likely for someone other than me).</p>
<p>The expression above contains a new &#8220;magical&#8221; constant,  <code>0x3f7a3bea</code>. But even if it&#8217;s in some sense &#8220;more magical&#8221; than the original constant, since that can be derived from it, it depends on an arbitrary choice of σ so it&#8217;s not universal in any way. I&#8217;ll call it <em>C</em><sub>σ</sub> and we&#8217;ll take a closer look at it in a second.</p>
<p>But first, one sanity check we can try with this formula is when <em>p</em>=0. For a <em>p</em> of zero the result should always be 1 since <em>x</em><sup>0</sup> is 1 independent of <em>x</em>. And indeed the second term falls away because it is multiplied by 0 and so we get simply:</p>
<pre>i = 0x3f7a3bea;</pre>
<p>Which is indeed constant – and interpreted as a floating-point value it&#8217;s 0.977477 also known as &#8220;almost 1&#8243; so the sanity check checks out. That tells us something else too: <em>C</em><sub>σ</sub> actually has a meaningful value when cast to a float. It&#8217;s 1; or very close to it.</p>
<p>That&#8217;s interesting. Let&#8217;s take a closer look. The integer representation of <em>C</em><sub>σ</sub> is</p>
<p style="padding-left: 30px;"><img src='http://s.wordpress.com/latex.php?latex=C_%5Csigma%20%3D%20L%28B%20-%20%5Csigma%29%20%3D%20LB%20-%20L%5Csigma&#038;bg=ffffff&#038;fg=000000&#038;s=2' alt='C_\sigma = L(B - \sigma) = LB - L\sigma' title='C_\sigma = L(B - \sigma) = LB - L\sigma' class='latex' /></p>
<p>This is almost but not quite the shape of a floating-point number, the only problem is that we&#8217;re subtracting rather than adding the second term. That&#8217;s easy to fix though:</p>
<p style="padding-left: 30px;"><img src='http://s.wordpress.com/latex.php?latex=LB%20-%20L%5Csigma%20%3D%20LB%20-%20L%20%2B%20L%20-%20L%5Csigma%20%3D%20L%28B%20-%201%29%20%2B%20L%281%20-%20%5Csigma%29&#038;bg=ffffff&#038;fg=000000&#038;s=2' alt='LB - L\sigma = LB - L + L - L\sigma = L(B - 1) + L(1 - \sigma)' title='LB - L\sigma = LB - L + L - L\sigma = L(B - 1) + L(1 - \sigma)' class='latex' /></p>
<p>Now it looks exactly like the integer representation of a floating-point number. To see which we&#8217;ll first determine the exponent and mantissa and then calculate the value, <em>c</em><sub>σ</sub>. This is the exponent:</p>
<p style="padding-left: 30px;"><img src='http://s.wordpress.com/latex.php?latex=e_%7Bc_%5Csigma%7D%20%3D%20%28E_%7BC_%5Csigma%7D%20-%20B%29%20%3D%20%28B%20-%201%20-%20B%29%20%3D%20-1&#038;bg=ffffff&#038;fg=000000&#038;s=2' alt='e_{c_\sigma} = (E_{C_\sigma} - B) = (B - 1 - B) = -1' title='e_{c_\sigma} = (E_{C_\sigma} - B) = (B - 1 - B) = -1' class='latex' /></p>
<p>and this is the mantissa:</p>
<p style="padding-left: 30px;"><img src='http://s.wordpress.com/latex.php?latex=m_%7Bc_%5Csigma%7D%20%3D%20%5Cfrac%7BM_%7BC_%5Csigma%7D%7D%7BL%7D%20%3D%20%5Cfrac%7BL%281%20-%20%5Csigma%29%7D%7BL%7D%20%3D%201%20-%20%5Csigma&#038;bg=ffffff&#038;fg=000000&#038;s=2' alt='m_{c_\sigma} = \frac{M_{C_\sigma}}{L} = \frac{L(1 - \sigma)}{L} = 1 - \sigma' title='m_{c_\sigma} = \frac{M_{C_\sigma}}{L} = \frac{L(1 - \sigma)}{L} = 1 - \sigma' class='latex' /></p>
<p>So the floating-point value of the constant is (drumroll):</p>
<p style="padding-left: 30px;"><img src='http://s.wordpress.com/latex.php?latex=c_%5Csigma%20%3D%20%281%20%2B%20m_%7Bc_%5Csigma%7D%292%5E%7Be_%7Bc_%5Csigma%7D%7D%20%3D%20%5Cfrac%7B1%20%2B%201%20-%20%5Csigma%7D2%20%3D%201%20-%20%5Cfrac%7B%5Csigma%7D2&#038;bg=ffffff&#038;fg=000000&#038;s=2' alt='c_\sigma = (1 + m_{c_\sigma})2^{e_{c_\sigma}} = \frac{1 + 1 - \sigma}2 = 1 - \frac{\sigma}2' title='c_\sigma = (1 + m_{c_\sigma})2^{e_{c_\sigma}} = \frac{1 + 1 - \sigma}2 = 1 - \frac{\sigma}2' class='latex' /></p>
<p>And indeed if you divide our original σ from earlier, 0.0450465, by 2 you get 0.02252325; subtract it from 1 you get 0.97747675 or our friend &#8220;almost 1&#8243; from a moment ago. That gives us a second way to view <em>C</em><sub>σ</sub>, as the integer representation of a floating-point number, and to calculate it in code:</p>
<pre><strong>float</strong> sigma = 0.0450465;
<strong>float</strong> c_sigma = 1 - (0.5f * sigma);
<strong>int</strong> C_sigma = *(*<strong>int</strong>)&amp;c_sigma;</pre>
<p>Note that for a fixed σ these are all constants and the compiler should be able to optimize this whole computation away. The result is <code>0x3f7a3beb</code> – not exactly <code>0x3f7a3bea</code> from before but just one bit away (the least significant one) which is to be expected for computations that involve floating-point numbers. Getting to the original constant, the title of this post, is a matter of multiplying the result by 1.5.</p>
<p>With that we&#8217;ve gotten close enough to the bottom to satisfy at least me that there is nothing magical going on here. For me the main lesson from this exercise is that bit-casting between integers and floats is not just a meaningless operation, it&#8217;s an exotic but very cheap numeric operation that can be useful in computations. And I expect there&#8217;s more uses of it out there waiting to be discovered.</p>
<p>(Update: I&#8217;ve added an <a href="http://blog.quenta.org/2012/09/0x5f3759df-appendix.html">appendix</a> about the intuition behind the part where I shuffle around the floating-point terms and the integer terms appear.)</p>
<div class="sharedaddy sd-sharing-enabled"><div class="robots-nocontent sd-block sd-social sd-social-official sd-sharing"><h3 class="sd-title">Share this:</h3><div class="sd-content"><ul><li class="share-google-plus-1"><div class="googleplus1_button"><div class="g-plusone" data-size="medium" data-callback="sharing_plusone" data-href="http://blog.quenta.org/2012/09/0x5f3759df.html"></div></div></li><li class="share-facebook"><div class="like_button"><iframe src="http://www.facebook.com/plugins/like.php?href=http%3A%2F%2Fblog.quenta.org%2F2012%2F09%2F0x5f3759df.html&amp;layout=button_count&amp;show_faces=false&amp;action=like&amp;colorscheme=light&amp;height=21&amp;width=90" scrolling="no" frameborder="0" style="border:none; overflow:hidden; width:96px; height:21px;" allowTransparency="true"></iframe></div></li><li class="share-linkedin"><div class="linkedin_button"><script type="in/share" data-url="http://blog.quenta.org/2012/09/0x5f3759df.html" data-counter="right"></script></div></li><li class="share-twitter"><div class="twitter_button"><iframe allowtransparency="true" frameborder="0" scrolling="no" src="http://platform.twitter.com/widgets/tweet_button.html?url=http%3A%2F%2Fblog.quenta.org%2F2012%2F09%2F0x5f3759df.html&#038;counturl=http%3A%2F%2Fblog.quenta.org%2F2012%2F09%2F0x5f3759df.html&#038;count=horizontal&#038;text=0x5f3759df%3A" style="width:101px; height:20px;"></iframe></div></li><li class="share-reddit"><div class="reddit_button"><iframe src="http://www.reddit.com/static/button/button1.html?width=120&amp;url=http%3A%2F%2Fblog.quenta.org%2F2012%2F09%2F0x5f3759df.html&amp;title=0x5f3759df" height="22" width="120" scrolling="no" frameborder="0"></iframe></div></li><li class="share-stumbleupon"><div class="stumbleupon_button"><iframe src="http://www.stumbleupon.com/badge/embed/1/?url=http%3A%2F%2Fblog.quenta.org%2F2012%2F09%2F0x5f3759df.html&amp;title=0x5f3759df" scrolling="no" frameborder="0" style="border:none; overflow:hidden; width:74px; height: 18px;" allowTransparency="true"></iframe></div></li><li class="share-end"></li></ul><div class="sharing-clear"></div></div></div></div>											</div><!-- .entry-content -->


					<div class="entry-utility">
												This entry was posted in <a href="http://blog.quenta.org/category/c" title="View all posts in C++" rel="category tag">C++</a>, <a href="http://blog.quenta.org/category/mathematics" title="View all posts in mathematics" rel="category tag">mathematics</a>, <a href="http://blog.quenta.org/category/programming" title="View all posts in programming" rel="category tag">programming</a>. Bookmark the <a href="http://blog.quenta.org/2012/09/0x5f3759df.html" title="Permalink to 0x5f3759df" rel="bookmark">permalink</a>.											</div><!-- .entry-utility -->
				</article><!-- #post-## -->

				<nav id="nav-below" class="navigation">
					<div class="nav-previous"><a href="http://blog.quenta.org/2012/08/reload.html" rel="prev"><span class="meta-nav">&larr;</span> Reload?</a></div>
					<div class="nav-next"><a href="http://blog.quenta.org/2012/09/0x5f3759df-appendix.html" rel="next">0x5f3759df (appendix) <span class="meta-nav">&rarr;</span></a></div>
				</nav><!-- #nav-below -->

							<div id="comments">

			<h3 id="comments-title">71 Responses to <em>0x5f3759df</em></h3>

	
			<ol class="commentlist">
						<li class="comment even thread-even depth-1" id="li-comment-414">
			<div id="comment-414">
			<div class="comment-author vcard">
				<img alt='' src='http://1.gravatar.com/avatar/74a1a6b65bbe5ad874af0aa193dc76dc?s=40&amp;d=&amp;r=G' class='avatar avatar-40 photo' height='40' width='40' />				<cite class="fn"><a href='http://unspecified.wordpress.com' rel='external nofollow' class='url'>Matt Giuca</a></cite> <span class="says">says:</span>			</div><!-- .comment-author .vcard -->
				
			<div class="comment-meta commentmetadata"><a href="http://blog.quenta.org/2012/09/0x5f3759df.html#comment-414">
				September 15, 2012 at 13:25</a>			</div><!-- .comment-meta .commentmetadata -->
	
			<div class="comment-body"><p>This is a work of genius. The first half is a brilliant and readable explanation of how it works. The second half smashes through the looking glass. Brilliant. It&#8217;s especially impressive that you managed to do it with a regular square root.</p>
<p>Assuming those graphs are the approximate result <em>without</em> the Newton step, I wonder why that step is required at all.</p>
<p>A few notes:<br />
- In the C code sample, return x is on the same line as the comment.<br />
- &#8220;Enter InvSqrt&#8221; should be &#8220;Enter FastInvSqrt&#8221;<br />
- ln_2 should be log_2, shouldn&#8217;t it? ln specifically refers to log_e.<br />
- log_2(1 + m)e should be log_2(1 + m) + e, shouldn&#8217;t it? Looks like the step after this is correct, so it&#8217;s not a maths error, just a missing plus. Also you need parens around this expression in the halved version on the right-hand side.</p>
</div>
	
			<div class="reply">
				<a class='comment-reply-link' href='/2012/09/0x5f3759df.html?replytocom=414#respond' onclick='return addComment.moveForm("comment-414", "414", "respond", "168")'>Reply</a>			</div><!-- .reply -->
		</div><!-- #comment-##  -->
	
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-415">
			<div id="comment-415">
			<div class="comment-author vcard">
				<img alt='' src='http://1.gravatar.com/avatar/74a1a6b65bbe5ad874af0aa193dc76dc?s=40&amp;d=&amp;r=G' class='avatar avatar-40 photo' height='40' width='40' />				<cite class="fn"><a href='http://unspecified.wordpress.com' rel='external nofollow' class='url'>Matt Giuca</a></cite> <span class="says">says:</span>			</div><!-- .comment-author .vcard -->
				
			<div class="comment-meta commentmetadata"><a href="http://blog.quenta.org/2012/09/0x5f3759df.html#comment-415">
				September 15, 2012 at 14:20</a>			</div><!-- .comment-meta .commentmetadata -->
	
			<div class="comment-body"><p>Another thought: I&#8217;m assuming that this approach fails completely when it comes to <em>denormalized</em> numbers. You conveniently skipped discussing normalization, which you introduced in the step where you introduced (1 + <i>m</i>). This will cover all numbers greater than or equal to 2^-126. For any smaller numbers, (1 + <i>m</i>) should just be <i>m</i>. Not that this really matters &#8212; I doubt most applications are going to require numbers that small, nor is the inverse square root meaningful in the zero case, but still interesting to know whether it will handle these numbers (and I suspect it won&#8217;t).</p>
</div>
	
			<div class="reply">
				<a class='comment-reply-link' href='/2012/09/0x5f3759df.html?replytocom=415#respond' onclick='return addComment.moveForm("comment-415", "415", "respond", "168")'>Reply</a>			</div><!-- .reply -->
		</div><!-- #comment-##  -->
	
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-plesner bypostauthor even thread-even depth-1" id="li-comment-416">
			<div id="comment-416">
			<div class="comment-author vcard">
				<img alt='' src='http://1.gravatar.com/avatar/d65f60d48417ac4f04f73712268bfa6b?s=40&amp;d=&amp;r=G' class='avatar avatar-40 photo' height='40' width='40' />				<cite class="fn">Christian Plesner Hansen</cite> <span class="says">says:</span>			</div><!-- .comment-author .vcard -->
				
			<div class="comment-meta commentmetadata"><a href="http://blog.quenta.org/2012/09/0x5f3759df.html#comment-416">
				September 15, 2012 at 14:23</a>			</div><!-- .comment-meta .commentmetadata -->
	
			<div class="comment-body"><p><i>Blushing</i></p>
<p>Thanks for the notes, you&#8217;re right on all points. The C code issue is wordpress messing up my formatting. The rest is just sloppiness transcribing my notes.</p>
<p>Around the Newton step my guess would be that they tried without it and got visible artifacts in whatever it was they were rendering. There are some visible breaks in the approximation graph (&#8220;disdifferentianuities&#8221;?) which I would guess shows up visibly if you&#8217;re trying to render a smooth surface where the normals vary slowly and cross one of the breaks. But that&#8217;s a pure guess.</p>
</div>
	
			<div class="reply">
				<a class='comment-reply-link' href='/2012/09/0x5f3759df.html?replytocom=416#respond' onclick='return addComment.moveForm("comment-416", "416", "respond", "168")'>Reply</a>			</div><!-- .reply -->
		</div><!-- #comment-##  -->
	
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-plesner bypostauthor odd alt thread-odd thread-alt depth-1" id="li-comment-418">
			<div id="comment-418">
			<div class="comment-author vcard">
				<img alt='' src='http://1.gravatar.com/avatar/d65f60d48417ac4f04f73712268bfa6b?s=40&amp;d=&amp;r=G' class='avatar avatar-40 photo' height='40' width='40' />				<cite class="fn">Christian Plesner Hansen</cite> <span class="says">says:</span>			</div><!-- .comment-author .vcard -->
				
			<div class="comment-meta commentmetadata"><a href="http://blog.quenta.org/2012/09/0x5f3759df.html#comment-418">
				September 15, 2012 at 19:26</a>			</div><!-- .comment-meta .commentmetadata -->
	
			<div class="comment-body"><p>Good point Matt,  to be honest that issue hadn&#8217;t even occurred to me.</p>
<p>I think you&#8217;re right that it doesn&#8217;t give the correct result for denormalized values. The approximation of log2 breaks down majorly if you&#8217;re outside 1+(0..1). This is also an issue for the output so even if your input is normalized, if the correct output would have been denormalized then the algorithm probably gives the wrong result too.</p>
<p>However, the accuracy of approximation generally improves with the magnitude of the input. When you&#8217;re near 0 the result is already quite inaccurate so I suspect the error caused by not interpreting denormalized values correctly may not be significantly worse than the error for tiny normalized values. And hopefully the Newton step helps somewhat there.</p>
</div>
	
			<div class="reply">
				<a class='comment-reply-link' href='/2012/09/0x5f3759df.html?replytocom=418#respond' onclick='return addComment.moveForm("comment-418", "418", "respond", "168")'>Reply</a>			</div><!-- .reply -->
		</div><!-- #comment-##  -->
	
		</li><!-- #comment-## -->
		<li class="post pingback">
			<p>Pingback: <a href='http://vvv.koehntopp.de/wpkris/?p=385610' rel='external nofollow' class='url'>After a discussion about the fast inverse square root function at the office my stubbornness&#8230; | Die wunderbare Welt von Isotopp</a></p>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="li-comment-423">
			<div id="comment-423">
			<div class="comment-author vcard">
				<img alt='' src='http://0.gravatar.com/avatar/cbc1c6307da1111de857811cf123cc7a?s=40&amp;d=&amp;r=G' class='avatar avatar-40 photo' height='40' width='40' />				<cite class="fn"><a href='http://wakaba.c3.cx/' rel='external nofollow' class='url'>Dag Ågren</a></cite> <span class="says">says:</span>			</div><!-- .comment-author .vcard -->
				
			<div class="comment-meta commentmetadata"><a href="http://blog.quenta.org/2012/09/0x5f3759df.html#comment-423">
				September 16, 2012 at 02:53</a>			</div><!-- .comment-meta .commentmetadata -->
	
			<div class="comment-body"><p>You seem to have a slight misprint in there: I think that </p>
<p>M_y / L + E_y ≈ -1/2 (M_x / L + E_x) &#8211; 3/2 (σ + B)</p>
<p>should be</p>
<p>M_y / L + E_y ≈ -1/2 (M_x / L + E_x) &#8211; 3/2 (σ &#8211; B)</p>
</div>
	
			<div class="reply">
				<a class='comment-reply-link' href='/2012/09/0x5f3759df.html?replytocom=423#respond' onclick='return addComment.moveForm("comment-423", "423", "respond", "168")'>Reply</a>			</div><!-- .reply -->
		</div><!-- #comment-##  -->
	
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-426">
			<div id="comment-426">
			<div class="comment-author vcard">
				<img alt='' src='http://0.gravatar.com/avatar/480f7f998a2d4bdca2b2e86b685f367b?s=40&amp;d=&amp;r=G' class='avatar avatar-40 photo' height='40' width='40' />				<cite class="fn"><a href='http://www.bcastell.com' rel='external nofollow' class='url'>Brandon Castellano</a></cite> <span class="says">says:</span>			</div><!-- .comment-author .vcard -->
				
			<div class="comment-meta commentmetadata"><a href="http://blog.quenta.org/2012/09/0x5f3759df.html#comment-426">
				September 16, 2012 at 04:45</a>			</div><!-- .comment-meta .commentmetadata -->
	
			<div class="comment-body"><p>Excellent read, thanks for posting.  Very nice walk-through the logic and implementation behind the algorithm (even if it is just an approximation).  I&#8217;m curious, what (program?) did you use to make your graphs?  They look very nice and crisp!</p>
</div>
	
			<div class="reply">
				<a class='comment-reply-link' href='/2012/09/0x5f3759df.html?replytocom=426#respond' onclick='return addComment.moveForm("comment-426", "426", "respond", "168")'>Reply</a>			</div><!-- .reply -->
		</div><!-- #comment-##  -->
	
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="li-comment-427">
			<div id="comment-427">
			<div class="comment-author vcard">
				<img alt='' src='http://1.gravatar.com/avatar/357a20e8c56e69d6f9734d23ef9517e8?s=40&amp;d=&amp;r=G' class='avatar avatar-40 photo' height='40' width='40' />				<cite class="fn">charlie</cite> <span class="says">says:</span>			</div><!-- .comment-author .vcard -->
				
			<div class="comment-meta commentmetadata"><a href="http://blog.quenta.org/2012/09/0x5f3759df.html#comment-427">
				September 16, 2012 at 05:04</a>			</div><!-- .comment-meta .commentmetadata -->
	
			<div class="comment-body"><p>Very cool. Great write-up.</p>
</div>
	
			<div class="reply">
				<a class='comment-reply-link' href='/2012/09/0x5f3759df.html?replytocom=427#respond' onclick='return addComment.moveForm("comment-427", "427", "respond", "168")'>Reply</a>			</div><!-- .reply -->
		</div><!-- #comment-##  -->
	
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-plesner bypostauthor odd alt thread-odd thread-alt depth-1" id="li-comment-428">
			<div id="comment-428">
			<div class="comment-author vcard">
				<img alt='' src='http://1.gravatar.com/avatar/d65f60d48417ac4f04f73712268bfa6b?s=40&amp;d=&amp;r=G' class='avatar avatar-40 photo' height='40' width='40' />				<cite class="fn">Christian Plesner Hansen</cite> <span class="says">says:</span>			</div><!-- .comment-author .vcard -->
				
			<div class="comment-meta commentmetadata"><a href="http://blog.quenta.org/2012/09/0x5f3759df.html#comment-428">
				September 16, 2012 at 05:19</a>			</div><!-- .comment-meta .commentmetadata -->
	
			<div class="comment-body"><p>@Dag: you&#8217;re right, thanks for the correction.</p>
</div>
	
			<div class="reply">
				<a class='comment-reply-link' href='/2012/09/0x5f3759df.html?replytocom=428#respond' onclick='return addComment.moveForm("comment-428", "428", "respond", "168")'>Reply</a>			</div><!-- .reply -->
		</div><!-- #comment-##  -->
	
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-plesner bypostauthor even thread-even depth-1" id="li-comment-429">
			<div id="comment-429">
			<div class="comment-author vcard">
				<img alt='' src='http://1.gravatar.com/avatar/d65f60d48417ac4f04f73712268bfa6b?s=40&amp;d=&amp;r=G' class='avatar avatar-40 photo' height='40' width='40' />				<cite class="fn">Christian Plesner Hansen</cite> <span class="says">says:</span>			</div><!-- .comment-author .vcard -->
				
			<div class="comment-meta commentmetadata"><a href="http://blog.quenta.org/2012/09/0x5f3759df.html#comment-429">
				September 16, 2012 at 05:24</a>			</div><!-- .comment-meta .commentmetadata -->
	
			<div class="comment-body"><p>@Brandon: google docs. &#8220;Save image&#8221; on a graph in a google docs spreadsheet gives you this kind of graph.</p>
</div>
	
			<div class="reply">
				<a class='comment-reply-link' href='/2012/09/0x5f3759df.html?replytocom=429#respond' onclick='return addComment.moveForm("comment-429", "429", "respond", "168")'>Reply</a>			</div><!-- .reply -->
		</div><!-- #comment-##  -->
	
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-431">
			<div id="comment-431">
			<div class="comment-author vcard">
				<img alt='' src='http://0.gravatar.com/avatar/6eda320a9b491fbd6f803a7dc34b36ec?s=40&amp;d=&amp;r=G' class='avatar avatar-40 photo' height='40' width='40' />				<cite class="fn">Zyx</cite> <span class="says">says:</span>			</div><!-- .comment-author .vcard -->
				
			<div class="comment-meta commentmetadata"><a href="http://blog.quenta.org/2012/09/0x5f3759df.html#comment-431">
				September 16, 2012 at 06:18</a>			</div><!-- .comment-meta .commentmetadata -->
	
			<div class="comment-body"><p>Wonderful post. Demystify the whole topic. Thanks!</p>
</div>
	
			<div class="reply">
				<a class='comment-reply-link' href='/2012/09/0x5f3759df.html?replytocom=431#respond' onclick='return addComment.moveForm("comment-431", "431", "respond", "168")'>Reply</a>			</div><!-- .reply -->
		</div><!-- #comment-##  -->
	
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="li-comment-432">
			<div id="comment-432">
			<div class="comment-author vcard">
				<img alt='' src='http://0.gravatar.com/avatar/6ee67a69359a023d7e1f272661515ce8?s=40&amp;d=&amp;r=G' class='avatar avatar-40 photo' height='40' width='40' />				<cite class="fn">Philipp Schelske</cite> <span class="says">says:</span>			</div><!-- .comment-author .vcard -->
				
			<div class="comment-meta commentmetadata"><a href="http://blog.quenta.org/2012/09/0x5f3759df.html#comment-432">
				September 16, 2012 at 06:19</a>			</div><!-- .comment-meta .commentmetadata -->
	
			<div class="comment-body"><p>You say that it leaves 27 bits fot the mantisse. but the correct value should be 23. There is 1 bit for the s, 8 for the e ans that leaves only 23 open for the mantisse. or did I made a mistake? otherwise a very nice article.</p>
</div>
	
			<div class="reply">
				<a class='comment-reply-link' href='/2012/09/0x5f3759df.html?replytocom=432#respond' onclick='return addComment.moveForm("comment-432", "432", "respond", "168")'>Reply</a>			</div><!-- .reply -->
		</div><!-- #comment-##  -->
	
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-433">
			<div id="comment-433">
			<div class="comment-author vcard">
				<img alt='' src='http://0.gravatar.com/avatar/ac67d035cc08c4fe3a7ab9825f95b47a?s=40&amp;d=&amp;r=G' class='avatar avatar-40 photo' height='40' width='40' />				<cite class="fn">Sampo</cite> <span class="says">says:</span>			</div><!-- .comment-author .vcard -->
				
			<div class="comment-meta commentmetadata"><a href="http://blog.quenta.org/2012/09/0x5f3759df.html#comment-433">
				September 16, 2012 at 06:27</a>			</div><!-- .comment-meta .commentmetadata -->
	
			<div class="comment-body"><p>Great write-up and nostalgia.  Unfortunately time has somewhat passed these ultra-optimizations, as FPU&#8217;s and GPU&#8217;s are more tightly integrated with the CPU.  I did a quick&#8217;n&#8217;dirty benchmark and at least on Java the performance of the fast-inv was 25% faster than using Math.sqrt (which does double-precision).  While certainly an improvement, it&#8217;s not necessarily enough to warrant starting changing your implementation unless it&#8217;s really time-critical.  I believe the difference has been significanly larger earlier.</p>
</div>
	
			<div class="reply">
				<a class='comment-reply-link' href='/2012/09/0x5f3759df.html?replytocom=433#respond' onclick='return addComment.moveForm("comment-433", "433", "respond", "168")'>Reply</a>			</div><!-- .reply -->
		</div><!-- #comment-##  -->
	
		<ul class="children">
		<li class="comment even depth-2" id="li-comment-436">
			<div id="comment-436">
			<div class="comment-author vcard">
				<img alt='' src='http://0.gravatar.com/avatar/ac67d035cc08c4fe3a7ab9825f95b47a?s=40&amp;d=&amp;r=G' class='avatar avatar-40 photo' height='40' width='40' />				<cite class="fn">Sampo</cite> <span class="says">says:</span>			</div><!-- .comment-author .vcard -->
				
			<div class="comment-meta commentmetadata"><a href="http://blog.quenta.org/2012/09/0x5f3759df.html#comment-436">
				September 16, 2012 at 06:47</a>			</div><!-- .comment-meta .commentmetadata -->
	
			<div class="comment-body"><p>Well, a quick test with C shows ~50% speed improvement, that&#8217;s quite significant still.  Have to keep this one in mind.  <img src="http://blog.quenta.org/wp-includes/images/smilies/icon_smile.gif" alt=":)" class="wp-smiley" /> </p>
</div>
	
			<div class="reply">
				<a class='comment-reply-link' href='/2012/09/0x5f3759df.html?replytocom=436#respond' onclick='return addComment.moveForm("comment-436", "436", "respond", "168")'>Reply</a>			</div><!-- .reply -->
		</div><!-- #comment-##  -->
	
		<ul class="children">
		<li class="comment odd alt depth-3" id="li-comment-447">
			<div id="comment-447">
			<div class="comment-author vcard">
				<img alt='' src='http://0.gravatar.com/avatar/cbc1c6307da1111de857811cf123cc7a?s=40&amp;d=&amp;r=G' class='avatar avatar-40 photo' height='40' width='40' />				<cite class="fn">Dag Ågren</cite> <span class="says">says:</span>			</div><!-- .comment-author .vcard -->
				
			<div class="comment-meta commentmetadata"><a href="http://blog.quenta.org/2012/09/0x5f3759df.html#comment-447">
				September 16, 2012 at 12:11</a>			</div><!-- .comment-meta .commentmetadata -->
	
			<div class="comment-body"><p>You should try comparing against the intrinsics for the hardware approximate inverse square root instead, though.</p>
</div>
	
			<div class="reply">
				<a class='comment-reply-link' href='/2012/09/0x5f3759df.html?replytocom=447#respond' onclick='return addComment.moveForm("comment-447", "447", "respond", "168")'>Reply</a>			</div><!-- .reply -->
		</div><!-- #comment-##  -->
	
		</li><!-- #comment-## -->
		<li class="comment even depth-3" id="li-comment-461">
			<div id="comment-461">
			<div class="comment-author vcard">
				<img alt='' src='http://0.gravatar.com/avatar/480f7f998a2d4bdca2b2e86b685f367b?s=40&amp;d=&amp;r=G' class='avatar avatar-40 photo' height='40' width='40' />				<cite class="fn"><a href='http://www.bcastell.com' rel='external nofollow' class='url'>Brandon Castellano</a></cite> <span class="says">says:</span>			</div><!-- .comment-author .vcard -->
				
			<div class="comment-meta commentmetadata"><a href="http://blog.quenta.org/2012/09/0x5f3759df.html#comment-461">
				September 16, 2012 at 23:58</a>			</div><!-- .comment-meta .commentmetadata -->
	
			<div class="comment-body"><p>Could you post the test code you&#8217;re using?  On a 64-bit machine using VS2010, the following function is consistently within 5% as fast as the posted FastInvSqrt function:</p>
<p><code><br />
double NormalInvSqrt(double x)<br />
{<br />
	return (1.0 / sqrt(x));<br />
}<br />
</code></p>
<p>This uses the sqrt() defined in the  header (Win7 x64 Pro, Visual Studio 2010).  I&#8217;d assume the performance penalties are significantly lesser on 64-bit machines now, since the 64-bit double precision floating point variables are now 1 word long (from the perspective of the CPU, not the instruction set nomenclature).  </p>
<p>Interestingly (or maybe not, considering the above), I found the following code to be 3 times <i>slower</i> then the posted FastInvSqrt() function:</p>
<p><code><br />
float NormalInvSqrt(float x)<br />
{<br />
	return (1.0f / sqrt(x));<br />
}<br />
</code>  </p>
<p>The only difference between this code snippet and the above is the variable types used (float instead of double).</p>
</div>
	
			<div class="reply">
				<a class='comment-reply-link' href='/2012/09/0x5f3759df.html?replytocom=461#respond' onclick='return addComment.moveForm("comment-461", "461", "respond", "168")'>Reply</a>			</div><!-- .reply -->
		</div><!-- #comment-##  -->
	
		<ul class="children">
		<li class="comment byuser comment-author-plesner bypostauthor odd alt depth-4" id="li-comment-476">
			<div id="comment-476">
			<div class="comment-author vcard">
				<img alt='' src='http://1.gravatar.com/avatar/d65f60d48417ac4f04f73712268bfa6b?s=40&amp;d=&amp;r=G' class='avatar avatar-40 photo' height='40' width='40' />				<cite class="fn">Christian Plesner Hansen</cite> <span class="says">says:</span>			</div><!-- .comment-author .vcard -->
				
			<div class="comment-meta commentmetadata"><a href="http://blog.quenta.org/2012/09/0x5f3759df.html#comment-476">
				September 17, 2012 at 20:13</a>			</div><!-- .comment-meta .commentmetadata -->
	
			<div class="comment-body"><p>I was mainly interested in the math so my test code is all about correctness, not performance. But I&#8217;m not surprised that it can&#8217;t compete on a modern architecture.</p>
<p>Btw, for a more accurate comparison on a 64-bit architecture you should probably use a 64-bit version of FastInvSqrt.</p>
</div>
	
			<div class="reply">
				<a class='comment-reply-link' href='/2012/09/0x5f3759df.html?replytocom=476#respond' onclick='return addComment.moveForm("comment-476", "476", "respond", "168")'>Reply</a>			</div><!-- .reply -->
		</div><!-- #comment-##  -->
	
		</li><!-- #comment-## -->
		<li class="comment even depth-4" id="li-comment-75232">
			<div id="comment-75232">
			<div class="comment-author vcard">
				<img alt='' src='http://1.gravatar.com/avatar/d5ddd37eb8b124ec921fee5a1f40c737?s=40&amp;d=&amp;r=G' class='avatar avatar-40 photo' height='40' width='40' />				<cite class="fn">Henrik Holst</cite> <span class="says">says:</span>			</div><!-- .comment-author .vcard -->
				
			<div class="comment-meta commentmetadata"><a href="http://blog.quenta.org/2012/09/0x5f3759df.html#comment-75232">
				November 15, 2013 at 00:50</a>			</div><!-- .comment-meta .commentmetadata -->
	
			<div class="comment-body"><p>Try sqrtf instead of sqrt.</p>
</div>
	
			<div class="reply">
				<a class='comment-reply-link' href='/2012/09/0x5f3759df.html?replytocom=75232#respond' onclick='return addComment.moveForm("comment-75232", "75232", "respond", "168")'>Reply</a>			</div><!-- .reply -->
		</div><!-- #comment-##  -->
	
		</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
		<li class="comment odd alt depth-2" id="li-comment-2027">
			<div id="comment-2027">
			<div class="comment-author vcard">
				<img alt='' src='http://0.gravatar.com/avatar/e6e32317823b0514da2ee1191ee60c64?s=40&amp;d=&amp;r=G' class='avatar avatar-40 photo' height='40' width='40' />				<cite class="fn">AMS</cite> <span class="says">says:</span>			</div><!-- .comment-author .vcard -->
				
			<div class="comment-meta commentmetadata"><a href="http://blog.quenta.org/2012/09/0x5f3759df.html#comment-2027">
				October 30, 2012 at 07:51</a>			</div><!-- .comment-meta .commentmetadata -->
	
			<div class="comment-body"><p>Where this really shines is in limited hardware.  Take an ARM-CortexM4F.  It&#8217;s 32-bit and has a few single-precision float instrucitons, but sqrt takes 14 clocks and divide takes the same 14clocks.  FP multiply takes 3 so you can get inverse squareroot with 14 or 15 clocks rather than 28 using this method.  This also makes a nice fast method for calculating non-2 fractional roots.</p>
</div>
	
			<div class="reply">
				<a class='comment-reply-link' href='/2012/09/0x5f3759df.html?replytocom=2027#respond' onclick='return addComment.moveForm("comment-2027", "2027", "respond", "168")'>Reply</a>			</div><!-- .reply -->
		</div><!-- #comment-##  -->
	
		</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="li-comment-434">
			<div id="comment-434">
			<div class="comment-author vcard">
				<img alt='' src='http://0.gravatar.com/avatar/0b3b2bff3d65155703489c88fe16c44e?s=40&amp;d=&amp;r=G' class='avatar avatar-40 photo' height='40' width='40' />				<cite class="fn">Nils</cite> <span class="says">says:</span>			</div><!-- .comment-author .vcard -->
				
			<div class="comment-meta commentmetadata"><a href="http://blog.quenta.org/2012/09/0x5f3759df.html#comment-434">
				September 16, 2012 at 06:33</a>			</div><!-- .comment-meta .commentmetadata -->
	
			<div class="comment-body"><p>Great read!</p>
<p>What threw me off for an instant was that you said &#8220;and the mantissa bottom 27&#8243; and then &#8220;For 32-bit floats L is 2^23&#8243;. I believe the 27 is a typo, yes?</p>
</div>
	
			<div class="reply">
				<a class='comment-reply-link' href='/2012/09/0x5f3759df.html?replytocom=434#respond' onclick='return addComment.moveForm("comment-434", "434", "respond", "168")'>Reply</a>			</div><!-- .reply -->
		</div><!-- #comment-##  -->
	
		<ul class="children">
		<li class="comment byuser comment-author-plesner bypostauthor odd alt depth-2" id="li-comment-439">
			<div id="comment-439">
			<div class="comment-author vcard">
				<img alt='' src='http://1.gravatar.com/avatar/d65f60d48417ac4f04f73712268bfa6b?s=40&amp;d=&amp;r=G' class='avatar avatar-40 photo' height='40' width='40' />				<cite class="fn">Christian Plesner Hansen</cite> <span class="says">says:</span>			</div><!-- .comment-author .vcard -->
				
			<div class="comment-meta commentmetadata"><a href="http://blog.quenta.org/2012/09/0x5f3759df.html#comment-439">
				September 16, 2012 at 07:17</a>			</div><!-- .comment-meta .commentmetadata -->
	
			<div class="comment-body"><p>Yup, another mistake. Thanks.</p>
</div>
	
			<div class="reply">
				<a class='comment-reply-link' href='/2012/09/0x5f3759df.html?replytocom=439#respond' onclick='return addComment.moveForm("comment-439", "439", "respond", "168")'>Reply</a>			</div><!-- .reply -->
		</div><!-- #comment-##  -->
	
		</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
		<li class="comment even thread-odd thread-alt depth-1" id="li-comment-435">
			<div id="comment-435">
			<div class="comment-author vcard">
				<img alt='' src='http://0.gravatar.com/avatar/e509a93bbe4753860062cb6886987ccf?s=40&amp;d=&amp;r=G' class='avatar avatar-40 photo' height='40' width='40' />				<cite class="fn">Geoffrey Dixon-Ernst</cite> <span class="says">says:</span>			</div><!-- .comment-author .vcard -->
				
			<div class="comment-meta commentmetadata"><a href="http://blog.quenta.org/2012/09/0x5f3759df.html#comment-435">
				September 16, 2012 at 06:42</a>			</div><!-- .comment-meta .commentmetadata -->
	
			<div class="comment-body"><p>This is a fantastic and fascinating post!  I was playing around with some of your equations and noticed that the original derivation (for p = -0.5) is not a special case of the general equation listed.  I think that the generic formula should read:</p>
<p>I_y ≈ (1-p)*L(sigma &#8211; B) + p*I_x</p>
<p>instead of</p>
<p>I_y ≈ (p-1)*L(sigma &#8211; B) + p*I_x</p>
<p>The error propagates through the rest of the post (e.g., it is the cause of the spurious negative number you get in your sanity check&#8230;).</p>
</div>
	
			<div class="reply">
				<a class='comment-reply-link' href='/2012/09/0x5f3759df.html?replytocom=435#respond' onclick='return addComment.moveForm("comment-435", "435", "respond", "168")'>Reply</a>			</div><!-- .reply -->
		</div><!-- #comment-##  -->
	
		<ul class="children">
		<li class="comment byuser comment-author-plesner bypostauthor odd alt depth-2" id="li-comment-441">
			<div id="comment-441">
			<div class="comment-author vcard">
				<img alt='' src='http://1.gravatar.com/avatar/d65f60d48417ac4f04f73712268bfa6b?s=40&amp;d=&amp;r=G' class='avatar avatar-40 photo' height='40' width='40' />				<cite class="fn">Christian Plesner Hansen</cite> <span class="says">says:</span>			</div><!-- .comment-author .vcard -->
				
			<div class="comment-meta commentmetadata"><a href="http://blog.quenta.org/2012/09/0x5f3759df.html#comment-441">
				September 16, 2012 at 07:27</a>			</div><!-- .comment-meta .commentmetadata -->
	
			<div class="comment-body"><p>Thanks for the correction. You&#8217;re right, and checking with my C code I can see that I got it right there but wrong in the post. This is really getting embarassing&#8230;</p>
</div>
	
			<div class="reply">
				<a class='comment-reply-link' href='/2012/09/0x5f3759df.html?replytocom=441#respond' onclick='return addComment.moveForm("comment-441", "441", "respond", "168")'>Reply</a>			</div><!-- .reply -->
		</div><!-- #comment-##  -->
	
		<ul class="children">
		<li class="comment even depth-3" id="li-comment-445">
			<div id="comment-445">
			<div class="comment-author vcard">
				<img alt='' src='http://0.gravatar.com/avatar/e509a93bbe4753860062cb6886987ccf?s=40&amp;d=&amp;r=G' class='avatar avatar-40 photo' height='40' width='40' />				<cite class="fn">Geoffrey Dixon-Ernst</cite> <span class="says">says:</span>			</div><!-- .comment-author .vcard -->
				
			<div class="comment-meta commentmetadata"><a href="http://blog.quenta.org/2012/09/0x5f3759df.html#comment-445">
				September 16, 2012 at 10:24</a>			</div><!-- .comment-meta .commentmetadata -->
	
			<div class="comment-body"><p>I wouldn&#8217;t be embarrassed.  There&#8217;s a lot of really good material here and it is so easy to flip something.  And hey, all these commenters are like free reviewers&#8230;</p>
</div>
	
			<div class="reply">
				<a class='comment-reply-link' href='/2012/09/0x5f3759df.html?replytocom=445#respond' onclick='return addComment.moveForm("comment-445", "445", "respond", "168")'>Reply</a>			</div><!-- .reply -->
		</div><!-- #comment-##  -->
	
		</li><!-- #comment-## -->
		<li class="comment odd alt depth-3" id="li-comment-464">
			<div id="comment-464">
			<div class="comment-author vcard">
				<img alt='' src='http://0.gravatar.com/avatar/6a2aac087c262268c825ca7add6f6ef2?s=40&amp;d=&amp;r=G' class='avatar avatar-40 photo' height='40' width='40' />				<cite class="fn"><a href='http://twitter.com/jvjr' rel='external nofollow' class='url'>Jan Vaněk jr.</a></cite> <span class="says">says:</span>			</div><!-- .comment-author .vcard -->
				
			<div class="comment-meta commentmetadata"><a href="http://blog.quenta.org/2012/09/0x5f3759df.html#comment-464">
				September 17, 2012 at 04:20</a>			</div><!-- .comment-meta .commentmetadata -->
	
			<div class="comment-body"><p>I think there is (at least) one more artifact of that sign mistake:<br />
<code> i = (1 - p) * 0x3f7a3bea + (p * i); </code><br />
would expand to<br />
<code> i = 0x3f7a3bea - p * (0x3f7a3bea <b>-</b> i); </code><br />
and not with the plus sign in the parentheses as you have.</p>
</div>
	
			<div class="reply">
				<a class='comment-reply-link' href='/2012/09/0x5f3759df.html?replytocom=464#respond' onclick='return addComment.moveForm("comment-464", "464", "respond", "168")'>Reply</a>			</div><!-- .reply -->
		</div><!-- #comment-##  -->
	
		<ul class="children">
		<li class="comment byuser comment-author-plesner bypostauthor even depth-4" id="li-comment-477">
			<div id="comment-477">
			<div class="comment-author vcard">
				<img alt='' src='http://1.gravatar.com/avatar/d65f60d48417ac4f04f73712268bfa6b?s=40&amp;d=&amp;r=G' class='avatar avatar-40 photo' height='40' width='40' />				<cite class="fn">Christian Plesner Hansen</cite> <span class="says">says:</span>			</div><!-- .comment-author .vcard -->
				
			<div class="comment-meta commentmetadata"><a href="http://blog.quenta.org/2012/09/0x5f3759df.html#comment-477">
				September 17, 2012 at 20:13</a>			</div><!-- .comment-meta .commentmetadata -->
	
			<div class="comment-body"><p>You&#8217;re right, I missed one when making the previous correction.</p>
</div>
	
			<div class="reply">
				<a class='comment-reply-link' href='/2012/09/0x5f3759df.html?replytocom=477#respond' onclick='return addComment.moveForm("comment-477", "477", "respond", "168")'>Reply</a>			</div><!-- .reply -->
		</div><!-- #comment-##  -->
	
		</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
		<li class="comment odd alt thread-even depth-1" id="li-comment-437">
			<div id="comment-437">
			<div class="comment-author vcard">
				<img alt='' src='http://1.gravatar.com/avatar/b0a5a05019677c4b7d5676f1a34a8f97?s=40&amp;d=&amp;r=G' class='avatar avatar-40 photo' height='40' width='40' />				<cite class="fn">Kevin Sharkey</cite> <span class="says">says:</span>			</div><!-- .comment-author .vcard -->
				
			<div class="comment-meta commentmetadata"><a href="http://blog.quenta.org/2012/09/0x5f3759df.html#comment-437">
				September 16, 2012 at 07:06</a>			</div><!-- .comment-meta .commentmetadata -->
	
			<div class="comment-body"><p>Thanks for this!</p>
<p>Another typo, I think:<br />
{\frac 23}L(B &#8211; \sigma) = {\frac 23}2^{23}(127 &#8211; 0.0450465) = 1597463007</p>
<p>Should be:<br />
{\frac 32}L(B &#8211; \sigma) = {\frac 32}2^{23}(127 &#8211; 0.0450465) = 1597463007</p>
</div>
	
			<div class="reply">
				<a class='comment-reply-link' href='/2012/09/0x5f3759df.html?replytocom=437#respond' onclick='return addComment.moveForm("comment-437", "437", "respond", "168")'>Reply</a>			</div><!-- .reply -->
		</div><!-- #comment-##  -->
	
		<ul class="children">
		<li class="comment byuser comment-author-plesner bypostauthor even depth-2" id="li-comment-440">
			<div id="comment-440">
			<div class="comment-author vcard">
				<img alt='' src='http://1.gravatar.com/avatar/d65f60d48417ac4f04f73712268bfa6b?s=40&amp;d=&amp;r=G' class='avatar avatar-40 photo' height='40' width='40' />				<cite class="fn">Christian Plesner Hansen</cite> <span class="says">says:</span>			</div><!-- .comment-author .vcard -->
				
			<div class="comment-meta commentmetadata"><a href="http://blog.quenta.org/2012/09/0x5f3759df.html#comment-440">
				September 16, 2012 at 07:25</a>			</div><!-- .comment-meta .commentmetadata -->
	
			<div class="comment-body"><p>You&#8217;re right. I&#8217;d actually already fixed this one and hoped noone had noticed, alas I was too late.</p>
</div>
	
			<div class="reply">
				<a class='comment-reply-link' href='/2012/09/0x5f3759df.html?replytocom=440#respond' onclick='return addComment.moveForm("comment-440", "440", "respond", "168")'>Reply</a>			</div><!-- .reply -->
		</div><!-- #comment-##  -->
	
		</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
		<li class="comment byuser comment-author-plesner bypostauthor odd alt thread-odd thread-alt depth-1" id="li-comment-438">
			<div id="comment-438">
			<div class="comment-author vcard">
				<img alt='' src='http://1.gravatar.com/avatar/d65f60d48417ac4f04f73712268bfa6b?s=40&amp;d=&amp;r=G' class='avatar avatar-40 photo' height='40' width='40' />				<cite class="fn">Christian Plesner Hansen</cite> <span class="says">says:</span>			</div><!-- .comment-author .vcard -->
				
			<div class="comment-meta commentmetadata"><a href="http://blog.quenta.org/2012/09/0x5f3759df.html#comment-438">
				September 16, 2012 at 07:06</a>			</div><!-- .comment-meta .commentmetadata -->
	
			<div class="comment-body"><p>@Sampo: I haven&#8217;t done any benchmarks (I was more interested in the math) but I expect there might be better and more efficient ways to do most of this on a modern high-end architecture or if you have a GPU. But for something like my Arduino where you have floating-point numbers but a limited instruction I can definitely see this being practically useful.</p>
<p>Going down in processor size is like travelling back in time, you just have to go low enough and there&#8217;ll be a use for any old-timey trick :-).</p>
</div>
	
			<div class="reply">
				<a class='comment-reply-link' href='/2012/09/0x5f3759df.html?replytocom=438#respond' onclick='return addComment.moveForm("comment-438", "438", "respond", "168")'>Reply</a>			</div><!-- .reply -->
		</div><!-- #comment-##  -->
	
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="li-comment-442">
			<div id="comment-442">
			<div class="comment-author vcard">
				<img alt='' src='http://1.gravatar.com/avatar/ba169a36ca60fc00c60eb2b71fd03c1d?s=40&amp;d=&amp;r=G' class='avatar avatar-40 photo' height='40' width='40' />				<cite class="fn">Joel</cite> <span class="says">says:</span>			</div><!-- .comment-author .vcard -->
				
			<div class="comment-meta commentmetadata"><a href="http://blog.quenta.org/2012/09/0x5f3759df.html#comment-442">
				September 16, 2012 at 10:06</a>			</div><!-- .comment-meta .commentmetadata -->
	
			<div class="comment-body"><p>Great post &#8211; I had been waiting for some analysis of that thing for a while now! Your explanation/derivation were fantastic.</p>
<p>By the way, where you say &#8220;It even works with “odd” powers, like the inverse cube root&#8221;, I think that should just be the regular cube root.</p>
</div>
	
			<div class="reply">
				<a class='comment-reply-link' href='/2012/09/0x5f3759df.html?replytocom=442#respond' onclick='return addComment.moveForm("comment-442", "442", "respond", "168")'>Reply</a>			</div><!-- .reply -->
		</div><!-- #comment-##  -->
	
		<ul class="children">
		<li class="comment byuser comment-author-plesner bypostauthor odd alt depth-2" id="li-comment-451">
			<div id="comment-451">
			<div class="comment-author vcard">
				<img alt='' src='http://1.gravatar.com/avatar/d65f60d48417ac4f04f73712268bfa6b?s=40&amp;d=&amp;r=G' class='avatar avatar-40 photo' height='40' width='40' />				<cite class="fn">Christian Plesner Hansen</cite> <span class="says">says:</span>			</div><!-- .comment-author .vcard -->
				
			<div class="comment-meta commentmetadata"><a href="http://blog.quenta.org/2012/09/0x5f3759df.html#comment-451">
				September 16, 2012 at 12:44</a>			</div><!-- .comment-meta .commentmetadata -->
	
			<div class="comment-body"><p>You&#8217;re right. And even if it was x^-(1/3) &#8220;inverse&#8221; would be the wrong word, it should have been &#8220;reciprocal&#8221; (as should the original function).</p>
</div>
	
			<div class="reply">
				<a class='comment-reply-link' href='/2012/09/0x5f3759df.html?replytocom=451#respond' onclick='return addComment.moveForm("comment-451", "451", "respond", "168")'>Reply</a>			</div><!-- .reply -->
		</div><!-- #comment-##  -->
	
		</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
		<li class="comment even thread-odd thread-alt depth-1" id="li-comment-444">
			<div id="comment-444">
			<div class="comment-author vcard">
				<img alt='' src='http://0.gravatar.com/avatar/e509a93bbe4753860062cb6886987ccf?s=40&amp;d=&amp;r=G' class='avatar avatar-40 photo' height='40' width='40' />				<cite class="fn">Geoffrey Dixon-Ernst</cite> <span class="says">says:</span>			</div><!-- .comment-author .vcard -->
				
			<div class="comment-meta commentmetadata"><a href="http://blog.quenta.org/2012/09/0x5f3759df.html#comment-444">
				September 16, 2012 at 10:21</a>			</div><!-- .comment-meta .commentmetadata -->
	
			<div class="comment-body"><p>Also, for those interested, the Newton&#8217;s Method step needs to be updated when the exponent is generalized.  This step isn&#8217;t really covered in the article, but based on some of my numbers, you&#8217;ll get on average about a 20x reduction in the % error (going from ~10% error for the raw estimate to ~0.6% for the post-Newton method estimate).</p>
<p>The generalized equation for the Newton&#8217;s Method step is:</p>
<p><code> x = x*(1 - power + power*input*x^(-1/power);</code></p>
<p>where <code>input</code> is the number you&#8217;re finding the power of and <code>power</code> is the power you&#8217;re raising the input to.</p>
</div>
	
			<div class="reply">
				<a class='comment-reply-link' href='/2012/09/0x5f3759df.html?replytocom=444#respond' onclick='return addComment.moveForm("comment-444", "444", "respond", "168")'>Reply</a>			</div><!-- .reply -->
		</div><!-- #comment-##  -->
	
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-even depth-1" id="li-comment-448">
			<div id="comment-448">
			<div class="comment-author vcard">
				<img alt='' src='http://0.gravatar.com/avatar/a77a5a5c7cdeb0b979862c64d615d3a3?s=40&amp;d=&amp;r=G' class='avatar avatar-40 photo' height='40' width='40' />				<cite class="fn"><a href='http://eggroll.unbsj.ca/rsqrt/' rel='external nofollow' class='url'>Matthew Robertson</a></cite> <span class="says">says:</span>			</div><!-- .comment-author .vcard -->
				
			<div class="comment-meta commentmetadata"><a href="http://blog.quenta.org/2012/09/0x5f3759df.html#comment-448">
				September 16, 2012 at 12:12</a>			</div><!-- .comment-meta .commentmetadata -->
	
			<div class="comment-body"><p>Great read. I really like this bit hack. I was first shown it back in high school and it has always been something I check back on to see if there are any new papers on it. A good friend of mine showed me your blog post today and I really liked it. Perhaps you would be interested in these two papers: <a HREF="http://eggroll.unbsj.ca/rsqrt/" TITLE="A Brief History of InvSqrt" rel="nofollow"> and </a><a HREF="http://rufus.hackish.org/~rufus/FPtricks.pdf" TITLE="Floating-Point Tricks" rel="nofollow">. The first is my own work, so a little shameless self-promotion :). The second is very interesting because it is a much older (less known) and more generic approach that $1/\sqrt{x}$ is just a special case of.</a></p>
</div>
	
			<div class="reply">
				<a class='comment-reply-link' href='/2012/09/0x5f3759df.html?replytocom=448#respond' onclick='return addComment.moveForm("comment-448", "448", "respond", "168")'>Reply</a>			</div><!-- .reply -->
		</div><!-- #comment-##  -->
	
		</li><!-- #comment-## -->
		<li class="comment even thread-odd thread-alt depth-1" id="li-comment-449">
			<div id="comment-449">
			<div class="comment-author vcard">
				<img alt='' src='http://0.gravatar.com/avatar/a77a5a5c7cdeb0b979862c64d615d3a3?s=40&amp;d=&amp;r=G' class='avatar avatar-40 photo' height='40' width='40' />				<cite class="fn"><a href='http://eggroll.unbsj.ca/rsqrt/' rel='external nofollow' class='url'>Matthew Robertson</a></cite> <span class="says">says:</span>			</div><!-- .comment-author .vcard -->
				
			<div class="comment-meta commentmetadata"><a href="http://blog.quenta.org/2012/09/0x5f3759df.html#comment-449">
				September 16, 2012 at 12:15</a>			</div><!-- .comment-meta .commentmetadata -->
	
			<div class="comment-body"><p>Great read. I really like this bit hack. I was first shown it back in high school and it has always been something I check back on to see if there are any new papers on it. A good friend of mine showed me your blog post today and I really liked it. Perhaps you would be interested in these two papers: <a HREF="http://eggroll.unbsj.ca/rsqrt/" TITLE="A Brief History of InvSqrt" rel="nofollow">A Brief History of InvSqrt</a> and <a HREF="http://rufus.hackish.org/~rufus/FPtricks.pdf" TITLE="Floating-Point Tricks" rel="nofollow">loating-Point Tricks</a>. The first is my own work, so a little shameless self-promotion :). The second is very interesting because it is a much older (less known) and more generic approach that $1/\sqrt{x}$ is just a special case of.</p>
</div>
	
			<div class="reply">
				<a class='comment-reply-link' href='/2012/09/0x5f3759df.html?replytocom=449#respond' onclick='return addComment.moveForm("comment-449", "449", "respond", "168")'>Reply</a>			</div><!-- .reply -->
		</div><!-- #comment-##  -->
	
		</li><!-- #comment-## -->
		<li class="post pingback">
			<p>Pingback: <a href='http://underoot.com/uncategorized/public-bookmarks' rel='external nofollow' class='url'>Public Bookmarks &raquo; Un Root</a></p>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-even depth-1" id="li-comment-456">
			<div id="comment-456">
			<div class="comment-author vcard">
				<img alt='' src='http://1.gravatar.com/avatar/9854161cf34487cd72d6e854c8ec44ee?s=40&amp;d=&amp;r=G' class='avatar avatar-40 photo' height='40' width='40' />				<cite class="fn"><a href='http://www.cunco.se' rel='external nofollow' class='url'>Fidde</a></cite> <span class="says">says:</span>			</div><!-- .comment-author .vcard -->
				
			<div class="comment-meta commentmetadata"><a href="http://blog.quenta.org/2012/09/0x5f3759df.html#comment-456">
				September 16, 2012 at 17:21</a>			</div><!-- .comment-meta .commentmetadata -->
	
			<div class="comment-body"><p>Thanks so much for this detailed explanation, very well written! Despite some effort, I haven&#8217;t been able to understand it until I read your post.</p>
</div>
	
			<div class="reply">
				<a class='comment-reply-link' href='/2012/09/0x5f3759df.html?replytocom=456#respond' onclick='return addComment.moveForm("comment-456", "456", "respond", "168")'>Reply</a>			</div><!-- .reply -->
		</div><!-- #comment-##  -->
	
		</li><!-- #comment-## -->
		<li class="post pingback">
			<p>Pingback: <a href='http://underoot.com/uncategorized/fast-square-root-functionroutine' rel='external nofollow' class='url'>Fast Square Root Function/Routine &raquo; Un Root</a></p>
		</li><!-- #comment-## -->
		<li class="comment even thread-odd thread-alt depth-1" id="li-comment-458">
			<div id="comment-458">
			<div class="comment-author vcard">
				<img alt='' src='http://0.gravatar.com/avatar/873ce7772ecbdee61a65d862469acdb0?s=40&amp;d=&amp;r=G' class='avatar avatar-40 photo' height='40' width='40' />				<cite class="fn"><a href='http://theretardedpolymath.blogspot.com' rel='external nofollow' class='url'>Lucas</a></cite> <span class="says">says:</span>			</div><!-- .comment-author .vcard -->
				
			<div class="comment-meta commentmetadata"><a href="http://blog.quenta.org/2012/09/0x5f3759df.html#comment-458">
				September 16, 2012 at 19:54</a>			</div><!-- .comment-meta .commentmetadata -->
	
			<div class="comment-body"><p>This is simply amazing. I&#8217;ve compared it to SSE&#8217;s rsqrt that also approximates the answer: <a href="http://theretardedpolymath.blogspot.com/2012/09/i-came-across-very-interesting-post.html" rel="nofollow">http://theretardedpolymath.blogspot.com/2012/09/i-came-across-very-interesting-post.html</a></p>
<p>It&#8217;s not as fast, but that&#8217;s a hardware level instruction! Awesome piece of work and very interesting.</p>
</div>
	
			<div class="reply">
				<a class='comment-reply-link' href='/2012/09/0x5f3759df.html?replytocom=458#respond' onclick='return addComment.moveForm("comment-458", "458", "respond", "168")'>Reply</a>			</div><!-- .reply -->
		</div><!-- #comment-##  -->
	
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-even depth-1" id="li-comment-460">
			<div id="comment-460">
			<div class="comment-author vcard">
				<img alt='' src='http://1.gravatar.com/avatar/3696b01b9b07aca1e84da0ea30d49e35?s=40&amp;d=&amp;r=G' class='avatar avatar-40 photo' height='40' width='40' />				<cite class="fn">Christian</cite> <span class="says">says:</span>			</div><!-- .comment-author .vcard -->
				
			<div class="comment-meta commentmetadata"><a href="http://blog.quenta.org/2012/09/0x5f3759df.html#comment-460">
				September 16, 2012 at 22:17</a>			</div><!-- .comment-meta .commentmetadata -->
	
			<div class="comment-body"><p>You have a little error in your transformed equation:<br />
i = (1 &#8211; p) * 0x3f7a3bea + (p * i);</p>
<p>Transformes to:<br />
i = 0x3f7a3bea + p * (-0x3f7a3bea + i);<br />
instead to: i = 0x3f7a3bea &#8211; p * (0x3f7a3bea + i);</p>
<p>But anyway amazing post, which i can use in my daily programming a lot. thanks!</p>
</div>
	
			<div class="reply">
				<a class='comment-reply-link' href='/2012/09/0x5f3759df.html?replytocom=460#respond' onclick='return addComment.moveForm("comment-460", "460", "respond", "168")'>Reply</a>			</div><!-- .reply -->
		</div><!-- #comment-##  -->
	
		<ul class="children">
		<li class="comment byuser comment-author-plesner bypostauthor even depth-2" id="li-comment-466">
			<div id="comment-466">
			<div class="comment-author vcard">
				<img alt='' src='http://1.gravatar.com/avatar/d65f60d48417ac4f04f73712268bfa6b?s=40&amp;d=&amp;r=G' class='avatar avatar-40 photo' height='40' width='40' />				<cite class="fn">Christian Plesner Hansen</cite> <span class="says">says:</span>			</div><!-- .comment-author .vcard -->
				
			<div class="comment-meta commentmetadata"><a href="http://blog.quenta.org/2012/09/0x5f3759df.html#comment-466">
				September 17, 2012 at 04:57</a>			</div><!-- .comment-meta .commentmetadata -->
	
			<div class="comment-body"><p>Yes you&#8217;re right. Fixed.</p>
</div>
	
			<div class="reply">
				<a class='comment-reply-link' href='/2012/09/0x5f3759df.html?replytocom=466#respond' onclick='return addComment.moveForm("comment-466", "466", "respond", "168")'>Reply</a>			</div><!-- .reply -->
		</div><!-- #comment-##  -->
	
		</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-468">
			<div id="comment-468">
			<div class="comment-author vcard">
				<img alt='' src='http://0.gravatar.com/avatar/efcebeb82aec48a1cb296e3119f8879d?s=40&amp;d=&amp;r=G' class='avatar avatar-40 photo' height='40' width='40' />				<cite class="fn"><a href='http://www.zigfu.com' rel='external nofollow' class='url'>Roee Shenberg</a></cite> <span class="says">says:</span>			</div><!-- .comment-author .vcard -->
				
			<div class="comment-meta commentmetadata"><a href="http://blog.quenta.org/2012/09/0x5f3759df.html#comment-468">
				September 17, 2012 at 06:20</a>			</div><!-- .comment-meta .commentmetadata -->
	
			<div class="comment-body"><p>You have some errors in your code due to how C handles data-type conversions in arithmetic &#8211; when you do an arithmetic action with an integer and a float, you&#8217;ll get a float, so the result of (i * 0.333f) is a float (i is converted to a float). This also means 0x2a517d3c is converted to a float, and not the other way around.</p>
<p>The &#8220;magic number&#8221; is a string of 28 bits from the first 1 to the last 1 in this example, so it doesn&#8217;t fit in full accuracy into a regular float (only 23-bit mantissa). To show you that&#8217;s the case, try running the code with the constant 0x2a517d30 instead and verify that you get the _exact_ same results (I did this test myself).<br />
So, you&#8217;d get better accuracy by writing the code as 0x2a517d3c + (int)(i * 0.333f), but I feel that this is missing the point of the original algorithm, since it means we&#8217;re adding an extra integer-&gt;float and float-&gt;integer conversions. I implementation which keeps the spirit of the original function would be to multiply i by a fixed point multiplicative inverse of 1/3 and take the higher dword of the result:<br />
i = 0x2a517d3c + (int)(((unsigned long long)i * 0x55555555U)&gt;&gt;32)</p>
<p>(The idea is to say 0&#215;100000000 represents 1, 0&#215;100000001 is 1 + 1/2^32, and so on, so then 1/3 = 0&#215;100000000/3 = 0&#215;55555555)</p>
<p>GCC can produce good code for this (multiplying two 32-bit numbers gives a 64-bit result, simply take the higher 32 bits of the result), in visual studio I ended up writing it using a compiler intrinsic (i = 0x2a517d3c + (int)(__emulu(i, 0x55555555U)&gt;&gt;32);) since the optimizer isn&#8217;t smart enough otherwise.</p>
<p>I think that the original derivation is a special case of the fixed-point version of the algorithmbecause skipping the two conversions is a significant factor in run-time (or at least was back in the day). (1/2 is 0&#215;80000000, and (i*0&#215;80000000)&gt;&gt;32 == (i&lt;&gt;32 == i &gt;&gt; 1)</p>
</div>
	
			<div class="reply">
				<a class='comment-reply-link' href='/2012/09/0x5f3759df.html?replytocom=468#respond' onclick='return addComment.moveForm("comment-468", "468", "respond", "168")'>Reply</a>			</div><!-- .reply -->
		</div><!-- #comment-##  -->
	
		<ul class="children">
		<li class="comment byuser comment-author-plesner bypostauthor even depth-2" id="li-comment-478">
			<div id="comment-478">
			<div class="comment-author vcard">
				<img alt='' src='http://1.gravatar.com/avatar/d65f60d48417ac4f04f73712268bfa6b?s=40&amp;d=&amp;r=G' class='avatar avatar-40 photo' height='40' width='40' />				<cite class="fn">Christian Plesner Hansen</cite> <span class="says">says:</span>			</div><!-- .comment-author .vcard -->
				
			<div class="comment-meta commentmetadata"><a href="http://blog.quenta.org/2012/09/0x5f3759df.html#comment-478">
				September 17, 2012 at 20:44</a>			</div><!-- .comment-meta .commentmetadata -->
	
			<div class="comment-body"><p>It&#8217;s a good point about where to apply the cast – the way it&#8217;s written discards accuracy for no good reason. It shouldn&#8217;t affect the correctness though, just the accuracy.</p>
<p>I like the fixed-point multiplication trick, I&#8217;ll have to remember that. However there&#8217;s a fundamental issue with relying on efficient arithmetic at twice the size of the approximation. The original 32-bit trick was for a 32-bit architecture so it&#8217;s not obvious that you&#8217;d get good code for a 64-bit multiplication. Similarly, on your machine you&#8217;d be more likely to want a 64-bit approximation and so you&#8217;d need a 128-bit multiplication.</p>
</div>
	
			<div class="reply">
				<a class='comment-reply-link' href='/2012/09/0x5f3759df.html?replytocom=478#respond' onclick='return addComment.moveForm("comment-478", "478", "respond", "168")'>Reply</a>			</div><!-- .reply -->
		</div><!-- #comment-##  -->
	
		</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
		<li class="comment odd alt thread-even depth-1" id="li-comment-470">
			<div id="comment-470">
			<div class="comment-author vcard">
				<img alt='' src='http://1.gravatar.com/avatar/7ce2c2dc1416d0fc12400d4fc50695fe?s=40&amp;d=&amp;r=G' class='avatar avatar-40 photo' height='40' width='40' />				<cite class="fn">Flavio Sales Truzzi</cite> <span class="says">says:</span>			</div><!-- .comment-author .vcard -->
				
			<div class="comment-meta commentmetadata"><a href="http://blog.quenta.org/2012/09/0x5f3759df.html#comment-470">
				September 17, 2012 at 08:28</a>			</div><!-- .comment-meta .commentmetadata -->
	
			<div class="comment-body"><p>Why not use the inline assembly?</p>
</div>
	
			<div class="reply">
				<a class='comment-reply-link' href='/2012/09/0x5f3759df.html?replytocom=470#respond' onclick='return addComment.moveForm("comment-470", "470", "respond", "168")'>Reply</a>			</div><!-- .reply -->
		</div><!-- #comment-##  -->
	
		</li><!-- #comment-## -->
		<li class="comment even thread-odd thread-alt depth-1" id="li-comment-479">
			<div id="comment-479">
			<div class="comment-author vcard">
				<img alt='' src='http://1.gravatar.com/avatar/d441126e0abbbf4bddf90251ae8fd12b?s=40&amp;d=&amp;r=G' class='avatar avatar-40 photo' height='40' width='40' />				<cite class="fn">mg</cite> <span class="says">says:</span>			</div><!-- .comment-author .vcard -->
				
			<div class="comment-meta commentmetadata"><a href="http://blog.quenta.org/2012/09/0x5f3759df.html#comment-479">
				September 17, 2012 at 22:24</a>			</div><!-- .comment-meta .commentmetadata -->
	
			<div class="comment-body"><p>See also Rrrola&#8217;s &#8220;Improving the fast inverse square root&#8221;: <a href="http://rrrola.wz.cz/inv_sqrt.html" rel="nofollow">http://rrrola.wz.cz/inv_sqrt.html</a></p>
</div>
	
			<div class="reply">
				<a class='comment-reply-link' href='/2012/09/0x5f3759df.html?replytocom=479#respond' onclick='return addComment.moveForm("comment-479", "479", "respond", "168")'>Reply</a>			</div><!-- .reply -->
		</div><!-- #comment-##  -->
	
		</li><!-- #comment-## -->
		<li class="post pingback">
			<p>Pingback: <a href='http://cwyalpha.wordpress.com/2012/09/17/thought-this-was-cool-0x5f3759df-hummus-and-magnets/' rel='external nofollow' class='url'>Thought this was cool: 0x5f3759df » Hummus and Magnets &laquo; CWYAlpha</a></p>
		</li><!-- #comment-## -->
		<li class="post pingback">
			<p>Pingback: <a href='http://blog.quenta.org/2012/09/0x5f3759df-appendix.html' rel='external nofollow' class='url'>0x5f3759df (appendix) &raquo; Hummus and Magnets</a></p>
		</li><!-- #comment-## -->
		<li class="post pingback">
			<p>Pingback: <a href='http://blog.dominic-wong.name/2012/09/fast-inverse-square-root-and-square-root-functions/' rel='external nofollow' class='url'>Fast inverse square root and square root functions | Dom&#039;s Blog</a></p>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-even depth-1" id="li-comment-556">
			<div id="comment-556">
			<div class="comment-author vcard">
				<img alt='' src='http://1.gravatar.com/avatar/d6f1b30472b1b942abab5e2bfb59956c?s=40&amp;d=&amp;r=G' class='avatar avatar-40 photo' height='40' width='40' />				<cite class="fn">ckyh43</cite> <span class="says">says:</span>			</div><!-- .comment-author .vcard -->
				
			<div class="comment-meta commentmetadata"><a href="http://blog.quenta.org/2012/09/0x5f3759df.html#comment-556">
				September 20, 2012 at 18:05</a>			</div><!-- .comment-meta .commentmetadata -->
	
			<div class="comment-body"><p>Great read! BTW, you should use the MathJax &#8211; <a href="http://www.mathjax.org/" rel="nofollow">http://www.mathjax.org/</a> &#8211; JS library to type equations</p>
</div>
	
			<div class="reply">
				<a class='comment-reply-link' href='/2012/09/0x5f3759df.html?replytocom=556#respond' onclick='return addComment.moveForm("comment-556", "556", "respond", "168")'>Reply</a>			</div><!-- .reply -->
		</div><!-- #comment-##  -->
	
		<ul class="children">
		<li class="comment byuser comment-author-plesner bypostauthor even depth-2" id="li-comment-568">
			<div id="comment-568">
			<div class="comment-author vcard">
				<img alt='' src='http://1.gravatar.com/avatar/d65f60d48417ac4f04f73712268bfa6b?s=40&amp;d=&amp;r=G' class='avatar avatar-40 photo' height='40' width='40' />				<cite class="fn">Christian Plesner Hansen</cite> <span class="says">says:</span>			</div><!-- .comment-author .vcard -->
				
			<div class="comment-meta commentmetadata"><a href="http://blog.quenta.org/2012/09/0x5f3759df.html#comment-568">
				September 21, 2012 at 07:48</a>			</div><!-- .comment-meta .commentmetadata -->
	
			<div class="comment-body"><p>Nice, MathJax looks really good. I especially like that you can select the text of the equation. I&#8217;ll have to play around with that when I get time.</p>
</div>
	
			<div class="reply">
				<a class='comment-reply-link' href='/2012/09/0x5f3759df.html?replytocom=568#respond' onclick='return addComment.moveForm("comment-568", "568", "respond", "168")'>Reply</a>			</div><!-- .reply -->
		</div><!-- #comment-##  -->
	
		</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
		<li class="post pingback">
			<p>Pingback: <a href='http://siddian.tatooine.webseiten.cc/wordpress/?p=58' rel='external nofollow' class='url'>Mindbaffling : Johannes maker blog</a></p>
		</li><!-- #comment-## -->
		<li class="post pingback">
			<p>Pingback: <a href='http://okpanico.wordpress.com/2012/09/23/visto-nel-web-45/' rel='external nofollow' class='url'>Visto nel Web &#8211; 45 &laquo; Ok, panico</a></p>
		</li><!-- #comment-## -->
		<li class="post pingback">
			<p>Pingback: <a href='http://kynosarges.wordpress.com/2012/09/29/quadrocopters-tom-bombadil/' rel='external nofollow' class='url'>Quadrocopters &amp; Tom Bombadil &laquo; Kynosarges Weblog</a></p>
		</li><!-- #comment-## -->
		<li class="post pingback">
			<p>Pingback: <a href='http://www.quora.com/Computer-Programming/What-are-some-cool-bit-manipulation-tricks-hacks#ans1653002' rel='external nofollow' class='url'>Quora</a></p>
		</li><!-- #comment-## -->
		<li class="post pingback">
			<p>Pingback: <a href='http://www.gamesajare.com/2.0/el-logaritmo-neperiano-de-su-puta-madre/' rel='external nofollow' class='url'>EL LOGARITMO NEPERIANO DE SU PUTA MADRE | GamesAjare</a></p>
		</li><!-- #comment-## -->
		<li class="post pingback">
			<p>Pingback: <a href='http://geosrc.net/links-472012/' rel='external nofollow' class='url'>Links 47/2012 | Geo Source</a></p>
		</li><!-- #comment-## -->
		<li class="post pingback">
			<p>Pingback: <a href='http://matthewarcus.wordpress.com/2012/11/25/inverse-square-root-ii/' rel='external nofollow' class='url'>Inverse Square Root II &laquo; Cute Code</a></p>
		</li><!-- #comment-## -->
		<li class="post pingback">
			<p>Pingback: <a href='http://www.mystery-man.com/wordpress/2012/12/25/la-lista-definitiva-del-2012/' rel='external nofollow' class='url'>Geek Revolution &raquo; Blog Archive &raquo; La lista definitiva del 2012</a></p>
		</li><!-- #comment-## -->
		<li class="post pingback">
			<p>Pingback: <a href='http://nabsha.wordpress.com/2012/09/16/fast-square-root-functionroutine/' rel='external nofollow' class='url'>Fast Square Root Function/Routine &laquo; Nabsha&#039;s Blog-About</a></p>
		</li><!-- #comment-## -->
		<li class="post pingback">
			<p>Pingback: <a href='http://nabsha.wordpress.com/2012/09/16/public-bookmarks/' rel='external nofollow' class='url'>Public Bookmarks &laquo; Nabsha&#039;s Blog-About</a></p>
		</li><!-- #comment-## -->
		<li class="post pingback">
			<p>Pingback: <a href='http://ubuntuincident.wordpress.com/2013/04/05/black-magic-0x5f3759df/' rel='external nofollow' class='url'>black magic: 0x5f3759df | The Ubuntu Incident</a></p>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-45742">
			<div id="comment-45742">
			<div class="comment-author vcard">
				<img alt='' src='http://0.gravatar.com/avatar/e48d001833c9a61238ee20dc98ce0570?s=40&amp;d=&amp;r=G' class='avatar avatar-40 photo' height='40' width='40' />				<cite class="fn"><a href='http://www.23hq.com/traslochi6agenda/story/10223790' rel='external nofollow' class='url'>piccoli-traslochi</a></cite> <span class="says">says:</span>			</div><!-- .comment-author .vcard -->
				
			<div class="comment-meta commentmetadata"><a href="http://blog.quenta.org/2012/09/0x5f3759df.html#comment-45742">
				May 13, 2013 at 20:18</a>			</div><!-- .comment-meta .commentmetadata -->
	
			<div class="comment-body"><p>Articolo molto interessante</p>
</div>
	
			<div class="reply">
				<a class='comment-reply-link' href='/2012/09/0x5f3759df.html?replytocom=45742#respond' onclick='return addComment.moveForm("comment-45742", "45742", "respond", "168")'>Reply</a>			</div><!-- .reply -->
		</div><!-- #comment-##  -->
	
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="li-comment-47990">
			<div id="comment-47990">
			<div class="comment-author vcard">
				<img alt='' src='http://0.gravatar.com/avatar/099acf92da5291d510da4afb0068b984?s=40&amp;d=&amp;r=G' class='avatar avatar-40 photo' height='40' width='40' />				<cite class="fn"><a href='http://www.seomas.pl' rel='external nofollow' class='url'>seo company in india</a></cite> <span class="says">says:</span>			</div><!-- .comment-author .vcard -->
				
			<div class="comment-meta commentmetadata"><a href="http://blog.quenta.org/2012/09/0x5f3759df.html#comment-47990">
				June 6, 2013 at 01:15</a>			</div><!-- .comment-meta .commentmetadata -->
	
			<div class="comment-body"><p>It&#8217;s going to be end of mine day, but before end I am reading this impressive article to improve my knowledge.</p>
</div>
	
			<div class="reply">
				<a class='comment-reply-link' href='/2012/09/0x5f3759df.html?replytocom=47990#respond' onclick='return addComment.moveForm("comment-47990", "47990", "respond", "168")'>Reply</a>			</div><!-- .reply -->
		</div><!-- #comment-##  -->
	
		</li><!-- #comment-## -->
		<li class="post pingback">
			<p>Pingback: <a href='http://literals.wordpress.com/2013/06/22/fast-inverse-square-root/' rel='external nofollow' class='url'>Fast Inverse Square Root | manifest density</a></p>
		</li><!-- #comment-## -->
		<li class="post pingback">
			<p>Pingback: <a href='http://fogostudio.com/dadas/0x5f3759df-fast-inverse-square-root-explained-in-detail/' rel='external nofollow' class='url'>0x5f3759df » Fast inverse square root explained in detail | Da Das</a></p>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-51826">
			<div id="comment-51826">
			<div class="comment-author vcard">
				<img alt='' src='http://1.gravatar.com/avatar/3703611b65a5c501f52598bde13fd3a0?s=40&amp;d=&amp;r=G' class='avatar avatar-40 photo' height='40' width='40' />				<cite class="fn">Robby</cite> <span class="says">says:</span>			</div><!-- .comment-author .vcard -->
				
			<div class="comment-meta commentmetadata"><a href="http://blog.quenta.org/2012/09/0x5f3759df.html#comment-51826">
				July 13, 2013 at 02:12</a>			</div><!-- .comment-meta .commentmetadata -->
	
			<div class="comment-body"><p>I think that maybe this code is undefined (i.e., not legal C and a conforming C compiler can do whatever it wants with it, not necc. what you want). That is, I think you need to use memcpy instead of those casts (don&#8217;t worry tho: the generate assembly will still be good).</p>
<p>More details are here: <a href="http://blog.regehr.org/archives/959" rel="nofollow">http://blog.regehr.org/archives/959</a>, for example.</p>
</div>
	
			<div class="reply">
				<a class='comment-reply-link' href='/2012/09/0x5f3759df.html?replytocom=51826#respond' onclick='return addComment.moveForm("comment-51826", "51826", "respond", "168")'>Reply</a>			</div><!-- .reply -->
		</div><!-- #comment-##  -->
	
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="li-comment-52110">
			<div id="comment-52110">
			<div class="comment-author vcard">
				<img alt='' src='http://1.gravatar.com/avatar/176704cc283c8e6a65b965b862093af8?s=40&amp;d=&amp;r=G' class='avatar avatar-40 photo' height='40' width='40' />				<cite class="fn"><a href='http://java67.blogspot.ca' rel='external nofollow' class='url'>Angelo</a></cite> <span class="says">says:</span>			</div><!-- .comment-author .vcard -->
				
			<div class="comment-meta commentmetadata"><a href="http://blog.quenta.org/2012/09/0x5f3759df.html#comment-52110">
				July 15, 2013 at 18:47</a>			</div><!-- .comment-meta .commentmetadata -->
	
			<div class="comment-body"><p>Combination of Maths and Programming is like gold, they both are closely related to each other, but hard to figure that out.</p>
</div>
	
			<div class="reply">
				<a class='comment-reply-link' href='/2012/09/0x5f3759df.html?replytocom=52110#respond' onclick='return addComment.moveForm("comment-52110", "52110", "respond", "168")'>Reply</a>			</div><!-- .reply -->
		</div><!-- #comment-##  -->
	
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-56742">
			<div id="comment-56742">
			<div class="comment-author vcard">
				<img alt='' src='http://0.gravatar.com/avatar/cda9f9be04504c7444ae5dec36ffdc24?s=40&amp;d=&amp;r=G' class='avatar avatar-40 photo' height='40' width='40' />				<cite class="fn"><a href='http://www.scribd.com/mirus10000' rel='external nofollow' class='url'>www.scribd.com</a></cite> <span class="says">says:</span>			</div><!-- .comment-author .vcard -->
				
			<div class="comment-meta commentmetadata"><a href="http://blog.quenta.org/2012/09/0x5f3759df.html#comment-56742">
				August 9, 2013 at 08:44</a>			</div><!-- .comment-meta .commentmetadata -->
	
			<div class="comment-body"><p>I savor, cause I discovered just what I was taking a look for.<br />
You&#8217;ve ended my 4 day lengthy hunt! God Bless you man. Have a nice day. Bye</p>
</div>
	
			<div class="reply">
				<a class='comment-reply-link' href='/2012/09/0x5f3759df.html?replytocom=56742#respond' onclick='return addComment.moveForm("comment-56742", "56742", "respond", "168")'>Reply</a>			</div><!-- .reply -->
		</div><!-- #comment-##  -->
	
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="li-comment-57604">
			<div id="comment-57604">
			<div class="comment-author vcard">
				<img alt='' src='http://1.gravatar.com/avatar/7591f16c5d2bfb3abe7da19b042b1e2a?s=40&amp;d=&amp;r=G' class='avatar avatar-40 photo' height='40' width='40' />				<cite class="fn"><a href='http://a' rel='external nofollow' class='url'>James davis</a></cite> <span class="says">says:</span>			</div><!-- .comment-author .vcard -->
				
			<div class="comment-meta commentmetadata"><a href="http://blog.quenta.org/2012/09/0x5f3759df.html#comment-57604">
				August 13, 2013 at 21:20</a>			</div><!-- .comment-meta .commentmetadata -->
	
			<div class="comment-body"><p>hello! What is your cardsapp brand number? tanks</p>
</div>
	
			<div class="reply">
				<a class='comment-reply-link' href='/2012/09/0x5f3759df.html?replytocom=57604#respond' onclick='return addComment.moveForm("comment-57604", "57604", "respond", "168")'>Reply</a>			</div><!-- .reply -->
		</div><!-- #comment-##  -->
	
		</li><!-- #comment-## -->
		<li class="post pingback">
			<p>Pingback: <a href='https://www.jamesclements.net/0x5f3759df-fast-inverse-square-root-explained-in-detail/' rel='external nofollow' class='url'>0x5f3759df » Fast inverse square root explained in detail</a></p>
		</li><!-- #comment-## -->
		<li class="post pingback">
			<p>Pingback: <a href='http://findmyjobnow.com/what-are-some-cool-bit-manipulation-tricks-hacks/' rel='external nofollow' class='url'>What are some cool bit manipulation tricks hacks | Resume Rewriter Free</a></p>
		</li><!-- #comment-## -->
		<li class="post pingback">
			<p>Pingback: <a href='http://laechele.eu/mindbaffling/' rel='external nofollow' class='url'>Mindbaffling | Johannes maker blog</a></p>
		</li><!-- #comment-## -->
			</ol>

	


								<div id="respond" class="comment-respond">
				<h3 id="reply-title" class="comment-reply-title">Leave a Reply <small><a rel="nofollow" id="cancel-comment-reply-link" href="/2012/09/0x5f3759df.html#respond" style="display:none;">Cancel reply</a></small></h3>
									<form action="http://blog.quenta.org/wp-comments-post.php" method="post" id="commentform" class="comment-form">
																			<p class="comment-notes">Your email address will not be published. Required fields are marked <span class="required">*</span></p>							<p class="comment-form-author"><label for="author">Name <span class="required">*</span></label> <input id="author" name="author" type="text" value="" size="30" aria-required='true' /></p>
<p class="comment-form-email"><label for="email">Email <span class="required">*</span></label> <input id="email" name="email" type="text" value="" size="30" aria-required='true' /></p>
<p class="comment-form-url"><label for="url">Website</label> <input id="url" name="url" type="text" value="" size="30" /></p>
												<p class="comment-form-comment"><label for="comment">Comment</label> <textarea id="comment" name="comment" cols="45" rows="8" aria-required="true"></textarea></p>						<p class="form-allowed-tags">You may use these <abbr title="HyperText Markup Language">HTML</abbr> tags and attributes:  <code>&lt;a href=&quot;&quot; title=&quot;&quot;&gt; &lt;abbr title=&quot;&quot;&gt; &lt;acronym title=&quot;&quot;&gt; &lt;b&gt; &lt;blockquote cite=&quot;&quot;&gt; &lt;cite&gt; &lt;code&gt; &lt;del datetime=&quot;&quot;&gt; &lt;em&gt; &lt;i&gt; &lt;q cite=&quot;&quot;&gt; &lt;strike&gt; &lt;strong&gt; </code></p>						<p class="form-submit">
							<input name="submit" type="submit" id="submit" value="Post Comment" />
							<input type='hidden' name='comment_post_ID' value='168' id='comment_post_ID' />
<input type='hidden' name='comment_parent' id='comment_parent' value='0' />
						</p>
						<p style="display: none;"><input type="hidden" id="akismet_comment_nonce" name="akismet_comment_nonce" value="a5bc7f11cd" /></p><p class="comment-subscription-form"><input type="checkbox" name="subscribe_comments" id="subscribe_comments" value="subscribe" style="width: auto; -moz-appearance: checkbox; -webkit-appearance: checkbox;" /> <label class="subscribe-label" id="subscribe-label" for="subscribe_comments">Notify me of follow-up comments by email.</label></p><p class="comment-subscription-form"><input type="checkbox" name="subscribe_blog" id="subscribe_blog" value="subscribe" style="width: auto; -moz-appearance: checkbox; -webkit-appearance: checkbox;" /> <label class="subscribe-label" id="subscribe-blog-label" for="subscribe_blog">Notify me of new posts by email.</label></p><script type='text/javascript' src='http://blog.quenta.org/wp-content/plugins/akismet/_inc/form.js?ver=3.0.0'></script>
<p style="display: none;"><input type="hidden" id="ak_js" name="ak_js" value="40"/></p>					</form>
							</div><!-- #respond -->
			
</div><!-- #comments -->


		</div><!-- #main -->
			<div id="sidebar" class="widget-area threecol last " role="complementary">
			<ul class="xoxo">

<li id="text-2" class="widget-container widget_text"><h3 class="widget-title">About me</h3>			<div class="textwidget"><p>I'm a software engineer. I'm Danish. I live in Sydney. This is my technical blog. Here are some other places you can find me:</p>
<ul>
<li><a href="http://twitter.com/plesner">Twitter</a></li>
<li><a href="http://www.linkedin.com/in/christianplesnerhansen">LinkedIn</a></li>
<li><a href="http://yesandalso.tumblr.com">Tumblr</a></li>
<li><a href="http://plus.google.com/111760511997911681005/posts">Personal G+</a></li>
<li><a href="http://plus.google.com/b/116927540266568367591/116927540266568367591/posts">Technical G+</a></li>
</ul>
</div>
		</li>		<li id="recent-posts-2" class="widget-container widget_recent_entries">		<h3 class="widget-title">Recent Posts</h3>		<ul>
					<li>
				<a href="http://blog.quenta.org/2013/04/radix.html">Radix</a>
						</li>
					<li>
				<a href="http://blog.quenta.org/2013/03/tumblr.html">Tumblr</a>
						</li>
					<li>
				<a href="http://blog.quenta.org/2013/01/bezier.html">Bezier</a>
						</li>
					<li>
				<a href="http://blog.quenta.org/2012/12/bernoulli.html">Bernoulli</a>
						</li>
					<li>
				<a href="http://blog.quenta.org/2012/11/punched-cards.html">Punched Cards</a>
						</li>
					<li>
				<a href="http://blog.quenta.org/2012/11/analytical-programming.html">Analytical Programming</a>
						</li>
					<li>
				<a href="http://blog.quenta.org/2012/10/difference.html">Difference</a>
						</li>
					<li>
				<a href="http://blog.quenta.org/2012/10/tables.html">Tables</a>
						</li>
					<li>
				<a href="http://blog.quenta.org/2012/09/0x5f3759df-appendix.html">0x5f3759df (appendix)</a>
						</li>
					<li>
				<a href="http://blog.quenta.org/2012/09/0x5f3759df.html">0x5f3759df</a>
						</li>
				</ul>
		</li><li id="archives-2" class="widget-container widget_archive"><h3 class="widget-title">Archives</h3>		<select name="archive-dropdown" onchange='document.location.href=this.options[this.selectedIndex].value;'>
			<option value="">Select Month</option>

				<option value='http://blog.quenta.org/2013/04'> April 2013 &nbsp;(1)</option>
	<option value='http://blog.quenta.org/2013/03'> March 2013 &nbsp;(1)</option>
	<option value='http://blog.quenta.org/2013/01'> January 2013 &nbsp;(1)</option>
	<option value='http://blog.quenta.org/2012/12'> December 2012 &nbsp;(1)</option>
	<option value='http://blog.quenta.org/2012/11'> November 2012 &nbsp;(2)</option>
	<option value='http://blog.quenta.org/2012/10'> October 2012 &nbsp;(2)</option>
	<option value='http://blog.quenta.org/2012/09'> September 2012 &nbsp;(2)</option>
	<option value='http://blog.quenta.org/2012/08'> August 2012 &nbsp;(2)</option>
	<option value='http://blog.quenta.org/2012/07'> July 2012 &nbsp;(1)</option>
	<option value='http://blog.quenta.org/2012/06'> June 2012 &nbsp;(1)</option>
	<option value='http://blog.quenta.org/2012/05'> May 2012 &nbsp;(2)</option>
	<option value='http://blog.quenta.org/2011/11'> November 2011 &nbsp;(1)</option>
	<option value='http://blog.quenta.org/2011/04'> April 2011 &nbsp;(1)</option>
	<option value='http://blog.quenta.org/2011/03'> March 2011 &nbsp;(1)</option>
	<option value='http://blog.quenta.org/2011/02'> February 2011 &nbsp;(1)</option>
	<option value='http://blog.quenta.org/2011/01'> January 2011 &nbsp;(2)</option>
	<option value='http://blog.quenta.org/2010/12'> December 2010 &nbsp;(8)</option>
	<option value='http://blog.quenta.org/2010/11'> November 2010 &nbsp;(3)</option>
	<option value='http://blog.quenta.org/2010/09'> September 2010 &nbsp;(1)</option>
	<option value='http://blog.quenta.org/2010/06'> June 2010 &nbsp;(1)</option>
	<option value='http://blog.quenta.org/2010/05'> May 2010 &nbsp;(1)</option>
	<option value='http://blog.quenta.org/2009/02'> February 2009 &nbsp;(3)</option>
	<option value='http://blog.quenta.org/2008/09'> September 2008 &nbsp;(1)</option>
	<option value='http://blog.quenta.org/2008/05'> May 2008 &nbsp;(2)</option>
	<option value='http://blog.quenta.org/2008/03'> March 2008 &nbsp;(1)</option>
	<option value='http://blog.quenta.org/2007/12'> December 2007 &nbsp;(2)</option>
	<option value='http://blog.quenta.org/2007/10'> October 2007 &nbsp;(1)</option>
	<option value='http://blog.quenta.org/2007/08'> August 2007 &nbsp;(3)</option>
	<option value='http://blog.quenta.org/2007/05'> May 2007 &nbsp;(4)</option>
	<option value='http://blog.quenta.org/2007/04'> April 2007 &nbsp;(1)</option>
	<option value='http://blog.quenta.org/2007/03'> March 2007 &nbsp;(1)</option>
	<option value='http://blog.quenta.org/2007/01'> January 2007 &nbsp;(5)</option>
	<option value='http://blog.quenta.org/2006/12'> December 2006 &nbsp;(2)</option>
	<option value='http://blog.quenta.org/2006/11'> November 2006 &nbsp;(4)</option>
	<option value='http://blog.quenta.org/2006/10'> October 2006 &nbsp;(4)</option>
	<option value='http://blog.quenta.org/2006/09'> September 2006 &nbsp;(2)</option>
	<option value='http://blog.quenta.org/2006/08'> August 2006 &nbsp;(5)</option>
	<option value='http://blog.quenta.org/2006/07'> July 2006 &nbsp;(7)</option>
	<option value='http://blog.quenta.org/2006/06'> June 2006 &nbsp;(5)</option>
	<option value='http://blog.quenta.org/2006/05'> May 2006 &nbsp;(5)</option>
	<option value='http://blog.quenta.org/2006/04'> April 2006 &nbsp;(4)</option>
	<option value='http://blog.quenta.org/2006/03'> March 2006 &nbsp;(10)</option>
	<option value='http://blog.quenta.org/2006/02'> February 2006 &nbsp;(3)</option>
	<option value='http://blog.quenta.org/2006/01'> January 2006 &nbsp;(5)</option>
	<option value='http://blog.quenta.org/2005/12'> December 2005 &nbsp;(2)</option>
	<option value='http://blog.quenta.org/2005/11'> November 2005 &nbsp;(2)</option>
	<option value='http://blog.quenta.org/2005/10'> October 2005 &nbsp;(1)</option>
		</select>
</li><li id="categories-2" class="widget-container widget_categories"><h3 class="widget-title">Categories</h3>		<ul>
	<li class="cat-item cat-item-14"><a href="http://blog.quenta.org/category/babbage" title="View all posts filed under babbage">babbage</a> (5)
</li>
	<li class="cat-item cat-item-6"><a href="http://blog.quenta.org/category/c" title="View all posts filed under C++">C++</a> (6)
</li>
	<li class="cat-item cat-item-17"><a href="http://blog.quenta.org/category/development" title="View all posts filed under development">development</a> (1)
</li>
	<li class="cat-item cat-item-8"><a href="http://blog.quenta.org/category/eclipse" title="View all posts filed under eclipse">eclipse</a> (5)
</li>
	<li class="cat-item cat-item-5"><a href="http://blog.quenta.org/category/java" title="View all posts filed under java">java</a> (13)
</li>
	<li class="cat-item cat-item-12"><a href="http://blog.quenta.org/category/javascript" title="View all posts filed under javascript">javascript</a> (3)
</li>
	<li class="cat-item cat-item-18"><a href="http://blog.quenta.org/category/languages" title="View all posts filed under languages">languages</a> (13)
</li>
	<li class="cat-item cat-item-15"><a href="http://blog.quenta.org/category/mathematics" title="View all posts filed under mathematics">mathematics</a> (4)
</li>
	<li class="cat-item cat-item-4"><a href="http://blog.quenta.org/category/misc" title="View all posts filed under misc">misc</a> (32)
</li>
	<li class="cat-item cat-item-10"><a href="http://blog.quenta.org/category/neptune" title="View all posts filed under neptune">neptune</a> (16)
</li>
	<li class="cat-item cat-item-3"><a href="http://blog.quenta.org/category/neutrino" title="View all posts filed under neutrino">neutrino</a> (17)
</li>
	<li class="cat-item cat-item-16"><a href="http://blog.quenta.org/category/programming" title="View all posts filed under programming">programming</a> (10)
</li>
	<li class="cat-item cat-item-9"><a href="http://blog.quenta.org/category/saturn" title="View all posts filed under saturn">saturn</a> (9)
</li>
	<li class="cat-item cat-item-11"><a href="http://blog.quenta.org/category/tedir" title="View all posts filed under tedir">tedir</a> (6)
</li>
	<li class="cat-item cat-item-1"><a href="http://blog.quenta.org/category/uncategorized" title="View all posts filed under Uncategorized">Uncategorized</a> (11)
</li>
	<li class="cat-item cat-item-7"><a href="http://blog.quenta.org/category/v8" title="View all posts filed under v8">v8</a> (3)
</li>
		</ul>
</li>			</ul>
			
			<!-- Unified into one widget area, as of 1.1.8 -->
					</div><!-- #primary .widget-area -->
				</div><!-- #container -->
			<footer id="footer" role="contentinfo" class="row">
				<div id="footerbar" class="twelvecol last">
									</div><!-- #footerbar -->
				<div id="colophon" class="twelvecol last">
					<div id="site-info" class="sixcol">
						<a href="http://blog.quenta.org/" title="Hummus and Magnets" rel="home">
							Hummus and Magnets						</a>
					</div><!-- #site-info -->
					<div id="site-generator" class="sixcol last">
												<a href="http://wordpress.org/" title="Semantic Personal Publishing Platform">Proudly powered by WordPress.</a>
					</div><!-- #site-generator -->
				</div><!-- #colophon -->
			</footer><!-- #footer -->
		</div><!-- #wrapper -->
		<script type="text/javascript">
var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-34863345-1']);
_gaq.push(['_trackPageview']);
(function() {
var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ga);
})();
</script>
	<div style="display:none">
	<div class="grofile-hash-map-74a1a6b65bbe5ad874af0aa193dc76dc">
	</div>
	<div class="grofile-hash-map-d65f60d48417ac4f04f73712268bfa6b">
	</div>
	<div class="grofile-hash-map-cbc1c6307da1111de857811cf123cc7a">
	</div>
	<div class="grofile-hash-map-480f7f998a2d4bdca2b2e86b685f367b">
	</div>
	<div class="grofile-hash-map-357a20e8c56e69d6f9734d23ef9517e8">
	</div>
	<div class="grofile-hash-map-f8087d3f3af20b95daac8da08f3c4138">
	</div>
	<div class="grofile-hash-map-6ee67a69359a023d7e1f272661515ce8">
	</div>
	<div class="grofile-hash-map-ac67d035cc08c4fe3a7ab9825f95b47a">
	</div>
	<div class="grofile-hash-map-d5ddd37eb8b124ec921fee5a1f40c737">
	</div>
	<div class="grofile-hash-map-e6e32317823b0514da2ee1191ee60c64">
	</div>
	<div class="grofile-hash-map-0b3b2bff3d65155703489c88fe16c44e">
	</div>
	<div class="grofile-hash-map-e509a93bbe4753860062cb6886987ccf">
	</div>
	<div class="grofile-hash-map-6a2aac087c262268c825ca7add6f6ef2">
	</div>
	<div class="grofile-hash-map-b0a5a05019677c4b7d5676f1a34a8f97">
	</div>
	<div class="grofile-hash-map-ba169a36ca60fc00c60eb2b71fd03c1d">
	</div>
	<div class="grofile-hash-map-a77a5a5c7cdeb0b979862c64d615d3a3">
	</div>
	<div class="grofile-hash-map-9854161cf34487cd72d6e854c8ec44ee">
	</div>
	<div class="grofile-hash-map-873ce7772ecbdee61a65d862469acdb0">
	</div>
	<div class="grofile-hash-map-3696b01b9b07aca1e84da0ea30d49e35">
	</div>
	<div class="grofile-hash-map-efcebeb82aec48a1cb296e3119f8879d">
	</div>
	<div class="grofile-hash-map-7ce2c2dc1416d0fc12400d4fc50695fe">
	</div>
	<div class="grofile-hash-map-d441126e0abbbf4bddf90251ae8fd12b">
	</div>
	<div class="grofile-hash-map-d6f1b30472b1b942abab5e2bfb59956c">
	</div>
	<div class="grofile-hash-map-e48d001833c9a61238ee20dc98ce0570">
	</div>
	<div class="grofile-hash-map-099acf92da5291d510da4afb0068b984">
	</div>
	<div class="grofile-hash-map-3703611b65a5c501f52598bde13fd3a0">
	</div>
	<div class="grofile-hash-map-176704cc283c8e6a65b965b862093af8">
	</div>
	<div class="grofile-hash-map-cda9f9be04504c7444ae5dec36ffdc24">
	</div>
	<div class="grofile-hash-map-7591f16c5d2bfb3abe7da19b042b1e2a">
	</div>
	</div>
<script type='text/javascript' src='http://blog.quenta.org/wp-content/plugins/jetpack/modules/sharedaddy/sharing.js?ver=20120131'></script>
			<script type="text/javascript" charset="utf-8">
				function sharing_plusone( obj ) { 
					jQuery.ajax( {
						url: 'http://blog.quenta.org/2012/09/0x5f3759df.html?share=google-plus-1',
						type: 'POST',
						data: obj
					} );
				}
			</script>
			<script type="text/javascript" src="http://apis.google.com/js/plusone.js"></script> 		<script type="text/javascript" charset="utf-8">
		jQuery(document).ready(function(){
			jQuery( 'a.share-facebook' ).click(function(){
				window.open( jQuery(this).attr( 'href' ), 'wpcomfacebook', 'menubar=1,resizable=1,width=600,height=400' );
				return false;
			});
		});
		</script>
		<script type="text/javascript" src="//platform.linkedin.com/in.js"></script>		<script type="text/javascript" charset="utf-8">
		jQuery(document).ready(function(){
			jQuery( 'a.share-twitter' ).click(function(){
				window.open( jQuery(this).attr( 'href' ), 'wpcomtwitter', 'menubar=1,resizable=1,width=600,height=350' );
				return false;
			});
		});
		</script>
		<script type='text/javascript' src='http://blog.quenta.org/wp-includes/js/comment-reply.min.js?ver=3.9.1'></script>
<script type='text/javascript' src='http://s0.wp.com/wp-content/js/devicepx-jetpack.js?ver=201427'></script>
<script type='text/javascript' src='http://s.gravatar.com/js/gprofiles.js?ver=2014Julaa'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var WPGroHo = {"my_hash":""};
/* ]]> */
</script>
<script type='text/javascript' src='http://blog.quenta.org/wp-content/plugins/jetpack/modules/wpgroho.js?ver=3.9.1'></script>

	<script src="http://stats.wordpress.com/e-201427.js" type="text/javascript"></script>
	<script type="text/javascript">
	st_go({v:'ext',j:'1:2.0.2',blog:'43868532',post:'168'});
	var load_cmc = function(){linktracker_init(43868532,168,2);};
	if ( typeof addLoadEvent != 'undefined' ) addLoadEvent(load_cmc);
	else load_cmc();
	</script>	</body>
</html>
