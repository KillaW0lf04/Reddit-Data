<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
<head>
	
		<link rel='alternate' type='application/rss+xml' title='Math related Bug #50696 - RDF' href='rss/bug.php?id=50696' />
		<link rel='alternate' type='application/rss+xml' title='Math related Bug #50696 - RSS 2.0' href='rss/bug.php?id=50696&format=rss2' />
		<base href="https://bugs.php.net/" />
	<title>PHP :: Bug #50696 :: number_format when passed a 0 as first function argument, returns null</title>
	<link rel="shortcut icon" href="https://bugs.php.net/images/favicon.ico" />
	<link rel="stylesheet" href="https://bugs.php.net/css/style.css" />
</head>

<body>

<table id="top" class="head" cellspacing="0" cellpadding="0">
	<tr>
		<td class="head-logo">
			<a href="/"><img src="images/logo.gif" alt="Bugs" vspace="2" hspace="2" /></a>
		</td>

		<td class="head-menu">
			<a href="http://www.php.net/">php.net</a>&nbsp;|&nbsp;
			<a href="http://www.php.net/support.php">support</a>&nbsp;|&nbsp;
			<a href="http://www.php.net/docs.php">documentation</a>&nbsp;|&nbsp;
			<a href="report.php">report a bug</a>&nbsp;|&nbsp;
			<a href="search.php">advanced search</a>&nbsp;|&nbsp;
			<a href="search-howto.php">search howto</a>&nbsp;|&nbsp;
			<a href="stats.php">statistics</a>&nbsp;|&nbsp;
			<a href="random">random bug</a>&nbsp;|&nbsp;
			<a href="login.php">login</a>
		</td>
	</tr>

	<tr>
		<td class="head-search" colspan="2">
			<form method="get" action="search.php">
				<p class="head-search">
					<input type="hidden" name="cmd" value="display" />
					<small>go to bug id or search bugs for</small>
					<input class="small" type="text" name="search_for" value="" size="30" />
					<input type="image" src="images/small_submit_white.gif" alt="search" style="vertical-align: middle;" />
				</p>
			</form>
		</td>
	</tr>
</table>

<table class="middle" cellspacing="0" cellpadding="0">
	<tr>
		<td class="content">
<div id="bugheader">
	<table id="details">
		<tr id="title">
			<th class="details" id="number"><a href="bug.php?id=50696">Bug</a>&nbsp;#50696</th>
			<td id="summary" colspan="5">number_format when passed a 0 as first function argument, returns null</td>
		</tr>
		<tr id="submission">
			<th class="details">Submitted:</th>
			<td style="white-space: nowrap;">2010-01-08 19:13 UTC</td>
			<th class="details">Modified:</th>
			<td style="white-space: nowrap;">2012-06-22 14:39 UTC</td>
			<td rowspan="6">

				<table id="votes">
					<tr><th class="details">Votes:</th><td>175</td></tr>
					<tr><th class="details">Avg. Score:</th><td>2.7 &plusmn; 1.8</td></tr>
					<tr><th class="details">Reproduced:</th><td>44 of 100 (44.0%)</td></tr>
					<tr><th class="details">Same Version:</th><td>38 (86.4%)</td></tr>
					<tr><th class="details">Same OS:</th><td>29 (65.9%)</td></tr>
				</table>

			</td>
		</tr>

		<tr id="submitter">
			<th class="details">From:</th>
			<td>endosquid &#x61;&#116; endosquid &#x64;&#111;&#x74; com</td>
			<th class="details">Assigned:</th>
			<td></td>
		</tr>

		<tr id="categorization">
			<th class="details">Status:</th>
			<td>Wont fix</td>
			<th class="details">Package:</th>
			<td><a href="search.php?cmd=display&amp;package_name[]=Math+related">Math related</a></td>
		</tr>

		<tr id="situation">
			<th class="details">PHP Version:</th>
			<td>5.3.1</td>
			<th class="details">OS:</th>
			<td>Linux 32 bit</td>
		</tr>
		
		<tr id="private">
			<th class="details">Private report:</th>
			<td>No</td>
			<th class="details">CVE-ID:</th>
			<td></td>
		</tr>
	</table>
</div>

<div class="controls">
<span id='control_0' class='control active'>View</span>
<span id='control_3' class='control'><a href='bug.php?id=50696&amp;edit=3'>Add Comment</a></span>
<span id='control_1' class='control'><a href='bug.php?id=50696&amp;edit=1'>Developer</a></span>
<span id='control_2' class='control'><a href='bug.php?id=50696&amp;edit=2'>Edit</a></span>
</div>
<div class="clear"></div>

<form id="vote" method="post" action="vote.php">
	<div class="sect">
		<fieldset>
			<legend>Have you experienced this issue?</legend>
			<div>
				<input type="radio" id="rep-y" name="reproduced" value="1" onchange="show('canreproduce')" /> <label for="rep-y">yes</label>
				<input type="radio" id="rep-n" name="reproduced" value="0" onchange="hide('canreproduce')" /> <label for="rep-n">no</label>
				<input type="radio" id="rep-d" name="reproduced" value="2" onchange="hide('canreproduce')" checked="checked" /> <label for="rep-d">don't know</label>
			</div>
		</fieldset>
		<fieldset>
			<legend>Rate the importance of this bug to you:</legend>
			<div>
				<label for="score-5">high</label>
				<input type="radio" id="score-5" name="score" value="2" />
				<input type="radio" id="score-4" name="score" value="1" />
				<input type="radio" id="score-3" name="score" value="0" checked="checked" />
				<input type="radio" id="score-2" name="score" value="-1" />
				<input type="radio" id="score-1" name="score" value="-2" />
				<label for="score-1">low</label>
			</div>
		</fieldset>
	</div>
	<div id="canreproduce" class="sect" style="display: none">
		<fieldset>
			<legend>Are you using the same PHP version?</legend>
			<div>
				<input type="radio" id="ver-y" name="samever" value="1" /> <label for="ver-y">yes</label>
				<input type="radio" id="ver-n" name="samever" value="0" checked="checked" /> <label for="ver-n">no</label>
			</div>
		</fieldset>
		<fieldset>
			<legend>Are you using the same operating system?</legend>
			<div>
				<input type="radio" id="os-y" name="sameos" value="1" /> <label for="os-y">yes</label>
				<input type="radio" id="os-n" name="sameos" value="0" checked="checked" /> <label for="os-n">no</label>
			</div>
		</fieldset>
	</div>
	<div id="submit" class="sect">
		<input type="hidden" name="id" value="50696" />
		<input type="submit" value="Vote" />
	</div>
</form>
<br clear="all" />


<div class='comment type_comment' ><a name="1262978021">&nbsp;</a><strong>[2010-01-08 19:13 UTC] endosquid &#x61;&#116; endosquid &#x64;&#111;&#x74; com</strong>
<pre class='note'>Description:
------------
php -r 2&gt;/dev/null 'print number_format(&quot;&quot;,0) . &quot;\n&quot;;'
on our old PHP 5.1.6 Solaris 8 box (that we are transitioning off of) returns 0.

Now, we're testing our code, and we run into this behavior change:
php -r 2&gt;/dev/null 'print number_format(&quot;&quot;,0) . &quot;\n&quot;;'
on our new RHEL5 with 5.3.1 from the REMI repository returns NULL. Is this the default behavior expected? If so, why did this change happen? If not, where did we go wrong?

Reproduce code:
---------------
php -r 2&gt;/dev/null 'print number_format(&quot;&quot;,0) . &quot;\n&quot;;'

Expected result:
----------------
We expect to see 0 returned, not NULL.

Actual result:
--------------
NULL is returned.

</pre>
</div><h2>Patches</h2>
<p><a href='patch-add.php?bug_id=50696'>Add a Patch</a></p><h2>Pull Requests</h2>
<p><a href='gh-pull-add.php?bug_id=50696'>Add a Pull Request</a></p><h2 style="border-bottom:2px solid #666;margin-bottom:0;padding:5px 0;">History</h2><div id='comment_filter' class='controls comments'><span id='type_all' class='control active' onclick='do_comment(this);'>All</span><span id='type_comment' class='control ' onclick='do_comment(this);'>Comments</span><span id='type_log' class='control ' onclick='do_comment(this);'>Changes</span><span id='type_svn' class='control ' onclick='do_comment(this);'>Git/SVN commits</span><span id='type_related' class='control ' onclick='do_comment(this);'>Related reports</span>			</div>
			<div id='comments_view' style='clear:both;'>
<div class='comment type_comment' ><a name="1262978429">&nbsp;</a><strong>[2010-01-08 19:20 UTC] <a href="//people.php.net/user.php?username=rasmus">rasmus@php.net</a></strong>
<pre class='note'>Why are you passing an empty string in place of a number there?  You 
are essentially asking for an empty string to be printed with 0 decimal 
places and you are getting back an empty string.  You also get a big 
warning about that, of course.  How about &quot;a&quot;,0 what do you expect that 
to return?  

I think the right solution for you here is to be explicit about casting 
your weird inputs to a float.  number_format((float)$weird,'0') will 
take care of it.
</pre>
</div><div class='comment type_comment' ><a name="1262985987">&nbsp;</a><strong>[2010-01-08 21:26 UTC] endosquid &#x61;&#116; endosquid &#x64;&#111;&#x74; com</strong>
<pre class='note'>I submit that you may have missed the point:

We are passing a (possibly uninitialized, or null-valued) variable to the function, in hundreds of places and web pages, and we would not expect such a fundamental function to suddenly return a different result.  What is unreasonable about expecting a &quot;number formatting&quot; function to default to &quot;0&quot; if given non-numeric or null input, *esp* since that has been the behavior since Day 1?
</pre>
</div><div class='comment type_comment' ><a name="1262986741">&nbsp;</a><strong>[2010-01-08 21:39 UTC] <a href="//people.php.net/user.php?username=rasmus">rasmus@php.net</a></strong>
<pre class='note'>No, I am not missing the point.  This same behaviour could very well be 
a bug in an app as well.  If this was changed in a minor version, I'd 
agree with you on the BC change, but we have been working on catching 
these weird edge-case scenarios that lead to unexpected bugs.

</pre>
</div><div class='comment type_comment' ><a name="1262987474">&nbsp;</a><strong>[2010-01-08 21:51 UTC] endosquid &#x61;&#116; endosquid &#x64;&#111;&#x74; com</strong>
<pre class='note'>This is going to cause us MONTHS or fixing code for no real benefit since this behavior change is arbitrary and seemingly, was made for no reason. We are all engineers and developershere, and can't seem to get the reasoning behind returning NULL when a number is called for in the return. 

It's not a number definition, but FORMATTING. How do you format nothing in the numerical system? By having it be zero. You don't have NULL dollars in your bank account, do you? 

Please escalate this to someone who can answer the question as to why this was changed. If no one knows, then why was default behavior changed?
</pre>
</div><div class='comment type_comment' ><a name="1262989421">&nbsp;</a><strong>[2010-01-08 22:23 UTC] <a href="//people.php.net/user.php?username=rasmus">rasmus@php.net</a></strong>
<pre class='note'>Months?  Being a bit dramatic here?

sed -i &quot;s#number_format(#number_format((float)#g&quot; *.php

Escalate?  Oh how I wish I had someone to escalate to.  

The change was part of standardizing all of PHP on the same parameter 
parsing code.  It is called zend_parse_parameters() internally.  Most 
of PHP was using this already, but there were still some stragglers 
like number_format().

The first PHP 5.3 release candidate was back in March 2009.  We put 
these release candidates out there so people who &quot;will have MONTHS of 
work&quot; because of small changes can chime in then and make their case.  
The release candidate period lasted until July.


</pre>
</div><div class='comment type_comment' ><a name="1262990303">&nbsp;</a><strong>[2010-01-08 22:38 UTC] endosquid &#x61;&#116; endosquid &#x64;&#111;&#x74; com</strong>
<pre class='note'>Dramatic? You've obviously never worked in a change-request-release environment. We have number_format in literally thousands of places across 50 or 60 separate products. Each of those changes will have to be coded, tested, written-off, released, tested by the clients since this is tax data and has to be precise for tax planning and retirement planning.

So, before you go belittling the developers and users depending on PHP, perhaps you should stop and think about the massive effect this change has had on us and not act so dismissive.

5.3.x was not available on our last platform, which is why we are moving to a supported, fairly-recent platform. Why you have so much anger towards this bug is not a proper way to triage or respond to user requests. We have done nothing but explain how this change will massively affect our calculations.

Our only feasible option is to patch php back to the old behavior, but my C is fairly rusty and we ran into issues with time testing the ins and outs from buffers in the number_format function in math.c
</pre>
</div><div class='comment type_comment' ><a name="1262990824">&nbsp;</a><strong>[2010-01-08 22:47 UTC] <a href="//people.php.net/user.php?username=rasmus">rasmus@php.net</a></strong>
<pre class='note'>I have worked in such environments.  Much bigger ones, in fact.  Part 
of your responsibility in your position is to keep track of your tools 
and the changes coming down the pipeline.  5.3 was available to you as 
a release candidate in March of last year, and even earlier directly 
from our revision control system.  Many things have changed and there 
are many many people out there affected by these changes, we recognize 
that.  That is also why we are not likely to reverse a change like this 
that others in your situation have now accounted for, tested and 
deployed in production for many months simply because it is 
inconvenient for you.
</pre>
</div><div class='comment type_comment' ><a name="1262991943">&nbsp;</a><strong>[2010-01-08 23:05 UTC] endosquid &#x61;&#116; endosquid &#x64;&#111;&#x74; com</strong>
<pre class='note'>I get it. Yours is bigger, you've worked better, you are at the cutting edge of everything, and you have infinite resources to test every new version of every piece of software in your stack. Got it. I'm shamed and have no options. So, you're going to give a cover-all answer to make sure that you don't have to do anything. Ok, I get it. I hope no one ever does this to you, because it makes you lose faith in the product.

We will push forwrd with patching the source. It would appear that the 1194th line in math.c is the one that needs changing. returning 0 as opposed to returning nothing? I'll edit and compile.
</pre>
</div><div class='comment type_comment' ><a name="1262992813">&nbsp;</a><strong>[2010-01-08 23:20 UTC] <a href="//people.php.net/user.php?username=rasmus">rasmus@php.net</a></strong>
<pre class='note'>Wow, a classic case of how not to treat unpaid volunteers who provide 
critical pieces of your money-making infrastructure.
</pre>
</div><div class='comment type_comment' ><a name="1262992972">&nbsp;</a><strong>[2010-01-08 23:22 UTC] endosquid &#x61;&#116; endosquid &#x64;&#111;&#x74; com</strong>
<pre class='note'>Just look in the mirror, pal.

You need classes on how to listen to others.
</pre>
</div><div class='comment type_comment' ><a name="1262994439">&nbsp;</a><strong>[2010-01-08 23:47 UTC] <a href="//people.php.net/user.php?username=bjori">bjori@php.net</a></strong>
<pre class='note'>Sir.

This issue was recently brought to my attention.
On behalf of PHP I would like to apologize. I see that now that you have been treated unfairly.

After carefully reviewing this bug report with our board of directors on 4chan, we have come to the conclusion that your &quot;rusty C skills&quot; should be enough to fix the issue.
I would therefore like to remind you that rasmus@php.net is <a href="http://en.wikipedia.org/wiki/Rasmus_lerdorf" rel="nofollow">http://en.wikipedia.org/wiki/Rasmus_lerdorf</a>

Again, I sincerely apologize. We will try to stop fixing bugs in PHP.

</pre>
</div><div class='comment type_comment' ><a name="1314063703">&nbsp;</a><strong>[2011-08-23 01:41 UTC] jacob &#x61;&#116; jacobweber &#x64;&#111;&#x74; com</strong>
<pre class='note'>Fun thread! Anyway, I was wondering if anyone has a complete list of the functions 
that changed as a result of this zend_parse_parameters() fix. I don't see anything 
specific in the upgrade instructions:
  <a href="http://www.php.net/manual/en/migration53.incompatible.php" rel="nofollow">http://www.php.net/manual/en/migration53.incompatible.php</a>

Also, will number_format((float) $x) behave under PHP 5.3.x exactly the same way 
that number_format($x) behaved under PHP 5.2.x? Are there any subtle differences?

Thanks.
</pre>
</div><div class='comment type_log' ><a name="1340375971">&nbsp;</a><strong>[2012-06-22 14:39 UTC] <a href="//people.php.net/user.php?username=rasmus">rasmus@php.net</a></strong>
<div class='log_note'><div class="changeset">
<span class="removed">-Block user comment: No</span>
<span class="added">+Block user comment: Yes</span>
</div></div></div></div>
		</td>
	</tr>
</table>

<script type='text/javascript' src='js/util.js'></script>
<script type='text/javascript' src='https://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js'></script>
<script type="text/javascript" src="js/jquery.cookie.js"></script>
<script type="text/javascript">
function do_comment(nd)
{
	$('#comment_filter > .control.active').removeClass("active");
	$(nd).addClass("active");
	
	$.cookie('history_tab', nd.id, { expires: 365 });
	
	if (nd.id == 'type_all') { 
		$('#comments_view > .comment:hidden').show('slow');
	} else {
		$('#comments_view > .comment').each(function(i) {
			if ($(this).hasClass(nd.id)) {
				$(this).show('slow');
			} else {
				$(this).hide('slow');
			}
		});
	}
	return false;
}
</script>
<table class="foot" cellspacing="0" cellpadding="0">
	<tr>
		<td class="foot-bar" colspan="2">&nbsp;</td>
	</tr>

	<tr>
		<td class="foot-copy">
			<small>
				<a href="http://www.php.net/"><img src="images/logo-small.gif" align="left" valign="middle" hspace="3" alt="PHP" /></a>
				<a href="http://www.php.net/copyright.php">Copyright &copy; 2001-2014 The PHP Group</a><br />
				All rights reserved.
			</small>
		</td>
		<td class="foot-source">
			<small>Last updated: Tue Jul 01 20:01:41 2014 UTC</small>
		</td>
	</tr>
</table>
</body>
</html>
